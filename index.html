<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jwal's Brew Reviews</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600;700&family=IBM+Plex+Sans:wght@400;500;600;700&display=swap');

:root {
--black:    #0a0a0a;
--bg:       #0d0d0d;
--panel:    #111111;
--panel2:   #141414;
--border:   #222222;
--border2:  #2a2a2a;
--orange:   #ff6600;
--orange2:  #ff8833;
--orange3:  #cc4400;
--amber:    #ffaa00;
--green:    #00cc44;
--green2:   #00ff55;
--red:      #ff2222;
--red2:     #cc1111;
--cyan:     #00aaff;
--cyan2:    #0088cc;
--white:    #e8e8e8;
--dim:      #555555;
--dim2:     #3a3a3a;
--yellow:   #ffdd00;
--mono:     'IBM Plex Mono', 'Courier New', monospace;
--sans:     'IBM Plex Sans', sans-serif;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html, body {
background: var(--black);
color: var(--white);
font-family: var(--mono);
font-size: 12px;
overflow-x: hidden;
height: 100%;
cursor: default;
}

/* Scanline overlay */
body::after {
content: '';
position: fixed;
inset: 0;
pointer-events: none;
z-index: 9999;
background: repeating-linear-gradient(
0deg,
transparent,
transparent 1px,
rgba(0,0,0,0.04) 1px,
rgba(0,0,0,0.04) 2px
);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TOP MENU BAR â€” Bloomberg-style function keys
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#menubar {
background: var(--orange);
display: flex;
align-items: stretch;
height: 22px;
border-bottom: 1px solid var(--orange3);
user-select: none;
}
.mb-item {
display: flex;
align-items: center;
padding: 0 10px;
font-size: 10px;
font-weight: 600;
color: #000;
border-right: 1px solid var(--orange3);
cursor: pointer;
letter-spacing: 0.5px;
white-space: nowrap;
transition: background 0.08s;
}
.mb-item:hover { background: rgba(0,0,0,0.15); }
.mb-item .fkey {
background: #000;
color: var(--orange);
font-size: 8px;
padding: 1px 3px;
margin-right: 4px;
font-weight: 700;
}
.mb-logo {
font-weight: 700;
font-size: 11px;
padding: 0 12px;
border-right: 2px solid var(--orange3);
background: #000;
color: var(--orange);
letter-spacing: 1px;
}
.mb-spacer { flex: 1; }
.mb-right { display: flex; align-items: center; padding: 0 10px; font-size: 10px; color: #000; font-weight: 600; letter-spacing: 0.3px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
HEADER BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#hdr {
background: var(--panel);
border-bottom: 2px solid var(--orange);
display: flex;
align-items: stretch;
height: 48px;
}
.hdr-block {
padding: 0 14px;
display: flex;
flex-direction: column;
justify-content: center;
border-right: 1px solid var(--border);
}
.hdr-block.wide { flex: 1; }
.hdr-title {
font-size: 16px;
font-weight: 700;
color: var(--orange);
letter-spacing: 0.5px;
line-height: 1;
font-family: var(--mono);
}
.hdr-sub {
font-size: 9px;
color: var(--dim);
letter-spacing: 1.5px;
text-transform: uppercase;
margin-top: 3px;
}
.hdr-stat {
text-align: center;
min-width: 72px;
}
.hdr-val { font-size: 14px; font-weight: 700; font-family: var(--mono); line-height: 1.1; }
.hdr-lbl { font-size: 8px; color: var(--dim); letter-spacing: 1px; text-transform: uppercase; margin-top: 2px; }
#clock-block {
padding: 0 14px;
display: flex;
flex-direction: column;
justify-content: center;
text-align: right;
min-width: 200px;
}
#clock-time { font-size: 18px; font-weight: 700; color: var(--green); letter-spacing: 1px; font-family: var(--mono); }
#clock-date { font-size: 9px; color: var(--dim); letter-spacing: 1px; margin-top: 2px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TICKER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#ticker-bar {
background: #000;
border-bottom: 1px solid var(--border);
height: 20px;
overflow: hidden;
white-space: nowrap;
display: flex;
align-items: center;
position: relative;
}
#ticker-wrap {
flex: 1;
overflow: hidden;
height: 100%;
display: flex;
align-items: center;
}
.ticker-label {
background: var(--orange);
color: #000;
font-size: 9px;
font-weight: 700;
padding: 0 10px;
height: 100%;
display: flex;
align-items: center;
letter-spacing: 1px;
flex-shrink: 0;
border-right: 2px solid #000;
z-index: 2;
position: relative;
}
#ticker-scroll { display: inline-block; white-space: nowrap; animation: ticker 120s linear infinite; padding-left: 20px; will-change: transform; }
#ticker-scroll span { font-size: 10px; margin: 0 20px; letter-spacing: 0.3px; white-space: nowrap; }
@keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.terminal-body {
display: flex;
height: calc(100vh - 90px);
}
#sidebar {
width: 168px;
flex-shrink: 0;
background: var(--panel);
border-right: 2px solid var(--orange);
overflow-y: auto;
display: flex;
flex-direction: column;
}
#main {
flex: 1;
overflow-y: auto;
background: var(--bg);
padding-bottom: 20px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SIDEBAR NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.nav-section-head {
background: var(--border2);
padding: 4px 8px;
font-size: 8px;
color: var(--dim);
letter-spacing: 2px;
text-transform: uppercase;
border-bottom: 1px solid var(--border);
border-top: 1px solid var(--border);
}
.nav-item {
display: flex;
align-items: center;
padding: 5px 8px;
cursor: pointer;
border-bottom: 1px solid var(--border);
transition: background 0.08s;
gap: 6px;
font-size: 10px;
color: #aaa;
letter-spacing: 0.3px;
}
.nav-item:hover { background: var(--panel2); color: var(--orange); }
.nav-item.active { background: var(--orange); color: #000; font-weight: 700; }
.nav-item .nkey {
margin-left: auto;
font-size: 8px;
background: var(--border2);
color: var(--dim);
padding: 0 3px;
border: 1px solid var(--border);
flex-shrink: 0;
}
.nav-item.active .nkey { background: var(--orange3); color: #000; border-color: var(--orange3); }
.nav-icon { width: 12px; text-align: center; flex-shrink: 0; font-size: 9px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PANELS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.panel { display: none; padding: 8px; }
.panel.active { display: block; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BLOOMBERG PANELS / WINDOWS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bb-panel {
background: var(--panel);
border: 1px solid var(--border2);
margin-bottom: 8px;
position: relative;
}
.bb-panel-head {
background: var(--orange);
color: #000;
font-size: 9px;
font-weight: 700;
padding: 3px 8px;
letter-spacing: 1px;
text-transform: uppercase;
display: flex;
align-items: center;
justify-content: space-between;
}
.bb-panel-head .ph-right { font-size: 8px; font-weight: 400; color: var(--orange3); }
.bb-body { padding: 8px; }

/* Grid layouts */
.g2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px; }
.g3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 8px; }
.g4 { display: grid; grid-template-columns: repeat(4,1fr); gap: 8px; margin-bottom: 8px; }
.g5 { display: grid; grid-template-columns: repeat(5,1fr); gap: 8px; margin-bottom: 8px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
KPI TILES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.kpi {
background: var(--panel);
border: 1px solid var(--border2);
border-top: 2px solid var(--orange);
padding: 8px 10px;
}
.kpi-val {
font-size: 20px;
font-weight: 700;
font-family: var(--mono);
line-height: 1;
margin-bottom: 2px;
}
.kpi-label {
font-size: 8px;
color: var(--dim);
letter-spacing: 1.5px;
text-transform: uppercase;
}
.kpi-sub { font-size: 9px; color: var(--dim); margin-top: 2px; }
.kpi-delta { font-size: 9px; font-weight: 600; }
.up { color: var(--green2); }
.dn { color: var(--red); }
.fl { color: var(--amber); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TABLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bb-table { width: 100%; border-collapse: collapse; font-size: 10px; }
.bb-table thead th {
background: var(--border2);
color: var(--orange);
font-size: 8px;
text-transform: uppercase;
letter-spacing: 1px;
padding: 4px 8px;
text-align: left;
border-right: 1px solid var(--border);
border-bottom: 1px solid var(--orange3);
font-weight: 600;
}
.bb-table tbody tr {
border-bottom: 1px solid var(--border);
transition: background 0.06s;
}
.bb-table tbody tr:hover { background: var(--panel2); }
.bb-table tbody td {
padding: 5px 8px;
color: var(--white);
border-right: 1px solid var(--border);
vertical-align: middle;
font-family: var(--mono);
}
.bb-table tbody tr:nth-child(even) { background: rgba(255,255,255,0.01); }
.bb-table tbody tr.new-row { background: rgba(0,204,68,0.05); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RATING BADGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rb {
display: inline-block;
padding: 1px 6px;
font-size: 10px;
font-weight: 700;
font-family: var(--mono);
border-left: 3px solid;
letter-spacing: 0.5px;
}
.r5  { color: var(--green2); border-color: var(--green2); background: rgba(0,255,85,0.08); }
.r4  { color: #55dd77; border-color: #55dd77; background: rgba(85,221,119,0.08); }
.r35 { color: var(--amber); border-color: var(--amber); background: rgba(255,170,0,0.08); }
.r3  { color: var(--orange); border-color: var(--orange); background: rgba(255,102,0,0.08); }
.r25 { color: #ff8844; border-color: #ff8844; background: rgba(255,136,68,0.08); }
.r2  { color: var(--red); border-color: var(--red); background: rgba(255,34,34,0.08); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PROGRESS BARS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bb-bar-row { margin-bottom: 6px; }
.bb-bar-label { display: flex; justify-content: space-between; font-size: 9px; margin-bottom: 2px; }
.bb-bar-label .name { color: var(--orange2); font-weight: 500; }
.bb-bar-label .val { color: var(--dim); font-family: var(--mono); }
.bb-bar-bg { background: var(--border2); height: 6px; position: relative; }
.bb-bar-fill { height: 100%; transition: width 0.6s ease; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SORT/FILTER BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bb-ctrl {
display: flex;
align-items: center;
justify-content: space-between;
padding: 4px 0;
margin-bottom: 6px;
border-bottom: 1px solid var(--border);
}
.bb-ctrl-title { font-size: 10px; font-weight: 700; color: var(--orange); letter-spacing: 0.5px; }
.bb-select {
background: var(--border2);
border: 1px solid var(--border);
color: var(--orange);
font-family: var(--mono);
font-size: 9px;
padding: 3px 6px;
outline: none;
cursor: pointer;
}
.bb-select:focus { border-color: var(--orange); }
.bb-select option { background: var(--panel); }
.new-tag {
background: var(--green);
color: #000;
font-size: 7px;
font-weight: 700;
padding: 1px 4px;
letter-spacing: 0.5px;
margin-left: 4px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BEER CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.beer-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(162px, 1fr)); gap: 6px; }
.beer-card {
background: var(--panel);
border: 1px solid var(--border2);
border-top: 2px solid var(--dim2);
padding: 8px;
cursor: pointer;
transition: border-top-color 0.1s, background 0.1s;
position: relative;
}
.beer-card:hover { border-top-color: var(--orange); background: var(--panel2); }
.bc-logo-wrap {
width: 100%;
height: 52px;
display: flex;
align-items: center;
justify-content: center;
background: #0a0a0a;
border: 1px solid var(--border);
margin-bottom: 6px;
padding: 4px;
overflow: hidden;
}
.bc-logo {
max-width: 95%;
max-height: 44px;
object-fit: contain;
filter: brightness(1.1) contrast(1.05);
transition: filter 0.15s;
}
.beer-card:hover .bc-logo { filter: brightness(1.3) contrast(1.1); }
.bc-emoji { font-size: 2rem; line-height: 1; }
.bc-ticker { font-size: 11px; font-weight: 700; color: var(--orange); letter-spacing: 0.5px; margin-bottom: 1px; font-family: var(--mono); }
.bc-style { font-size: 8px; color: var(--dim); margin-bottom: 5px; letter-spacing: 0.3px; text-transform: uppercase; }
.bc-bottom { display: flex; justify-content: space-between; align-items: center; }
.bc-abv { font-size: 9px; color: var(--cyan); font-family: var(--mono); }
.bc-new { position: absolute; top: 5px; right: 5px; background: var(--green); color: #000; font-size: 7px; font-weight: 700; padding: 1px 4px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MAPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#drunkMap, #brewedMap {
width: 100%;
height: 400px;
border: 1px solid var(--border2);
filter: grayscale(100%) brightness(0.4) contrast(1.2);
}
.map-leg { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 6px; }
.map-leg-item { display: flex; align-items: center; gap: 5px; font-size: 9px; color: var(--dim); }
.map-leg-dot { width: 8px; height: 8px; border: 1px solid rgba(255,255,255,.2); flex-shrink: 0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
LEAFLET DARK POPUP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.dpop .leaflet-popup-content-wrapper {
background: var(--panel);
border: 1px solid var(--orange);
border-radius: 0;
box-shadow: 0 0 20px rgba(255,102,0,0.3);
}
.dpop .leaflet-popup-tip { background: var(--orange); }
.dpop .leaflet-popup-close-button { color: var(--orange) !important; font-family: var(--mono); }
.dpop .leaflet-popup-content { margin: 8px 12px; font-family: var(--mono); font-size: 10px; color: var(--white); line-height: 1.6; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
INLINE LOGO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.beer-logo-inline {
width: 24px; height: 24px; object-fit: contain;
vertical-align: middle; margin-right: 6px;
filter: brightness(1.1);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
INSIGHT TILES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.insight-row {
display: flex;
align-items: flex-start;
gap: 8px;
padding: 6px 0;
border-bottom: 1px solid var(--border);
font-size: 10px;
}
.insight-row:last-child { border-bottom: none; }
.insight-key { color: var(--orange); width: 140px; flex-shrink: 0; font-size: 9px; letter-spacing: 0.3px; }
.insight-val { color: var(--white); font-weight: 600; }
.insight-sub { color: var(--dim); font-size: 9px; margin-top: 1px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SCROLLBARS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
::-webkit-scrollbar { width: 4px; height: 4px; }
::-webkit-scrollbar-track { background: var(--black); }
::-webkit-scrollbar-thumb { background: var(--orange3); }
::-webkit-scrollbar-thumb:hover { background: var(--orange); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MINI-ROW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.mini-row { display: flex; align-items: center; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid var(--border); font-size: 10px; }
.mini-row:last-child { border-bottom: none; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SEPARATOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bb-sep { height: 1px; background: var(--border); margin: 6px 0; }
.bb-sep-orange { height: 1px; background: var(--orange3); margin: 6px 0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STATUS BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#statusbar {
position: fixed;
bottom: 0; left: 0; right: 0;
height: 16px;
background: var(--orange);
display: flex;
align-items: center;
padding: 0 8px;
gap: 20px;
font-size: 8px;
font-weight: 700;
color: #000;
letter-spacing: 0.5px;
z-index: 100;
}
.sb-item { display: flex; align-items: center; gap: 4px; }
.sb-dot { width: 6px; height: 6px; background: #000; border-radius: 50%; animation: blink 1.2s step-end infinite; }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }
.sb-spacer { flex: 1; }

@media (max-width: 700px) {
#sidebar { display: none; }
.terminal-body { height: auto; }
#main { width: 100%; }
#hdr { flex-wrap: wrap; height: auto; padding: 6px 0; }
.hdr-block.wide { min-width: 100%; border-right: none; border-bottom: 1px solid var(--border); padding-bottom: 6px; }
.hdr-block.hdr-stat { display: none; }
#clock-block { min-width: 100%; border-top: 1px solid var(--border); padding: 4px 14px; flex-direction: row; justify-content: space-between; align-items: center; }
#clock-time { font-size: 13px; }
#clock-date { font-size: 9px; margin-top: 0; }
#menubar { overflow-x: auto; overflow-y: hidden; }
#menubar::-webkit-scrollbar { display: none; }
.mb-item { padding: 0 7px; font-size: 9px; flex-shrink: 0; }
.mb-logo { padding: 0 8px; font-size: 10px; flex-shrink: 0; }
.mb-right { display: none; }
.mb-spacer { display: none; }
.g2, .g3, .g4, .g5 { grid-template-columns: 1fr 1fr; gap: 6px; }
.g3, .g5 { grid-template-columns: 1fr; }
.panel { padding: 6px; }
.bb-body { padding: 6px; }
#statusbar { gap: 10px; font-size: 7px; }
.sb-item:nth-child(3), .sb-item:nth-child(4) { display: none; }
.beer-grid { grid-template-columns: repeat(2, 1fr); gap: 6px; }
.kpi-val { font-size: 15px; }
.bb-body div[style*="overflow-x"] { overflow-x: auto; }
.bb-table { min-width: 420px; }
.insight-key { width: 100px; font-size: 8px; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BEER DETAIL MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#beerModal {
  display: none;
  position: fixed;
  inset: 0;
  z-index: 1000;
  background: rgba(0,0,0,0.85);
  align-items: center;
  justify-content: center;
}
#beerModal.open { display: flex; }
#beerModalBox {
  background: var(--panel);
  border: 1px solid var(--orange);
  width: min(760px, 96vw);
  max-height: 88vh;
  display: flex;
  flex-direction: column;
  box-shadow: 0 0 40px rgba(255,102,0,0.25);
}
#beerModalHead {
  background: var(--orange);
  color: #000;
  font-size: 10px;
  font-weight: 700;
  padding: 5px 10px;
  letter-spacing: 1px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-shrink: 0;
}
#beerModalBody { overflow-y: auto; padding: 12px; }
#beerModalClose {
  background: none;
  border: none;
  color: #000;
  font-family: var(--mono);
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  line-height: 1;
  padding: 0 2px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PASSWORD GATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#pwModal {
  display: none;
  position: fixed;
  inset: 0;
  z-index: 1100;
  background: rgba(0,0,0,0.92);
  align-items: center;
  justify-content: center;
}
#pwModal.open { display: flex; }
#pwBox {
  background: var(--panel);
  border: 1px solid var(--orange);
  width: min(360px, 92vw);
  box-shadow: 0 0 40px rgba(255,102,0,0.3);
}
#pwHead {
  background: var(--orange);
  color: #000;
  font-size: 10px;
  font-weight: 700;
  padding: 5px 10px;
  letter-spacing: 1.5px;
}
#pwBody { padding: 20px 16px; }
#pwInput {
  width: 100%;
  background: #0a0a0a;
  border: 1px solid var(--border);
  color: var(--orange);
  font-family: var(--mono);
  font-size: 14px;
  padding: 8px 10px;
  outline: none;
  letter-spacing: 2px;
  box-sizing: border-box;
  margin-bottom: 10px;
}
#pwInput:focus { border-color: var(--orange); }
#pwBtn {
  width: 100%;
  background: var(--orange);
  color: #000;
  border: none;
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 700;
  padding: 8px;
  cursor: pointer;
  letter-spacing: 1px;
}
#pwBtn:hover { background: #ff8833; }
#pwErr {
  font-size: 9px;
  color: var(--red);
  margin-top: 8px;
  letter-spacing: 0.5px;
  min-height: 14px;
}
</style>

</head>
<body>

<!-- BEER DETAIL MODAL -->
<div id="beerModal" onclick="if(event.target===this)closeBeerModal()">
  <div id="beerModalBox">
    <div id="beerModalHead">
      <span id="beerModalTitle">BEER DETAIL</span>
      <button id="beerModalClose" onclick="closeBeerModal()">âœ•</button>
    </div>
    <div id="beerModalBody"></div>
  </div>
</div>

<!-- PASSWORD GATE MODAL -->
<div id="pwModal">
  <div id="pwBox">
    <div id="pwHead">ğŸ”’ RESTRICTED â€” ENTER PASSWORD</div>
    <div id="pwBody">
      <div style="font-size:9px;color:#555;letter-spacing:1px;margin-bottom:8px">ACCESS REQUIRED FOR THIS SECTION</div>
      <input id="pwInput" type="password" placeholder="PASSWORD" autocomplete="off"
        onkeydown="if(event.key==='Enter')checkPw()"
        oninput="document.getElementById('pwErr').textContent=''">
      <button id="pwBtn" onclick="checkPw()">UNLOCK</button>
      <div id="pwErr"></div>
    </div>
  </div>
</div>

<!-- MENU BAR -->

<div id="menubar">
  <div class="mb-logo">JWAL'S</div>
  <div class="mb-item" onclick="showTab('overview',this)"><span class="fkey">F1</span>OVRVW</div>
  <div class="mb-item" onclick="showTab('beers',this)"><span class="fkey">F2</span>BEERS</div>
  <div class="mb-item" onclick="showTab('rankings',this)"><span class="fkey">F3</span>RANK</div>
  <div class="mb-item" onclick="showTab('countries',this)"><span class="fkey">F4</span>GEO</div>
  <div class="mb-item" onclick="showTab('city',this)"><span class="fkey">F5</span>MKT</div>
  <div class="mb-item" onclick="showTab('insights',this)"><span class="fkey">F6</span>INTEL</div>
  <div class="mb-item" onclick="showTab('temporal',this)"><span class="fkey">F7</span>TIME</div>
  <div class="mb-item" onclick="showTab('mapdrunk',this)"><span class="fkey">F8</span>MAP1</div>
  <div class="mb-item" onclick="showTab('mapbrewed',this)"><span class="fkey">F9</span>MAP2</div>
  <div class="mb-item" onclick="showTab('language',this)"><span class="fkey">F10</span>LANG</div>
  <div class="mb-item" onclick="showTab('contrarian',this)"><span class="fkey">G1</span>CNTRN</div>
  <div class="mb-item" onclick="showTab('ipo',this)"><span class="fkey">G2</span>IPO/FT</div>
  <div class="mb-item" onclick="showTab('audit',this)"><span class="fkey">G3</span>AUDIT</div>
  <div class="mb-item" onclick="showTab('comments',this)"><span class="fkey">G4</span>NOTES</div>
  <div class="mb-item" onclick="showTab('addnew',this)"><span class="fkey">G5</span>+NEW</div>
  <div class="mb-spacer"></div>
  <div class="mb-right" id="mb-clock">â€”</div>
</div>

<!-- HEADER -->

<div id="hdr">
  <div class="hdr-block wide">
    <div class="hdr-title">ğŸº JWAL'S BREW REVIEWS <span style="font-size:11px;color:var(--dim)">Â· BREW TERMINAL v2.7</span></div>
    <div class="hdr-sub">PERSONAL BREW INTELLIGENCE SYSTEM Â· 31 REVIEWS Â· 13 MARKETS Â· 25 BRANDS</div>
  </div>
  <div class="hdr-block hdr-stat">
    <div class="hdr-val" style="color:var(--green2)">4.75</div>
    <div class="hdr-lbl">TOP SCORE</div>
  </div>
  <div class="hdr-block hdr-stat">
    <div class="hdr-val" style="color:var(--orange)">3.29</div>
    <div class="hdr-lbl">AVG RATING</div>
  </div>
  <div class="hdr-block hdr-stat">
    <div class="hdr-val" style="color:var(--red)">2.00</div>
    <div class="hdr-lbl">LOWEST</div>
  </div>
  <div class="hdr-block hdr-stat">
    <div class="hdr-val" style="color:var(--cyan)">5.2%</div>
    <div class="hdr-lbl">AVG ABV</div>
  </div>
  <div class="hdr-block hdr-stat">
    <div class="hdr-val" style="color:var(--amber)">13</div>
    <div class="hdr-lbl">COUNTRIES</div>
  </div>
  <div class="hdr-block hdr-stat">
    <div class="hdr-val" style="color:var(--cyan)" id="streak-days">â€”</div>
    <div class="hdr-lbl">DAYS AGO</div>
    <div class="hdr-sub" id="streak-beer" style="font-size:8px;color:var(--dim)"></div>
  </div>
  <div id="clock-block">
    <div id="clock-time">00:00:00</div>
    <div id="clock-date">MON 01 JAN 2025</div>
  </div>
</div>

<!-- TICKER -->

<div id="ticker-bar">
  <div class="ticker-label">LIVE FEED</div>
  <div id="ticker-wrap"><div id="ticker-scroll"></div></div>
</div>

<!-- BODY -->

<div class="terminal-body">

<!-- SIDEBAR -->

<div id="sidebar">
  <div class="nav-section-head">ANALYTICS</div>
  <div class="nav-item active" onclick="showTab('overview',this)"><span class="nav-icon">â—ˆ</span>OVERVIEW<span class="nkey">F1</span></div>
  <div class="nav-item" onclick="showTab('beers',this)"><span class="nav-icon">â—‰</span>ALL BEERS<span class="nkey">F2</span></div>
  <div class="nav-item" onclick="showTab('rankings',this)"><span class="nav-icon">â–²</span>RANKINGS<span class="nkey">F3</span></div>
  <div class="nav-section-head">MARKETS</div>
  <div class="nav-item" onclick="showTab('countries',this)"><span class="nav-icon">â—</span>GEO / COUNTRY<span class="nkey">F4</span></div>
  <div class="nav-item" onclick="showTab('city',this)"><span class="nav-icon">â–¡</span>CITIES<span class="nkey">F5</span></div>
  <div class="nav-section-head">INTELLIGENCE</div>
  <div class="nav-item" onclick="showTab('insights',this)"><span class="nav-icon">â—ˆ</span>INSIGHTS<span class="nkey">F6</span></div>
  <div class="nav-item" onclick="showTab('temporal',this)"><span class="nav-icon">â—·</span>TEMPORAL<span class="nkey">F7</span></div>
  <div class="nav-item" onclick="showTab('contrarian',this)"><span class="nav-icon">â—†</span>CONTRARIAN IDX<span class="nkey">G1</span></div>
  <div class="nav-item" onclick="showTab('ipo',this)"><span class="nav-icon">â—ˆ</span>IPO / FUTURES<span class="nkey">G2</span></div>
  <div class="nav-item" onclick="showTab('audit',this)"><span class="nav-icon">â¬¡</span>DATA AUDIT<span class="nkey">G3</span></div>
  <div class="nav-item" onclick="showTab('language',this)"><span class="nav-icon">â—‘</span>LANGUAGE<span class="nkey">F10</span></div>
  <div class="nav-section-head">MAPS</div>
  <div class="nav-item" onclick="showTab('mapdrunk',this)"><span class="nav-icon">â—‰</span>CONSUMED<span class="nkey">F11</span></div>
  <div class="nav-item" onclick="showTab('mapbrewed',this)"><span class="nav-icon">â—</span>BREWERIES<span class="nkey">F12</span></div>
</div>

<!-- MAIN CONTENT -->

<div id="main">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• OVERVIEW â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div id="overview" class="panel active">
  <div class="g5" style="margin-bottom:8px">
    <div class="kpi"><div class="kpi-val up">4.75</div><div class="kpi-label">TOP SCORE</div><div class="kpi-sub up">â–² MÃ¼chner Weisse Â· DE</div></div>
    <div class="kpi"><div class="kpi-val fl">3.29</div><div class="kpi-label">AVG RATING</div><div class="kpi-sub">31 total reviews</div></div>
    <div class="kpi"><div class="kpi-val dn">2.00</div><div class="kpi-label">LOWEST</div><div class="kpi-sub dn">â–¼ Hertog Jan Â· NL</div></div>
    <div class="kpi"><div class="kpi-val" style="color:var(--cyan)">5.2%</div><div class="kpi-label">AVG ABV</div><div class="kpi-sub">Range: 4.2â€“9.0%</div></div>
    <div class="kpi"><div class="kpi-val" style="color:var(--amber)">25</div><div class="kpi-label">BRANDS TRIED</div><div class="kpi-sub">Across 13 countries</div></div>
  </div>
  <div class="g2">
    <div class="bb-panel">
      <div class="bb-panel-head">RATING BY STYLE<span class="ph-right">AVG/5.00</span></div>
      <div class="bb-body"><canvas id="styleChart" height="220"></canvas></div>
    </div>
    <div class="bb-panel">
      <div class="bb-panel-head">SERVING METHOD<span class="ph-right">AVG RATING</span></div>
      <div class="bb-body"><canvas id="methodChart" height="220"></canvas></div>
    </div>
  </div>
  <div class="bb-panel">
    <div class="bb-panel-head">ABV vs RATING â€” SCATTER PLOT<span class="ph-right">r â‰ˆ 0.12 Â· NO SIGNIFICANT CORRELATION</span></div>
    <div class="bb-body"><canvas id="scatterChart" height="110"></canvas></div>
  </div>
  <div class="g3">
    <div class="bb-panel">
      <div class="bb-panel-head">BEST PERFORMERS</div>
      <div class="bb-body" id="bestPanel"></div>
    </div>
    <div class="bb-panel">
      <div class="bb-panel-head">MARKET SIGNALS</div>
      <div class="bb-body" id="mktPanel"></div>
    </div>
    <div class="bb-panel">
      <div class="bb-panel-head">LATEST ACTIVITY</div>
      <div class="bb-body" id="latestPanel"></div>
    </div>
  </div>
  <!-- â•â• SERVING METHOD DETAIL â•â• -->
  <div class="g4" style="margin-bottom:8px" id="methodCards"></div>
  <div class="bb-panel">
    <div class="bb-panel-head">SERVING METHOD â€” RATING COMPARISON<span class="ph-right">AVG RATING BY METHOD</span></div>
    <div class="bb-body"><canvas id="methodDetailChart" height="140"></canvas></div>
  </div>
  <div class="bb-panel">
    <div class="bb-panel-head">METHOD DETAIL TABLE</div>
    <div class="bb-body">
      <table class="bb-table">
        <thead><tr><th>METHOD</th><th>REVIEWS</th><th>AVG RATING</th><th>BEST BEER</th><th>WORST BEER</th><th>PREMIUM vs AVG</th></tr></thead>
        <tbody id="methodDetailBody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• ALL BEERS â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div id="beers" class="panel">
  <div class="bb-panel">
    <div class="bb-panel-head">ALL BEERS â€” FULL DATASET<span class="ph-right">31 ENTRIES Â· +5 NEW</span></div>
    <div class="bb-body">
      <div class="bb-ctrl" style="flex-wrap:wrap;gap:6px">
        <span class="bb-ctrl-title">BEER INDEX <span class="new-tag">+5 NEW</span></span>
        <div style="display:flex;gap:6px;flex-wrap:wrap;align-items:center">
          <input id="beerSearch" type="text" placeholder="SEARCH..." oninput="applyBeerFilter()" style="background:var(--border2);border:1px solid var(--border);color:var(--orange);font-family:var(--mono);font-size:9px;padding:3px 6px;outline:none;width:130px" onfocus="this.style.borderColor='#ff6600'" onblur="this.style.borderColor='var(--border)'">
          <select id="beerStyleFilter" class="bb-select" onchange="applyBeerFilter()"><option value="">ALL STYLES</option></select>
          <select id="beerOriginFilter" class="bb-select" onchange="applyBeerFilter()"><option value="">ALL ORIGINS</option></select>
          <select id="beerSortSel" class="bb-select" onchange="applyBeerFilter()">
            <option value="rating">SORT: RATING â†“</option>
            <option value="name">SORT: NAME Aâ†’Z</option>
            <option value="abv">SORT: ABV â†“</option>
          </select>
          <span id="beerFilterCount" style="font-size:9px;color:#555"></span>
        </div>
      </div>
      <div style="overflow-x:auto">
        <table class="bb-table">
          <thead><tr><th width="30"></th><th>BEER</th><th>STYLE</th><th>ORIGIN</th><th>ABV</th><th>METHOD</th><th>CITY</th><th>RATING</th><th>STARS</th></tr></thead>
          <tbody id="beerBody"></tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="bb-panel">
    <div class="bb-panel-head">BEER CARDS â€” QUICK VIEW<span class="ph-right">25 UNIQUE BRANDS</span></div>
    <div class="bb-body">
      <div class="beer-grid" id="beerGrid"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• RANKINGS â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div id="rankings" class="panel">
  <div class="g2">
    <div class="bb-panel">
      <div class="bb-panel-head">TOP 10 â€” BEST REVIEWS<span class="ph-right">â–² LONG</span></div>
      <div class="bb-body" id="top10"></div>
    </div>
    <div class="bb-panel">
      <div class="bb-panel-head">BOTTOM 10 â€” WORST REVIEWS<span class="ph-right">â–¼ SHORT</span></div>
      <div class="bb-body" id="bot10"></div>
    </div>
  </div>
  <div class="bb-panel">
    <div class="bb-panel-head">BRAND LEADERBOARD â€” MULTI-REVIEW BRANDS ONLY<span class="ph-right">Ïƒ = CONSISTENCY</span></div>
    <div class="bb-body">
      <div style="overflow-x:auto">
        <table class="bb-table">
          <thead><tr><th>#</th><th></th><th>BRAND</th><th>REVIEWS</th><th>AVG</th><th>BEST</th><th>WORST</th><th>Ïƒ STD</th><th>CONSISTENCY</th></tr></thead>
          <tbody id="brandBody"></tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="bb-panel">
    <div class="bb-panel-head">RATING FREQUENCY DISTRIBUTION</div>
    <div class="bb-body"><canvas id="distChart" height="130"></canvas></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• COUNTRIES â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div id="countries" class="panel">
  <div class="bb-panel">
    <div class="bb-panel-head">COUNTRY PERFORMANCE INDEX<span class="ph-right">AVG RATING / REVIEWS</span></div>
    <div class="bb-body"><canvas id="countryChart" height="240"></canvas></div>
  </div>
  <div class="g2">
    <div class="bb-panel">
      <div class="bb-panel-head">COUNTRY BREAKDOWN</div>
      <div class="bb-body" id="countryCards"></div>
    </div>
    <div class="bb-panel">
      <div class="bb-panel-head">REVIEWS BY COUNTRY</div>
      <div class="bb-body"><canvas id="countryPieChart" height="200"></canvas></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• CITY â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div id="city" class="panel">
  <div class="bb-panel">
    <div class="bb-panel-head">MARKET PERFORMANCE BY CITY<span class="ph-right">AVG RATING</span></div>
    <div class="bb-body"><canvas id="cityChart" height="200"></canvas></div>
  </div>
  <div class="g2">
    <div class="bb-panel">
      <div class="bb-panel-head">CITY STATS TABLE</div>
      <div class="bb-body" id="cityCards"></div>
    </div>
    <div class="bb-panel">
      <div class="bb-panel-head">REVIEWS BY CITY</div>
      <div class="bb-body"><canvas id="cityPieChart" height="200"></canvas></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• INSIGHTS â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div id="insights" class="panel">
  <div class="g2">
    <div class="bb-panel">
      <div class="bb-panel-head">STATISTICAL SUMMARY</div>
      <div class="bb-body" id="statSummary"></div>
    </div>
    <div class="bb-panel">
      <div class="bb-panel-head">RATING QUINTILE BREAKDOWN</div>
      <div class="bb-body" id="quintiles"></div>
    </div>
  </div>
  <div class="bb-panel">
    <div class="bb-panel-head">TASTE PROFILE â€” PERSONAL BIAS INDICATORS</div>
    <div class="bb-body"><div class="g3" id="tasteProfile" style="margin-bottom:0"></div></div>
  </div>
  <div class="bb-panel">
    <div class="bb-panel-head">REVIEW TIMELINE â€” CHRONOLOGICAL TREND<span class="ph-right">BLUE = 5-REVIEW ROLLING AVG</span></div>
    <div class="bb-body"><canvas id="timelineChart" height="120"></canvas></div>
  </div>
  <div class="bb-panel">
    <div class="bb-panel-head">MULTI-REVIEW BRAND CONSISTENCY ANALYSIS<span class="ph-right">Ïƒ &lt; 0.2 = CONSISTENT</span></div>
    <div class="bb-body" id="consistencyPanel"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• LANGUAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div id="language" class="panel">
  <div class="bb-panel">
    <div class="bb-panel-head">BREWING LANGUAGE INDEX<span class="ph-right">DUTCH = NL + FLEMISH BE</span></div>
    <div class="bb-body"><canvas id="langChart" height="180"></canvas></div>
  </div>
  <div class="bb-panel">
    <div class="bb-panel-head">LANGUAGE PERFORMANCE BARS</div>
    <div class="bb-body" id="langCards"></div>
  </div>
  <div class="bb-panel">
    <div class="bb-panel-head">BREWERY REGION TABLE</div>
    <div class="bb-body">
      <div style="overflow-x:auto">
        <table class="bb-table">
          <thead><tr><th></th><th>BEER</th><th>CTRY</th><th>REGION</th><th>LANG</th><th>RATING</th></tr></thead>
          <tbody id="langTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAP CONSUMED â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div id="mapdrunk" class="panel">
  <div class="bb-panel">
    <div class="bb-panel-head">ğŸ“ PLACES CONSUMED<span class="ph-right">CLICK PINS Â· SIZE = REVIEW COUNT</span></div>
    <div class="bb-body">
      <div id="drunkMap"></div>
      <div class="map-leg" id="drunkLeg"></div>
    </div>
  </div>
  <div class="bb-panel">
    <div class="bb-panel-head">CONSUMPTION BY LOCATION</div>
    <div class="bb-body">
      <table class="bb-table">
        <thead><tr><th>CITY</th><th>REGION</th><th>COUNTRY</th><th>REVIEWS</th><th>AVG</th><th>BEERS TRIED</th></tr></thead>
        <tbody id="drunkTbody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAP BREWERY â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div id="mapbrewed" class="panel">
  <div class="bb-panel">
    <div class="bb-panel-head">ğŸ­ BREWERY LOCATIONS<span class="ph-right">COLOR = AVG RATING</span></div>
    <div class="bb-body">
      <div id="brewedMap"></div>
      <div class="map-leg">
        <div class="map-leg-item"><div class="map-leg-dot" style="background:#16a34a"></div>4.5+</div>
        <div class="map-leg-item"><div class="map-leg-dot" style="background:#22c55e"></div>4.0â€“4.4</div>
        <div class="map-leg-item"><div class="map-leg-dot" style="background:#84cc16"></div>3.5â€“3.9</div>
        <div class="map-leg-item"><div class="map-leg-dot" style="background:#eab308"></div>3.0â€“3.4</div>
        <div class="map-leg-item"><div class="map-leg-dot" style="background:#f97316"></div>2.5â€“2.9</div>
        <div class="map-leg-item"><div class="map-leg-dot" style="background:#ef4444"></div>&lt;2.5</div>
      </div>
    </div>
  </div>
  <div class="bb-panel">
    <div class="bb-panel-head">BREWERY DIRECTORY</div>
    <div class="bb-body">
      <div style="overflow-x:auto">
        <table class="bb-table">
          <thead><tr><th style="width:36px"></th><th>BREWERY</th><th>LOCATION</th><th>COUNTRY</th><th>BEER(S)</th><th>AVG</th></tr></thead>
          <tbody id="brewedTbody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• TEMPORAL â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div id="temporal" class="panel">

  <div class="g4" style="margin-bottom:8px">
    <div class="kpi">
      <div class="kpi-val" style="color:var(--orange)">2</div>
      <div class="kpi-label">MONTHS TRACKED</div>
      <div class="kpi-sub">Jan â€“ Feb 2026</div>
    </div>
    <div class="kpi">
      <div class="kpi-val up">17</div>
      <div class="kpi-label">JAN REVIEWS</div>
      <div class="kpi-sub">Avg: <span id="janAvgKpi">â€”</span></div>
    </div>
    <div class="kpi">
      <div class="kpi-val" style="color:var(--cyan)">12</div>
      <div class="kpi-label">FEB REVIEWS</div>
      <div class="kpi-sub">Avg: <span id="febAvgKpi">â€”</span></div>
    </div>
    <div class="kpi">
      <div class="kpi-val" style="color:var(--amber)" id="momKpi">â€”</div>
      <div class="kpi-label">MOM RATING Î”DELTA</div>
      <div class="kpi-sub" id="momDir">Month-over-month</div>
    </div>
  </div>

  <div class="g2">
    <div class="bb-panel">
      <div class="bb-panel-head">MONTHLY REVIEW VOLUME &amp; AVG RATING<span class="ph-right">BAR=COUNT Â· LINE=AVG</span></div>
      <div class="bb-body"><canvas id="monthlyChart" height="200"></canvas></div>
    </div>
    <div class="bb-panel">
      <div class="bb-panel-head">BEST &amp; WORST BEER BY MONTH</div>
      <div class="bb-body" id="monthBestWorst"></div>
    </div>
  </div>

  <div class="bb-panel">
    <div class="bb-panel-head">RATING DISTRIBUTION â€” JAN vs FEB COMPARISON<span class="ph-right">SIDE-BY-SIDE</span></div>
    <div class="bb-body"><canvas id="monthDistChart" height="140"></canvas></div>
  </div>

  <div class="g2">
    <div class="bb-panel">
      <div class="bb-panel-head">STYLE MIX â€” JANUARY 2026<span class="ph-right">17 REVIEWS</span></div>
      <div class="bb-body"><canvas id="janStyleChart" height="180"></canvas></div>
    </div>
    <div class="bb-panel">
      <div class="bb-panel-head">STYLE MIX â€” FEBRUARY 2026<span class="ph-right">12 REVIEWS</span></div>
      <div class="bb-body"><canvas id="febStyleChart" height="180"></canvas></div>
    </div>
  </div>

  <div class="g2">
    <div class="bb-panel">
      <div class="bb-panel-head">COUNTRY EXPOSURE â€” JAN vs FEB</div>
      <div class="bb-body"><canvas id="monthCountryChart" height="180"></canvas></div>
    </div>
    <div class="bb-panel">
      <div class="bb-panel-head">PACE &amp; RATING MOMENTUM</div>
      <div class="bb-body" id="momentumPanel"></div>
    </div>
  </div>

  <div class="bb-panel">
    <div class="bb-panel-head">ALL REVIEWS â€” CHRONOLOGICAL WITH MONTH<span class="ph-right">SORTED BY DATE â†’ RATING</span></div>
    <div class="bb-body">
      <div style="overflow-x:auto">
        <table class="bb-table">
          <thead><tr><th>MONTH</th><th></th><th>BEER</th><th>STYLE</th><th>ORIGIN</th><th>ABV</th><th>METHOD</th><th>CITY</th><th>RATING</th></tr></thead>
          <tbody id="temporalTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• CONTRARIAN INDEX â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div id="contrarian" class="panel">
  <div class="g4" style="margin-bottom:8px">
    <div class="kpi"><div class="kpi-val" id="ciAvgDelta" style="color:var(--orange)">â€”</div><div class="kpi-label">AVG DEVIATION</div><div class="kpi-sub">vs global Untappd avg</div></div>
    <div class="kpi"><div class="kpi-val up" id="ciMostContrarian">â€”</div><div class="kpi-label">MOST CONTRARIAN</div><div class="kpi-sub" id="ciMostSub">â€”</div></div>
    <div class="kpi"><div class="kpi-val" id="ciOverrater" style="color:var(--green2)">â€”</div><div class="kpi-label">BIGGEST OVERRATER</div><div class="kpi-sub" id="ciOverSub">â€”</div></div>
    <div class="kpi"><div class="kpi-val dn" id="ciUnderrater">â€”</div><div class="kpi-label">BIGGEST UNDERRATER</div><div class="kpi-sub" id="ciUnderSub">â€”</div></div>
  </div>
  <div class="bb-panel">
    <div class="bb-panel-head">JWAL vs THE WORLD â€” RATING DELTA PER BEER<span class="ph-right">+ = YOU RATE HIGHER THAN GLOBAL AVG</span></div>
    <div class="bb-body"><canvas id="contrarianChart" height="220"></canvas></div>
  </div>
  <div class="bb-panel">
    <div class="bb-panel-head">FULL CONTRARIAN TABLE<span class="ph-right">JWAL RATING vs UNTAPPD GLOBAL AVG</span></div>
    <div class="bb-body">
      <div style="overflow-x:auto">
        <table class="bb-table">
          <thead><tr><th></th><th>BEER</th><th>JWAL</th><th>GLOBAL AVG</th><th>DELTA</th><th>VERDICT</th></tr></thead>
          <tbody id="contrarianBody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• IPO WATCHLIST â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="ipo" class="panel">

  <!-- â•â• IPO WATCHLIST â•â• -->
  <div class="bb-panel-head" style="background:var(--orange);color:#000;font-size:9px;font-weight:700;padding:3px 8px;letter-spacing:1px;margin-bottom:8px">â—ˆ IPO WATCHLIST â€” PRE-REVIEW ANALYST TARGETS</div>
  <div class="g4" style="margin-bottom:8px">
    <div class="kpi"><div class="kpi-val" id="ipo-pending" style="color:var(--orange)">15</div><div class="kpi-label">ON WATCHLIST</div></div>
    <div class="kpi"><div class="kpi-val up" id="ipo-priced">0</div><div class="kpi-label">PRICED (REVIEWED)</div></div>
    <div class="kpi"><div class="kpi-val" id="ipo-avg-analyst" style="color:#00aaff">â€”</div><div class="kpi-label">AVG ANALYST TARGET</div></div>
    <div class="kpi"><div class="kpi-val" id="ipo-avg-market" style="color:#bb44ff">â€”</div><div class="kpi-label">AVG MARKET RATING</div></div>
  </div>

  <!-- METHODOLOGY CALLOUT -->
  <div class="bb-panel" style="margin-bottom:8px">
    <div class="bb-panel-head">ANALYST RATING METHODOLOGY <span class="ph-right">JWAL PREDICTIVE MODEL v1.0</span></div>
    <div class="bb-body" style="font-size:9px;color:#555;line-height:1.8">
      <span style="color:#ff6600">BASE:</span> Untappd global avg (50%) &nbsp;Â·&nbsp;
      <span style="color:#00aaff">STYLE FACTOR:</span> JWAL's historical avg for that style vs global avg (25%) &nbsp;Â·&nbsp;
      <span style="color:#bb44ff">COUNTRY FACTOR:</span> JWAL's avg for that origin country vs global avg (15%) &nbsp;Â·&nbsp;
      <span style="color:#00cc44">METHOD BONUS:</span> Draft +0.10 / Nitro +0.05 / Bottle Â±0 / Can âˆ’0.10 (10%) &nbsp;Â·&nbsp;
      <span style="color:#c9a84c">RANGE:</span> Clamped 1.0â€“5.0
    </div>
  </div>

  <!-- WATCHLIST TABLE -->
  <div class="bb-panel" style="margin-bottom:8px">
    <div class="bb-panel-head">â—ˆ PRE-REVIEW WATCHLIST â€” PENDING IPO <span class="ph-right" id="ipo-watch-count">15 BEERS QUEUED</span></div>
    <div class="bb-body">
      <div style="overflow-x:auto">
        <table class="bb-table" id="ipoWatchTable">
          <thead><tr>
            <th style="width:36px"></th>
            <th>BEER</th>
            <th>STYLE</th>
            <th>ORIGIN</th>
            <th>BREWERY REGION</th>
            <th>EST. ABV</th>
            <th style="color:#bb44ff">MKT RATING <span style="font-weight:400;font-size:8px">(Untappd)</span></th>
            <th style="color:#00aaff">ANALYST TARGET <span style="font-weight:400;font-size:8px">(JWAL Model)</span></th>
            <th>UPSIDE/RISK</th>
            <th>STATUS</th>
          </tr></thead>
          <tbody id="ipoWatchBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- PRICED TABLE (fills when reviewed) -->
  <div class="bb-panel" style="margin-bottom:16px">
    <div class="bb-panel-head">âœ“ POST-REVIEW â€” PRICED <span class="ph-right" id="ipo-priced-count">0 BEERS</span></div>
    <div class="bb-body">
      <div style="overflow-x:auto">
        <table class="bb-table">
          <thead><tr>
            <th style="width:36px"></th>
            <th>BEER</th>
            <th>STYLE</th>
            <th>ORIGIN</th>
            <th style="color:#bb44ff">MKT RATING</th>
            <th style="color:#00aaff">ANALYST TARGET</th>
            <th style="color:#ff6600">JWAL PRICE</th>
            <th>vs ANALYST</th>
            <th>vs MARKET</th>
            <th>VERDICT</th>
          </tr></thead>
          <tbody id="ipoPricedBody"><tr><td colspan="10" style="color:#333;text-align:center;padding:20px">NO BEERS PRICED YET â€” WATCHLIST PENDING</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- PIPELINE RECOMMENDATIONS -->
  <div class="bb-panel" id="ipoRecsPanel" style="display:none;margin-bottom:16px">
    <div class="bb-panel-head">â—ˆ PIPELINE â€” RECOMMENDED REPLACEMENTS <span class="ph-right" id="ipo-recs-count">0 SLOTS</span></div>
    <div class="bb-body" style="font-size:9px;color:#555;line-height:1.6;margin-bottom:6px">
      <span style="color:#ff6600">AUTO-GENERATED</span> â€” one replacement recommended per priced slot &nbsp;Â·&nbsp;
      ranked by <span style="color:#00cc44">new market coverage</span> first, then <span style="color:#00aaff">new style</span>, then <span style="color:#bb44ff">Untappd consensus</span>
    </div>
    <div class="bb-body">
      <div style="overflow-x:auto">
        <table class="bb-table">
          <thead><tr>
            <th style="width:36px"></th>
            <th>BEER</th>
            <th>STYLE</th>
            <th>ORIGIN</th>
            <th>BREWERY REGION</th>
            <th>EST. ABV</th>
            <th style="color:#bb44ff">MKT RATING</th>
            <th style="color:#00aaff">ANALYST TARGET</th>
            <th>RATIONALE</th>
          </tr></thead>
          <tbody id="ipoRecsBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- â•â• FUTURES â•â• -->
  <div class="bb-panel-head" style="background:var(--orange);color:#000;font-size:9px;font-weight:700;padding:3px 8px;letter-spacing:1px;margin-bottom:8px">â—† FUTURES â€” MASS-MARKET PREDICTIVE PRICING</div>
  <div class="g4" style="margin-bottom:8px">
    <div class="kpi"><div class="kpi-val" id="ft-contracts" style="color:var(--orange)">10</div><div class="kpi-label">ACTIVE CONTRACTS</div></div>
    <div class="kpi"><div class="kpi-val up" id="ft-executed">0</div><div class="kpi-label">CONTRACTS EXECUTED</div></div>
    <div class="kpi"><div class="kpi-val" id="ft-beat" style="color:#00cc44">â€”</div><div class="kpi-label">BEAT FUTURES</div></div>
    <div class="kpi"><div class="kpi-val dn" id="ft-miss">â€”</div><div class="kpi-label">MISSED FUTURES</div></div>
  </div>

  <!-- METHODOLOGY -->
  <div class="bb-panel" style="margin-bottom:8px">
    <div class="bb-panel-head">FUTURES CONTRACT METHODOLOGY <span class="ph-right">MASS-MARKET PREDICTIVE PRICING</span></div>
    <div class="bb-body" style="font-size:9px;color:#555;line-height:1.8">
      Futures are priced contracts on mass-market American beers with sufficient historical data to model forward price. &nbsp;Â·&nbsp;
      <span style="color:#ff6600">FORMULA:</span> Weighted moving avg of all JWAL reviews + mean-reversion toward Untappd global avg (30%) + serving method adjustment &nbsp;Â·&nbsp;
      <span style="color:#00aaff">CONTRACT EXECUTES</span> automatically when a new review is entered for that beer â€” actual JWAL rating is compared to futures price &nbsp;Â·&nbsp;
      <span style="color:#00cc44">BEAT:</span> Actual â‰¥ Futures price &nbsp;Â·&nbsp; <span style="color:#ff2222">MISS:</span> Actual &lt; Futures price
    </div>
  </div>

  <!-- FUTURES CONTRACTS TABLE -->
  <div class="bb-panel" style="margin-bottom:8px">
    <div class="bb-panel-head">â—† ACTIVE FUTURES CONTRACTS <span class="ph-right">PENDING EXECUTION ON NEXT REVIEW</span></div>
    <div class="bb-body">
      <div style="overflow-x:auto">
        <table class="bb-table" id="ftContractTable">
          <thead><tr>
            <th style="width:36px"></th>
            <th>BEER</th>
            <th>STYLE</th>
            <th>REVIEWS</th>
            <th>JWAL AVG</th>
            <th style="color:#bb44ff">MKT RATING</th>
            <th style="color:#ff6600">FUTURES PRICE</th>
            <th>52W HIGH</th>
            <th>52W LOW</th>
            <th>VOLATILITY</th>
            <th>SIGNAL</th>
          </tr></thead>
          <tbody id="ftContractBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- EXECUTED CONTRACTS -->
  <div class="bb-panel">
    <div class="bb-panel-head">âœ“ EXECUTED CONTRACTS â€” SETTLEMENT HISTORY <span class="ph-right" id="ft-exec-count">0 EXECUTED</span></div>
    <div class="bb-body">
      <div style="overflow-x:auto">
        <table class="bb-table">
          <thead><tr>
            <th></th><th>BEER</th><th>DATE</th><th style="color:#ff6600">FUTURES PRICE</th><th>ACTUAL</th><th>SPREAD</th><th>RESULT</th>
          </tr></thead>
          <tbody id="ftExecBody"><tr><td colspan="7" style="color:#333;text-align:center;padding:20px">NO CONTRACTS EXECUTED â€” FUTURES PRICE ON NEXT REVIEW</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• DATA AUDIT â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="audit" class="panel">
  <div class="g4" style="margin-bottom:8px">
    <div class="kpi">
      <div class="kpi-val" id="audit-status" style="color:var(--orange)">â€”</div>
      <div class="kpi-label">INTEGRITY STATUS</div>
    </div>
    <div class="kpi">
      <div class="kpi-val up" id="audit-pass">â€”</div>
      <div class="kpi-label">CHECKS PASSED</div>
    </div>
    <div class="kpi">
      <div class="kpi-val" id="audit-warn" style="color:#ffaa00">â€”</div>
      <div class="kpi-label">WARNINGS</div>
    </div>
    <div class="kpi">
      <div class="kpi-val dn" id="audit-fail">â€”</div>
      <div class="kpi-label">ERRORS</div>
    </div>
  </div>

  <div class="bb-panel" style="margin-bottom:8px">
    <div class="bb-panel-head">â¬¡ DATA INTEGRITY VALIDATOR <span class="ph-right" id="audit-ts">â€”</span></div>
    <div class="bb-body" style="font-size:9px;color:#555;line-height:1.8">
      <span style="color:#ff6600">RUNS AUTOMATICALLY</span> on every page load â€” catches bad data before it becomes a visible bug. &nbsp;Â·&nbsp;
      <span style="color:#00aaff">10 CHECK CATEGORIES:</span> field completeness Â· rating ranges Â· logo coverage Â· brewery accuracy Â· map coordinates Â· futures contracts Â· IPO watchlist Â· flag/name symmetry Â· DOM presence Â· cc/origin mapping &nbsp;Â·&nbsp;
      <span style="color:#00cc44">GREEN DOT</span> = all clear &nbsp;Â·&nbsp;
      <span style="color:#ffaa00">AMBER DOT</span> = warnings &nbsp;Â·&nbsp;
      <span style="color:#ff2222">RED DOT</span> = errors &nbsp;Â·&nbsp;
      Full report also logged to <span style="color:#bb44ff">browser console</span>
    </div>
  </div>

  <div class="bb-panel" style="margin-bottom:8px">
    <div class="bb-panel-head">WHAT EACH CHECK COVERS <span class="ph-right">FUTURE-UPDATE GUIDE</span></div>
    <div class="bb-body">
      <table class="bb-table">
        <thead><tr><th>#</th><th>CHECK</th><th>CATCHES</th><th>TRIGGERED BY</th></tr></thead>
        <tbody>
          <tr><td style="color:#ff6600">1</td><td>Beer Field Completeness</td><td style="color:#555;font-size:9px">Missing beer/style/origin/abv/method/city/region/country/cc/rating/isNew/month/monthN/year</td><td style="color:#555;font-size:9px">Adding a new beer entry</td></tr>
          <tr><td style="color:#ff6600">2</td><td>Beer Data Ranges</td><td style="color:#555;font-size:9px">Rating &lt;1 or &gt;5 Â· ABV &gt;20% Â· Invalid method string Â· Bad month name or number</td><td style="color:#555;font-size:9px">Typo in rating/ABV/method/month</td></tr>
          <tr><td style="color:#ff6600">3</td><td>Brand Logo Coverage</td><td style="color:#555;font-size:9px">Beer in data with no SVG logo â†’ shows broken ğŸº placeholder</td><td style="color:#555;font-size:9px">Adding new beer not in BRAND_SVGS</td></tr>
          <tr><td style="color:#ff6600">4</td><td>Brewery Array</td><td style="color:#555;font-size:9px">Missing fields Â· coordinates out of range Â· empty ratings array Â· beer name not in dataset</td><td style="color:#555;font-size:9px">Editing breweries or adding a brewer</td></tr>
          <tr><td style="color:#ff6600">5</td><td>Consumption Locations</td><td style="color:#555;font-size:9px">drunkLoc with no matching beer reviews Â· bad lat/lng Â· missing cc</td><td style="color:#555;font-size:9px">Adding new city or removing beers from a city</td></tr>
          <tr><td style="color:#ff6600">6</td><td>Futures Coverage</td><td style="color:#555;font-size:9px">Futures contract beer with zero review history â†’ can't price</td><td style="color:#555;font-size:9px">First review of a futures beer</td></tr>
          <tr><td style="color:#ff6600">7</td><td>IPO Watchlist</td><td style="color:#555;font-size:9px">IPO beer with no SVG logo Â· tracks pending vs priced count</td><td style="color:#555;font-size:9px">Reviewing a watchlist beer or adding new ones</td></tr>
          <tr><td style="color:#ff6600">8</td><td>FLAGS / CNAMES Symmetry</td><td style="color:#555;font-size:9px">Country code in one dict but not the other â†’ flag shows but name missing or vice versa</td><td style="color:#555;font-size:9px">Adding a new country to either dict</td></tr>
          <tr><td style="color:#ff6600">9</td><td>DOM Element Presence</td><td style="color:#555;font-size:9px">JS references an element that no longer exists in HTML</td><td style="color:#555;font-size:9px">Editing HTML structure</td></tr>
          <tr><td style="color:#ff6600">10</td><td>CC / Origin Mapping</td><td style="color:#555;font-size:9px">Beer cc or origin code not in FLAGS â†’ flag emoji missing on all tables</td><td style="color:#555;font-size:9px">Adding beer from new country</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="bb-panel">
    <div class="bb-panel-head">FULL CHECK RESULTS <span class="ph-right">LIVE REPORT</span></div>
    <div class="bb-body" id="auditBody" style="max-height:500px;overflow-y:auto">
      <div style="color:#333;text-align:center;padding:20px;font-size:9px">Loading audit results...</div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• COMMENTS PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel" id="comments">
  <div class="bb-panel" style="margin-bottom:16px">
    <div class="bb-panel-head">âœ NOTES &amp; COMMENTS <span class="ph-right" id="comment-count">0 ENTRIES</span></div>
    <div class="bb-body">
      <div style="display:flex;gap:8px;margin-bottom:12px;align-items:flex-start">
        <div style="flex:1">
          <div style="font-size:9px;color:#555;letter-spacing:1px;margin-bottom:4px">BEER / SUBJECT</div>
          <input id="comment-subject" type="text" placeholder="e.g. Estrella Damm, general note..." style="width:100%;background:#0a0a0a;border:1px solid #222;color:#e8e8e8;font-family:var(--mono);font-size:11px;padding:6px 8px;outline:none" onfocus="this.style.borderColor='#ff6600'" onblur="this.style.borderColor='#222'">
        </div>
        <div style="flex:2">
          <div style="font-size:9px;color:#555;letter-spacing:1px;margin-bottom:4px">COMMENT</div>
          <input id="comment-text" type="text" placeholder="Write your note..." style="width:100%;background:#0a0a0a;border:1px solid #222;color:#e8e8e8;font-family:var(--mono);font-size:11px;padding:6px 8px;outline:none" onfocus="this.style.borderColor='#ff6600'" onblur="this.style.borderColor='#222'" onkeydown="if(event.key==='Enter')addComment()">
        </div>
        <div style="display:flex;flex-direction:column;justify-content:flex-end">
          <div style="font-size:9px;color:transparent;margin-bottom:4px">.</div>
          <button onclick="addComment()" style="background:var(--orange);color:#000;border:none;font-family:var(--mono);font-size:11px;font-weight:700;padding:6px 14px;cursor:pointer;letter-spacing:1px" onmouseover="this.style.background='#ff8833'" onmouseout="this.style.background='var(--orange)'">POST</button>
        </div>
      </div>
      <div id="comment-list" style="max-height:520px;overflow-y:auto">
        <div style="color:#333;text-align:center;padding:30px;font-size:9px">NO NOTES YET â€” ADD ONE ABOVE</div>
      </div>
    </div>
  </div>
  <div class="bb-panel">
    <div class="bb-panel-head">â¬¡ DATA EXPORT</div>
    <div class="bb-body" style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
      <button onclick="exportData('json')" style="background:var(--orange);color:#000;border:none;font-family:var(--mono);font-size:10px;font-weight:700;padding:6px 14px;cursor:pointer;letter-spacing:1px">EXPORT JSON</button>
      <button onclick="exportData('csv')" style="background:var(--border2);color:var(--orange);border:1px solid var(--border);font-family:var(--mono);font-size:10px;font-weight:700;padding:6px 14px;cursor:pointer;letter-spacing:1px">EXPORT CSV</button>
      <span style="font-size:9px;color:#555" id="exportCount">Downloads all beer reviews</span>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ADD NEW BEER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel" id="addnew">
  <div class="bb-panel" style="margin-bottom:8px">
    <div class="bb-panel-head">+ LOG NEW BEER REVIEW <span class="ph-right" id="addnew-count">0 LOGGED THIS SESSION</span></div>
    <div class="bb-body">
      <div class="g3" style="margin-bottom:8px">
        <div>
          <div style="font-size:9px;color:#555;letter-spacing:1px;margin-bottom:4px">BEER NAME *</div>
          <input id="an-beer" type="text" placeholder="e.g. Peroni" style="width:100%;background:#0a0a0a;border:1px solid #222;color:#e8e8e8;font-family:var(--mono);font-size:11px;padding:6px 8px;outline:none" onfocus="this.style.borderColor='#ff6600'" onblur="this.style.borderColor='#222'">
        </div>
        <div>
          <div style="font-size:9px;color:#555;letter-spacing:1px;margin-bottom:4px">STYLE *</div>
          <input id="an-style" type="text" placeholder="e.g. Lager-Pale" style="width:100%;background:#0a0a0a;border:1px solid #222;color:#e8e8e8;font-family:var(--mono);font-size:11px;padding:6px 8px;outline:none" onfocus="this.style.borderColor='#ff6600'" onblur="this.style.borderColor='#222'">
        </div>
        <div>
          <div style="font-size:9px;color:#555;letter-spacing:1px;margin-bottom:4px">RATING (1â€“5) *</div>
          <input id="an-rating" type="number" min="1" max="5" step="0.25" placeholder="e.g. 3.75" style="width:100%;background:#0a0a0a;border:1px solid #222;color:#e8e8e8;font-family:var(--mono);font-size:11px;padding:6px 8px;outline:none" onfocus="this.style.borderColor='#ff6600'" onblur="this.style.borderColor='#222'">
        </div>
      </div>
      <div class="g3" style="margin-bottom:8px">
        <div>
          <div style="font-size:9px;color:#555;letter-spacing:1px;margin-bottom:4px">ORIGIN (CC) *</div>
          <input id="an-origin" type="text" placeholder="e.g. IT" maxlength="2" style="width:100%;background:#0a0a0a;border:1px solid #222;color:#e8e8e8;font-family:var(--mono);font-size:11px;padding:6px 8px;outline:none;text-transform:uppercase" onfocus="this.style.borderColor='#ff6600'" onblur="this.style.borderColor='#222'">
        </div>
        <div>
          <div style="font-size:9px;color:#555;letter-spacing:1px;margin-bottom:4px">ABV (%) *</div>
          <input id="an-abv" type="number" min="0" max="20" step="0.1" placeholder="e.g. 5.1" style="width:100%;background:#0a0a0a;border:1px solid #222;color:#e8e8e8;font-family:var(--mono);font-size:11px;padding:6px 8px;outline:none" onfocus="this.style.borderColor='#ff6600'" onblur="this.style.borderColor='#222'">
        </div>
        <div>
          <div style="font-size:9px;color:#555;letter-spacing:1px;margin-bottom:4px">METHOD *</div>
          <select id="an-method" style="width:100%;background:#0a0a0a;border:1px solid #222;color:#e8e8e8;font-family:var(--mono);font-size:11px;padding:6px 8px;outline:none">
            <option value="Draft">Draft</option>
            <option value="Bottle">Bottle</option>
            <option value="Can">Can</option>
            <option value="Nitro">Nitro</option>
          </select>
        </div>
      </div>
      <div class="g3" style="margin-bottom:12px">
        <div>
          <div style="font-size:9px;color:#555;letter-spacing:1px;margin-bottom:4px">CITY *</div>
          <input id="an-city" type="text" placeholder="e.g. New York" style="width:100%;background:#0a0a0a;border:1px solid #222;color:#e8e8e8;font-family:var(--mono);font-size:11px;padding:6px 8px;outline:none" onfocus="this.style.borderColor='#ff6600'" onblur="this.style.borderColor='#222'">
        </div>
        <div>
          <div style="font-size:9px;color:#555;letter-spacing:1px;margin-bottom:4px">REGION *</div>
          <input id="an-region" type="text" placeholder="e.g. New York" style="width:100%;background:#0a0a0a;border:1px solid #222;color:#e8e8e8;font-family:var(--mono);font-size:11px;padding:6px 8px;outline:none" onfocus="this.style.borderColor='#ff6600'" onblur="this.style.borderColor='#222'">
        </div>
        <div>
          <div style="font-size:9px;color:#555;letter-spacing:1px;margin-bottom:4px">COUNTRY *</div>
          <input id="an-country" type="text" placeholder="e.g. USA" style="width:100%;background:#0a0a0a;border:1px solid #222;color:#e8e8e8;font-family:var(--mono);font-size:11px;padding:6px 8px;outline:none" onfocus="this.style.borderColor='#ff6600'" onblur="this.style.borderColor='#222'">
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <button onclick="submitNewBeer()" style="background:var(--orange);color:#000;border:none;font-family:var(--mono);font-size:11px;font-weight:700;padding:7px 20px;cursor:pointer;letter-spacing:1px">LOG REVIEW</button>
        <button onclick="clearNewBeerForm()" style="background:var(--border2);color:var(--dim);border:1px solid var(--border);font-family:var(--mono);font-size:10px;padding:7px 14px;cursor:pointer;letter-spacing:1px">CLEAR</button>
        <span id="an-msg" style="font-size:9px;color:#555"></span>
      </div>
    </div>
  </div>
  <div class="bb-panel">
    <div class="bb-panel-head">SESSION LOG <span class="ph-right">PENDING INTEGRATION INTO DATA FILE</span></div>
    <div class="bb-body">
      <div id="an-log" style="max-height:400px;overflow-y:auto">
        <div style="color:#333;font-size:9px;text-align:center;padding:20px">NO REVIEWS LOGGED THIS SESSION</div>
      </div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button onclick="exportNewBeers()" id="an-export-btn" style="display:none;background:var(--orange);color:#000;border:none;font-family:var(--mono);font-size:10px;font-weight:700;padding:6px 14px;cursor:pointer;letter-spacing:1px">EXPORT SESSION JSON</button>
        <button onclick="clearNewBeers()" id="an-clear-btn" style="display:none;background:var(--border2);color:var(--dim);border:1px solid var(--border);font-family:var(--mono);font-size:10px;padding:6px 14px;cursor:pointer;letter-spacing:1px">CLEAR SESSION LOG</button>
      </div>
      <div style="margin-top:8px;font-size:9px;color:#333">Reviews logged here are saved in your browser. Export the JSON and paste entries into the <code style="color:#ff6600">beers</code> array in the HTML to make them permanent.</div>
    </div>
  </div>
</div>

</div><!-- /main -->
</div><!-- /terminal-body -->

<!-- STATUS BAR -->

<div id="statusbar">
  <div class="sb-item"><div class="sb-dot"></div>LIVE</div>
  <div class="sb-item">SYS: JWAL'S BREW TERMINAL v2.7</div>
  <div class="sb-item">USER: JWAL</div>
  <div class="sb-item">RECORDS: 31 Â· BRANDS: 25 Â· MKTS: 8 Â· WATCHLIST: 13</div>
  <div class="sb-spacer"></div>
  <div class="sb-item" id="sb-time">--:--:--</div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const FLAGS={ES:"ğŸ‡ªğŸ‡¸",DE:"ğŸ‡©ğŸ‡ª",IE:"ğŸ‡®ğŸ‡ª",JM:"ğŸ‡¯ğŸ‡²",BE:"ğŸ‡§ğŸ‡ª",JP:"ğŸ‡¯ğŸ‡µ",NL:"ğŸ‡³ğŸ‡±",FR:"ğŸ‡«ğŸ‡·",MX:"ğŸ‡²ğŸ‡½",CA:"ğŸ‡¨ğŸ‡¦",DK:"ğŸ‡©ğŸ‡°",US:"ğŸ‡ºğŸ‡¸",IT:"ğŸ‡®ğŸ‡¹",BR:"ğŸ‡§ğŸ‡·",CN:"ğŸ‡¨ğŸ‡³",ZA:"ğŸ‡¿ğŸ‡¦",GR:"ğŸ‡¬ğŸ‡·",AU:"ğŸ‡¦ğŸ‡º",SE:"ğŸ‡¸ğŸ‡ª",CZ:"ğŸ‡¨ğŸ‡¿",PT:"ğŸ‡µğŸ‡¹",AR:"ğŸ‡¦ğŸ‡·",GB:"ğŸ‡¬ğŸ‡§",NO:"ğŸ‡³ğŸ‡´",PL:"ğŸ‡µğŸ‡±"};
const CNAMES={DE:"Germany",IE:"Ireland",JM:"Jamaica",BE:"Belgium",JP:"Japan",NL:"Netherlands",FR:"France",MX:"Mexico",CA:"Canada",DK:"Denmark",US:"USA",IT:"Italy",ES:"Spain",BR:"Brazil",CN:"China",ZA:"South Africa",GR:"Greece",AU:"Australia",SE:"Sweden",CZ:"Czech Republic",PT:"Portugal",AR:"Argentina",GB:"Great Britain",NO:"Norway",PL:"Poland"};

const beers=[
  // JAN 2026 (17 beers)
  {beer:"Grolsch",         style:"Pilsner-Other",            origin:"NL",abv:5.0,method:"Bottle",city:"Hengelo",     region:"Overijssel",      country:"Netherlands", cc:"NL", rating:3.50,isNew:false,month:"Jan",monthN:1,year:2026},
  {beer:"Hertog Jan",      style:"Pilsner-Other",            origin:"NL",abv:5.1,method:"Bottle",city:"Hengelo",     region:"Overijssel",      country:"Netherlands", cc:"NL", rating:2.00,isNew:false,month:"Jan",monthN:1,year:2026},
  {beer:"Coors Light",     style:"Lager-American",           origin:"US",abv:4.2,method:"Can",   city:"New Rochelle",region:"New York",        country:"USA",         cc:"US", rating:3.00,isNew:false,month:"Jan",monthN:1,year:2026},
  {beer:"Sapporo",         style:"Lager-Pale",               origin:"JP",abv:4.9,method:"Bottle",city:"Hartsdale",   region:"New York",        country:"USA",         cc:"US", rating:3.50,isNew:false,month:"Jan",monthN:1,year:2026},
  {beer:"Ichiban",         style:"Lager-Pale",               origin:"JP",abv:5.0,method:"Bottle",city:"Hartsdale",   region:"New York",        country:"USA",         cc:"US", rating:3.00,isNew:false,month:"Jan",monthN:1,year:2026},
  {beer:"Modelo",          style:"Lager-Mexican",            origin:"MX",abv:4.5,method:"Bottle",city:"White Plains",region:"New York",        country:"USA",         cc:"US", rating:3.25,isNew:false,month:"Jan",monthN:1,year:2026},
  {beer:"Stella Artois",   style:"Lager-Pale",               origin:"BE",abv:5.0,method:"Bottle",city:"Eastchester", region:"New York",        country:"USA",         cc:"US", rating:2.75,isNew:false,month:"Jan",monthN:1,year:2026},
  {beer:"Duvel",           style:"Belgian Strong Golden Ale",origin:"BE",abv:8.5,method:"Bottle",city:"White Plains",region:"New York",        country:"USA",         cc:"US", rating:4.00,isNew:false,month:"Jan",monthN:1,year:2026},
  {beer:"Duvel",           style:"Belgian Strong Golden Ale",origin:"BE",abv:8.5,method:"Bottle",city:"Amsterdam",   region:"Noord-Holland",   country:"Netherlands", cc:"NL", rating:4.25,isNew:false,month:"Jan",monthN:1,year:2026},
  {beer:"Carlsberg",       style:"Pilsner-Other",            origin:"DK",abv:5.0,method:"Can",   city:"New Rochelle",region:"New York",        country:"USA",         cc:"US", rating:2.75,isNew:false,month:"Jan",monthN:1,year:2026},
  {beer:"Carlsberg",       style:"Lager-Pale",               origin:"DK",abv:5.0,method:"Draft", city:"Montreal",    region:"Quebec",          country:"Canada",      cc:"CA", rating:3.00,isNew:false,month:"Jan",monthN:1,year:2026},
  {beer:"Harp",            style:"Lager-Pale",               origin:"IE",abv:4.5,method:"Draft", city:"Montreal",    region:"Quebec",          country:"Canada",      cc:"CA", rating:4.25,isNew:false,month:"Jan",monthN:1,year:2026},
  {beer:"La Fin Du Monde", style:"Belgian Tripel",           origin:"CA",abv:9.0,method:"Can",   city:"Montreal",    region:"Quebec",          country:"Canada",      cc:"CA", rating:2.75,isNew:false,month:"Jan",monthN:1,year:2026},
  {beer:"1664",            style:"Lager-Pale",               origin:"FR",abv:5.5,method:"Draft", city:"Montreal",    region:"Quebec",          country:"Canada",      cc:"CA", rating:3.00,isNew:false,month:"Jan",monthN:1,year:2026},
  {beer:"Michelob Ultra",  style:"Lager-American",           origin:"US",abv:4.2,method:"Can",   city:"White Plains",region:"New York",        country:"USA",         cc:"US", rating:2.50,isNew:false,month:"Jan",monthN:1,year:2026},
  {beer:"Guinness",        style:"Stout-Irish Dry",          origin:"IE",abv:4.2,method:"Nitro", city:"New York",    region:"New York",        country:"USA",         cc:"US", rating:3.25,isNew:false,month:"Jan",monthN:1,year:2026},
  {beer:"Red Stripe",      style:"Lager-Pale",               origin:"JM",abv:4.7,method:"Bottle",city:"New Rochelle",region:"New York",        country:"USA",         cc:"US", rating:3.75,isNew:false,month:"Jan",monthN:1,year:2026},
  // FEB 2026 (12 beers)
  {beer:"Heineken",        style:"Lager-Pale",               origin:"NL",abv:5.0,method:"Draft", city:"New York",    region:"New York",        country:"USA",         cc:"US", rating:3.25,isNew:false,month:"Feb",monthN:2,year:2026},
  {beer:"Guinness",        style:"Stout-Irish Dry",          origin:"IE",abv:4.2,method:"Nitro", city:"Eastchester", region:"New York",        country:"USA",         cc:"US", rating:4.00,isNew:false,month:"Feb",monthN:2,year:2026},
  {beer:"Weihenstephaner", style:"Wheat Beer-Hefeweizen",    origin:"DE",abv:5.4,method:"Bottle",city:"New Rochelle",region:"New York",        country:"USA",         cc:"US", rating:4.50,isNew:false,month:"Feb",monthN:2,year:2026},
  {beer:"Modelo Negra",    style:"Lager-Munich Dunkel",      origin:"MX",abv:5.4,method:"Bottle",city:"New Rochelle",region:"New York",        country:"USA",         cc:"US", rating:2.25,isNew:false,month:"Feb",monthN:2,year:2026},
  {beer:"MÃ¼chner Weisse",  style:"Wheat Beer-Hefeweizen",    origin:"DE",abv:5.1,method:"Draft", city:"New York",    region:"New York",        country:"USA",         cc:"US", rating:4.75,isNew:false,month:"Feb",monthN:2,year:2026},
  {beer:"Modelo Negra",    style:"Lager-Munich Dunkel",      origin:"MX",abv:5.4,method:"Bottle",city:"New Rochelle",region:"New York",        country:"USA",         cc:"US", rating:3.00,isNew:false,month:"Feb",monthN:2,year:2026},
  {beer:"Stella Artois",   style:"Lager-Pale",               origin:"BE",abv:5.0,method:"Bottle",city:"New Rochelle",region:"New York",        country:"USA",         cc:"US", rating:2.75,isNew:false,month:"Feb",monthN:2,year:2026},
  {beer:"Munchen Dunkel",  style:"Lager-Munich Dunkel",      origin:"DE",abv:5.5,method:"Draft", city:"New York",    region:"New York",        country:"USA",         cc:"US", rating:2.75,isNew:false,month:"Feb",monthN:2,year:2026},
  {beer:"Bud Light",       style:"Lager-American Light",     origin:"US",abv:4.2,method:"Bottle",city:"New York",    region:"New York",        country:"USA",         cc:"US", rating:3.00,isNew:true, month:"Feb",monthN:2,year:2026},
  {beer:"Budweiser",       style:"Lager-American",           origin:"US",abv:5.0,method:"Bottle",city:"New York",    region:"New York",        country:"USA",         cc:"US", rating:3.00,isNew:true, month:"Feb",monthN:2,year:2026},
  {beer:"Corona Extra",    style:"Lager-Mexican",            origin:"MX",abv:4.5,method:"Bottle",city:"New Rochelle",region:"New York",        country:"USA",         cc:"US", rating:3.00,isNew:true, month:"Feb",monthN:2,year:2026},
  {beer:"Corona Extra",    style:"Lager-Mexican",            origin:"MX",abv:4.5,method:"Bottle",city:"New Rochelle",region:"New York",        country:"USA",         cc:"US", rating:3.75,isNew:false,month:"Feb",monthN:2,year:2026},
  // MAR 2026
  {beer:"Estrella Galicia",style:"Lager-Helles",              origin:"ES",abv:5.5,method:"Bottle",city:"New Rochelle",region:"New York",        country:"USA",         cc:"US", rating:4.25,isNew:true, month:"Mar",monthN:3,year:2026},
  {beer:"Pilsner Urquell", style:"Pilsner-Other",             origin:"CZ",abv:4.4,method:"Bottle",city:"New Rochelle",region:"New York",        country:"USA",         cc:"US", rating:3.25,isNew:true, month:"Mar",monthN:3,year:2026},
];

const drunkLocs=[
  {city:"New York",    region:"New York",             country:"USA",         cc:"US", lat:40.7128,lng:-74.0060},
  {city:"New Rochelle",region:"New York",             country:"USA",         cc:"US", lat:40.9115,lng:-73.7826},
  {city:"White Plains",region:"New York",             country:"USA",         cc:"US", lat:41.0340,lng:-73.7629},
  {city:"Eastchester", region:"New York",             country:"USA",         cc:"US", lat:40.9565,lng:-73.8115},
  {city:"Hartsdale",   region:"New York",             country:"USA",         cc:"US", lat:41.0215,lng:-73.7987},
  {city:"Montreal",    region:"Quebec",               country:"Canada",      cc:"CA", lat:45.5017,lng:-73.5673},
  {city:"Amsterdam",   region:"Noord-Holland",        country:"Netherlands", cc:"NL", lat:52.3676,lng:4.9041},
  {city:"Hengelo",     region:"Overijssel",           country:"Netherlands", cc:"NL", lat:52.2660,lng:6.7930},
];

const breweries=[
  {name:"Weihenstephaner",        location:"Freising, Bavaria",         country:"Germany",     cc:"DE", beers:"Weihenstephaner Â· MÃ¼chner Weisse Â· Munchen Dunkel", lat:48.3953,lng:11.7291, ratings:[4.50,4.75,2.75]},
  {name:"Guinness (St. James's Gate)", location:"Dublin, Leinster",     country:"Ireland",     cc:"IE", beers:"Guinness",                                          lat:53.3418,lng:-6.2868, ratings:[3.25,4.00]},
  {name:"Harp / Diageo",          location:"Dundalk, County Louth",     country:"Ireland",     cc:"IE", beers:"Harp",                                              lat:54.0039,lng:-6.3703, ratings:[4.25]},
  {name:"Duvel Moortgat",         location:"Puurs-Sint-Amands, Antwerp",country:"Belgium",     cc:"BE", beers:"Duvel",                                             lat:51.0727,lng:4.2897,  ratings:[4.00,4.25]},
  {name:"AB InBev (Stella)",      location:"Leuven, Flemish Brabant",   country:"Belgium",     cc:"BE", beers:"Stella Artois",                                     lat:50.8798,lng:4.7005,  ratings:[2.75,2.75]},
  {name:"Heineken",               location:"Amsterdam, Noord-Holland",  country:"Netherlands", cc:"NL", beers:"Heineken",                                          lat:52.3578,lng:4.8918,  ratings:[3.25]},
  {name:"Grolsch",                location:"Enschede, Overijssel",      country:"Netherlands", cc:"NL", beers:"Grolsch",                                           lat:52.2215,lng:6.8937,  ratings:[3.50]},
  {name:"Bavaria NV (Hertog Jan)",location:"Arcen, Limburg",            country:"Netherlands", cc:"NL", beers:"Hertog Jan",                                        lat:51.4862,lng:6.1741,  ratings:[2.00]},
  {name:"Anheuser-Busch",         location:"St. Louis, Missouri",       country:"USA",         cc:"US", beers:"Budweiser Â· Bud Light Â· Michelob Ultra",            lat:38.6072,lng:-90.2124, ratings:[3.00,3.00,2.50]},
  {name:"Molson Coors",           location:"Golden, Colorado",          country:"USA",         cc:"US", beers:"Coors Light",                                       lat:39.7555,lng:-105.2211,ratings:[3.00]},
  {name:"Grupo Modelo",           location:"Mexico City, CDMX",         country:"Mexico",      cc:"MX", beers:"Modelo Â· Modelo Negra Â· Corona Extra",              lat:19.4274,lng:-99.1677, ratings:[3.25,2.25,3.00,3.00,3.75]},
  {name:"Carlsberg",              location:"Copenhagen, Capital Region",country:"Denmark",     cc:"DK", beers:"Carlsberg",                                         lat:55.6614,lng:12.5361,  ratings:[2.75,3.00]},
  {name:"Unibroue",               location:"Chambly, Quebec",           country:"Canada",      cc:"CA", beers:"La Fin Du Monde",                                   lat:45.4412,lng:-73.2615, ratings:[2.75]},
  {name:"Kronenbourg",            location:"Obernai, Alsace",           country:"France",      cc:"FR", beers:"1664",                                              lat:48.4637,lng:7.4845,  ratings:[3.00]},
  {name:"Sapporo Brewery",        location:"Sapporo, Hokkaido",         country:"Japan",       cc:"JP", beers:"Sapporo",                                           lat:43.0685,lng:141.3544, ratings:[3.50]},
  {name:"Kirin Brewery",          location:"Yokohama, Kanagawa",        country:"Japan",       cc:"JP", beers:"Ichiban (Kirin Ichiban)",                           lat:35.4634,lng:139.6220, ratings:[3.00]},
  {name:"Red Stripe (D&G)",       location:"Kingston, Surrey",          country:"Jamaica",     cc:"JM", beers:"Red Stripe",                                        lat:17.9972,lng:-76.7939, ratings:[3.75]},
  {name:"Estrella Galicia",       location:"A CoruÃ±a, Galicia",         country:"Spain",       cc:"ES", beers:"Estrella Galicia",                                   lat:43.3623,lng:-8.4115,  ratings:[4.25]},
  {name:"Pilsner Urquell",        location:"Pilsen, Bohemia",           country:"Czech Republic",cc:"CZ", beers:"Pilsner Urquell",                                    lat:49.7479,lng:13.3756,  ratings:[3.25]},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BRAND SVGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BRAND_SVGS = {
"Heineken":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#0a0a0a"/><text x="10" y="43" font-family="Arial Black,sans-serif" font-size="38" font-weight="900" fill="#00862E" letter-spacing="-1">Heineken</text><polygon points="178,4 182,16 194,16 184,23 188,35 178,28 168,35 172,23 162,16 174,16" fill="#FF0000"/></svg>`,
"Guinness":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#0a0a0a"/><rect x="2" y="2" width="196" height="56" rx="0" fill="none" stroke="#c9a84c" stroke-width="1"/><text x="100" y="37" font-family="Georgia,serif" font-size="24" font-weight="bold" fill="#c9a84c" text-anchor="middle" letter-spacing="1">GUINNESS</text><text x="100" y="52" font-family="Georgia,serif" font-size="8" fill="#555" text-anchor="middle" letter-spacing="3">EXTRA STOUT</text></svg>`,
"Stella Artois":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#0a0a0a"/><text x="100" y="26" font-family="Times New Roman,serif" font-size="17" font-weight="bold" fill="#1a3a8f" text-anchor="middle" letter-spacing="2">STELLA ARTOIS</text><line x1="10" y1="32" x2="190" y2="32" stroke="#c9a84c" stroke-width="1"/><text x="100" y="48" font-family="Times New Roman,serif" font-size="12" fill="#c9a84c" text-anchor="middle" letter-spacing="4">LAGER</text></svg>`,
"Budweiser":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#CC0000"/><text x="100" y="42" font-family="Arial,sans-serif" font-size="28" font-weight="900" fill="#fff" text-anchor="middle" letter-spacing="0.5">Budweiser</text></svg>`,
"Bud Light":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#0055A5"/><text x="100" y="28" font-family="Arial,sans-serif" font-size="20" font-weight="900" fill="#fff" text-anchor="middle">BUD</text><text x="100" y="52" font-family="Arial,sans-serif" font-size="17" font-weight="700" fill="#c9a84c" text-anchor="middle" letter-spacing="2">LIGHT</text></svg>`,
"Coors Light":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#002868"/><text x="100" y="28" font-family="Arial,sans-serif" font-size="16" font-weight="900" fill="#fff" text-anchor="middle" letter-spacing="2">COORS</text><text x="100" y="50" font-family="Arial,sans-serif" font-size="14" font-weight="700" fill="#a8d8f0" text-anchor="middle" letter-spacing="3">LIGHT</text></svg>`,
"Michelob Ultra":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#001233"/><text x="100" y="24" font-family="Arial,sans-serif" font-size="9" fill="#6ba3d6" text-anchor="middle" letter-spacing="4">MICHELOB</text><text x="100" y="50" font-family="Arial Black,sans-serif" font-size="22" font-weight="900" fill="#fff" text-anchor="middle" letter-spacing="3">ULTRA</text></svg>`,
"Carlsberg":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#0a0a0a"/><text x="100" y="42" font-family="Georgia,serif" font-size="30" font-weight="bold" fill="#1a6b1a" text-anchor="middle">Carlsberg</text></svg>`,
"Modelo":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#002868"/><text x="100" y="22" font-family="Times New Roman,serif" font-size="9" fill="#c9a84c" text-anchor="middle" letter-spacing="3">ESPECIAL</text><text x="100" y="50" font-family="Times New Roman,serif" font-size="28" font-weight="bold" fill="#c9a84c" text-anchor="middle">Modelo</text></svg>`,
"Modelo Negra":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#1a0900"/><text x="100" y="22" font-family="Times New Roman,serif" font-size="9" fill="#c9a84c" text-anchor="middle" letter-spacing="3">MODELO</text><text x="100" y="50" font-family="Times New Roman,serif" font-size="24" font-weight="bold" fill="#c9a84c" text-anchor="middle" letter-spacing="2">NEGRA</text></svg>`,
"Corona Extra":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#0a0a0a"/><text x="100" y="26" font-family="Times New Roman,serif" font-size="18" font-weight="bold" fill="#f4e04d" text-anchor="middle" letter-spacing="1">CORONA</text><line x1="20" y1="32" x2="180" y2="32" stroke="#f4e04d" stroke-width="0.8"/><text x="100" y="50" font-family="Times New Roman,serif" font-size="12" fill="#f4e04d" text-anchor="middle" letter-spacing="3">EXTRA</text></svg>`,
"Sapporo":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#000066"/><polygon points="30,8 34,22 48,22 37,30 41,44 30,36 19,44 23,30 12,22 26,22" fill="#c9a84c"/><text x="120" y="38" font-family="Arial Black,sans-serif" font-size="16" font-weight="900" fill="#fff" text-anchor="middle">SAPPORO</text></svg>`,
"Ichiban":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#CC0000"/><text x="100" y="22" font-family="Arial,sans-serif" font-size="9" fill="#fff" text-anchor="middle" letter-spacing="2">SAPPORO</text><text x="100" y="48" font-family="Arial Black,sans-serif" font-size="22" font-weight="900" fill="#fff" text-anchor="middle">ICHIBAN</text></svg>`,
"Grolsch":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#0a0a0a"/><text x="100" y="44" font-family="Georgia,serif" font-size="34" font-weight="bold" fill="#1a7b1a" text-anchor="middle">Grolsch</text></svg>`,
"Duvel":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#CC0000"/><text x="100" y="46" font-family="Georgia,serif" font-size="40" font-weight="bold" fill="#fff" text-anchor="middle" letter-spacing="2">DUVEL</text></svg>`,
"La Fin Du Monde":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#5a2d00"/><text x="100" y="22" font-family="Georgia,serif" font-size="11" fill="#f0e68c" text-anchor="middle" letter-spacing="2">LA FIN DU MONDE</text><line x1="20" y1="28" x2="180" y2="28" stroke="#c9a84c" stroke-width="0.5"/><text x="100" y="45" font-family="Georgia,serif" font-size="10" fill="#d4a84c" text-anchor="middle" letter-spacing="1">UNIBROUE Â· QUÃ‰BEC</text></svg>`,
"1664":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#002366"/><text x="100" y="46" font-family="Georgia,serif" font-size="42" font-weight="bold" fill="#c9a84c" text-anchor="middle">1664</text></svg>`,
"Red Stripe":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#CC0000"/><text x="100" y="24" font-family="Arial Black,sans-serif" font-size="18" font-weight="900" fill="#fff" text-anchor="middle" letter-spacing="2">RED</text><text x="100" y="50" font-family="Arial Black,sans-serif" font-size="18" font-weight="900" fill="#fff" text-anchor="middle" letter-spacing="1">STRIPE</text></svg>`,
"Harp":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#002868"/><text x="85" y="42" font-family="Georgia,serif" font-size="32" font-weight="bold" fill="#fff" text-anchor="middle" letter-spacing="2">HARP</text><text x="165" y="22" font-family="Georgia,serif" font-size="32" fill="#c9a84c">â™¦</text></svg>`,
"Weihenstephaner":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#003d8f"/><text x="100" y="26" font-family="Georgia,serif" font-size="11" font-weight="bold" fill="#fff" text-anchor="middle" letter-spacing="0.5">WEIHENSTEPHANER</text><line x1="10" y1="32" x2="190" y2="32" stroke="#c9a84c" stroke-width="0.8"/><text x="100" y="48" font-family="Georgia,serif" font-size="10" fill="#c9a84c" text-anchor="middle" letter-spacing="2">ANNO 1040</text></svg>`,
"MÃ¼chner Weisse":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#003d8f"/><text x="100" y="26" font-family="Georgia,serif" font-size="14" font-weight="bold" fill="#fff" text-anchor="middle" letter-spacing="1">MÃœCHNER</text><line x1="20" y1="34" x2="180" y2="34" stroke="#c9a84c" stroke-width="0.8"/><text x="100" y="52" font-family="Georgia,serif" font-size="14" font-weight="bold" fill="#c9a84c" text-anchor="middle" letter-spacing="1">WEISSE</text></svg>`,
"Munchen Dunkel":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#2a1400"/><text x="100" y="26" font-family="Georgia,serif" font-size="13" font-weight="bold" fill="#c9a84c" text-anchor="middle" letter-spacing="1">MUNCHEN</text><line x1="20" y1="34" x2="180" y2="34" stroke="#c9a84c" stroke-width="0.8"/><text x="100" y="52" font-family="Georgia,serif" font-size="13" font-weight="bold" fill="#e8d49a" text-anchor="middle" letter-spacing="1">DUNKEL</text></svg>`,
"Hertog Jan":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#6b0000"/><text x="100" y="22" font-family="Georgia,serif" font-size="11" fill="#c9a84c" text-anchor="middle" letter-spacing="2">HERTOG</text><line x1="30" y1="28" x2="170" y2="28" stroke="#c9a84c" stroke-width="0.8"/><text x="100" y="52" font-family="Georgia,serif" font-size="24" font-weight="bold" fill="#fff" text-anchor="middle" letter-spacing="3">JAN</text></svg>`,
// IPO BEERS
"Moretti":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#003399"/><text x="100" y="20" font-family="Georgia,serif" font-size="9" fill="#c9a84c" text-anchor="middle" letter-spacing="3">BIRRA</text><text x="100" y="46" font-family="Georgia,serif" font-size="28" font-weight="bold" fill="#c9a84c" text-anchor="middle" letter-spacing="1">Moretti</text></svg>`,
"Peroni":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#003399"/><text x="100" y="20" font-family="Arial,sans-serif" font-size="8" fill="#fff" text-anchor="middle" letter-spacing="3">NASTRO AZZURRO</text><text x="100" y="48" font-family="Georgia,serif" font-size="26" font-weight="bold" fill="#fff" text-anchor="middle" letter-spacing="2">PERONI</text></svg>`,
"Blue Moon":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#1a1a2e"/><circle cx="28" cy="30" r="18" fill="#f5a623" opacity="0.85"/><text x="115" y="27" font-family="Arial,sans-serif" font-size="14" font-weight="900" fill="#f5a623" text-anchor="middle">BLUE</text><text x="115" y="48" font-family="Arial,sans-serif" font-size="14" font-weight="900" fill="#fff" text-anchor="middle">MOON</text></svg>`,
"Miller Lite":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#003087"/><text x="100" y="26" font-family="Arial Black,sans-serif" font-size="18" font-weight="900" fill="#fff" text-anchor="middle" letter-spacing="1">MILLER</text><text x="100" y="50" font-family="Arial,sans-serif" font-size="16" font-weight="700" fill="#c9a84c" text-anchor="middle" letter-spacing="3">LITE</text></svg>`,
"Estrella Damm":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#c8102e"/><text x="100" y="24" font-family="Arial,sans-serif" font-size="10" fill="#fff" text-anchor="middle" letter-spacing="3">ESTRELLA</text><text x="100" y="50" font-family="Georgia,serif" font-size="20" font-weight="bold" fill="#f5d76e" text-anchor="middle" letter-spacing="3">DAMM</text></svg>`,
"Estrella Galicia":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#006633"/><text x="100" y="22" font-family="Arial,sans-serif" font-size="9" fill="#f5d76e" text-anchor="middle" letter-spacing="2">ESTRELLA</text><text x="100" y="48" font-family="Georgia,serif" font-size="18" font-weight="bold" fill="#f5d76e" text-anchor="middle" letter-spacing="1">GALICIA</text></svg>`,
"Brahma":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#ffd700"/><text x="100" y="42" font-family="Arial Black,sans-serif" font-size="30" font-weight="900" fill="#003087" text-anchor="middle" letter-spacing="2">BRAHMA</text></svg>`,
"Quilmes":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#003087"/><text x="100" y="20" font-family="Arial,sans-serif" font-size="8" fill="#c9a84c" text-anchor="middle" letter-spacing="3">CERVEZA</text><text x="100" y="48" font-family="Arial Black,sans-serif" font-size="24" font-weight="900" fill="#fff" text-anchor="middle" letter-spacing="2">QUILMES</text></svg>`,
"Tsingtao":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#006633"/><text x="100" y="42" font-family="Arial Black,sans-serif" font-size="22" font-weight="900" fill="#fff" text-anchor="middle" letter-spacing="1">TSINGTAO</text></svg>`,
"Castle Lager":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#c8102e"/><text x="100" y="22" font-family="Arial,sans-serif" font-size="8" fill="#ffd700" text-anchor="middle" letter-spacing="2">SOUTH AFRICAN</text><text x="100" y="48" font-family="Georgia,serif" font-size="18" font-weight="bold" fill="#ffd700" text-anchor="middle" letter-spacing="2">CASTLE LAGER</text></svg>`,
"Pilsner Urquell":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#003087"/><text x="100" y="21" font-family="Georgia,serif" font-size="10" fill="#c9a84c" text-anchor="middle" letter-spacing="2">PILSNER</text><line x1="20" y1="28" x2="180" y2="28" stroke="#c9a84c" stroke-width="0.8"/><text x="100" y="50" font-family="Georgia,serif" font-size="16" font-weight="bold" fill="#fff" text-anchor="middle" letter-spacing="1">URQUELL</text></svg>`,
"Super Bock":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#003087"/><text x="100" y="22" font-family="Arial Black,sans-serif" font-size="16" font-weight="900" fill="#fff" text-anchor="middle" letter-spacing="2">SUPER</text><text x="100" y="50" font-family="Arial Black,sans-serif" font-size="20" font-weight="900" fill="#c9a84c" text-anchor="middle" letter-spacing="3">BOCK</text></svg>`,
"Mythos":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#003087"/><text x="100" y="42" font-family="Georgia,serif" font-size="26" font-weight="bold" fill="#fff" text-anchor="middle" letter-spacing="2">MYTHOS</text></svg>`,
"Victoria Bitter":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#c8102e"/><text x="100" y="22" font-family="Arial Black,sans-serif" font-size="22" font-weight="900" fill="#ffd700" text-anchor="middle">VB</text><text x="100" y="48" font-family="Arial,sans-serif" font-size="11" fill="#fff" text-anchor="middle" letter-spacing="1">VICTORIA BITTER</text></svg>`,
"Norrlands Guld":`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60"><rect width="200" height="60" fill="#006AA7"/><text x="100" y="22" font-family="Arial,sans-serif" font-size="9" fill="#FECC02" text-anchor="middle" letter-spacing="2">NORRLANDS</text><text x="100" y="48" font-family="Georgia,serif" font-size="20" font-weight="bold" fill="#FECC02" text-anchor="middle" letter-spacing="2">GULD</text></svg>`,
};

const LOGO_URIS={};
Object.entries(BRAND_SVGS).forEach(([n,s])=>{LOGO_URIS[n]='data:image/svg+xml;charset=utf-8,'+encodeURIComponent(s);});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const sC={"Wheat Beer-Hefeweizen":"#ff6600","Belgian Strong Golden Ale":"#ffaa00","Stout-Irish Dry":"#888","Lager-Pale":"#00cc44","Lager-Mexican":"#00aa33","Pilsner-Other":"#00aaff","Belgian Tripel":"#bb44ff","Lager-Munich Dunkel":"#ff4400","Lager-American":"#555","Lager-American Light":"#444","Lager-Helles":"#22bb77"};
function rbC(r){return r>=4.5?"r5":r>=4?"r4":r>=3.5?"r35":r>=3?"r3":r>=2.5?"r25":"r2";}
function rC(r){return r>=4.5?"#00cc44":r>=4?"#22dd55":r>=3.5?"#aacc00":r>=3?"#ffaa00":r>=2.5?"#ff6600":"#ff2222";}
function strs(r){const f=Math.floor(r),h=(r%1)>=.5;return"â˜…".repeat(f)+(h?"Â½":"")+"â˜†".repeat(5-f-(h?1:0));}
const avg=a=>a.reduce((s,v)=>s+v,0)/a.length;
const std=a=>{const m=avg(a);return Math.sqrt(avg(a.map(v=>(v-m)**2)));};

function logoImg(name,size=24){
  const u=LOGO_URIS[name];
  return u?`<img src="${u}" class="beer-logo-inline" style="width:${size}px;height:${size}px" alt="${name}">`:`<span style="display:inline-block;width:${size}px;text-align:center;font-size:${size*.6}px;vertical-align:middle;margin-right:6px">ğŸº</span>`;
}
function cardLogo(name){
  const u=LOGO_URIS[name];
  return u?`<img src="${u}" class="bc-logo" alt="${name}">`:`<span class="bc-emoji">ğŸº</span>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLOCK & TICKER â€” isolated first, cannot be killed by downstream errors
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function initClockAndTicker(){
  // CLOCK
  function updateClock(){
    try {
      const n=new Date();
      const t=n.toLocaleTimeString('en-US',{hour12:false});
      const d=n.toLocaleDateString('en-US',{weekday:'short',day:'2-digit',month:'short',year:'numeric'}).toUpperCase();
      const el=id=>document.getElementById(id);
      if(el('clock-time'))el('clock-time').textContent=t;
      if(el('clock-date'))el('clock-date').textContent=d;
      if(el('mb-clock'))el('mb-clock').textContent=t;
      if(el('sb-time'))el('sb-time').textContent=t;
    } catch(e){ /* never let clock throw */ }
  }
  setInterval(updateClock,1000);
  updateClock();

  // TICKER
  try {
    const beerMap={};
    beers.forEach(b=>{if(!beerMap[b.beer]||b.rating>beerMap[b.beer].rating)beerMap[b.beer]=b;});
    const tickerBeers=Object.values(beerMap).sort((a,b)=>b.rating-a.rating);
    const SEP='<span style="color:#333;margin:0 20px;font-size:10px">â—†</span>';
    let tk=tickerBeers.map(b=>{
      const arr=b.rating>=4?'â–²':b.rating>=3?'â–¶':'â–¼';
      const cl=b.rating>=4?'up':b.rating>=3?'fl':'dn';
      const flag=FLAGS[b.origin]||'';
      return `<span style="display:inline-block;white-space:nowrap;unicode-bidi:isolate">`
        + `<span style="margin-right:5px;font-size:11px">${flag}</span>`
        + `<span class="${cl}" style="letter-spacing:0.3px">${b.beer.toUpperCase()} ${arr} ${b.rating.toFixed(2)}</span>`
        + `<span style="color:#555;margin-left:8px;font-size:9px">${b.abv}% ABV Â· ${b.origin}</span>`
        + `</span>`;
    }).join(SEP);
    tk = SEP + tk + SEP + tk;
    document.getElementById('ticker-scroll').innerHTML=tk;
  } catch(e){ console.error('Ticker error:',e); }
})();

// â”€â”€ KEYBOARD SHORTCUTS (1-9, 0, q-r for tabs; Esc for modal)
(function(){
  const tabMap={
    '1':'overview','2':'beers','3':'rankings','4':'countries',
    '5':'city','6':'insights','7':'temporal','8':'mapdrunk',
    '9':'mapbrewed','0':'language',
    'q':'contrarian','w':'ipo','e':'audit','r':'comments','t':'addnew'
  };
  document.addEventListener('keydown',function(ev){
    if(ev.target.tagName==='INPUT'||ev.target.tagName==='TEXTAREA'||ev.target.tagName==='SELECT') return;
    if(ev.key==='Escape'){closeBeerModal();return;}
    const tab=tabMap[ev.key.toLowerCase()];
    if(tab&&!ev.ctrlKey&&!ev.metaKey&&!ev.altKey){ev.preventDefault();showTab(tab);}
  });
})();

// â”€â”€ TAB
function showTab(id,btn){
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.querySelectorAll('.mb-item').forEach(m=>m.style.background='');
  document.getElementById(id).classList.add('active');
  if(btn&&btn.classList.contains('nav-item')) btn.classList.add('active');
  if(id==='countries'&&!window._cD) drawCountry();
  if(id==='city'&&!window._ciD) drawCity();
  if(id==='rankings'&&!window._rkD) drawRankings();
  if(id==='insights'&&!window._inD) drawInsights();
  if(id==='temporal'&&!window._tmpD) drawTemporal();
  if(id==='contrarian'&&!window._ciX) drawContrarian();
  if(id==='ipo'){if(!window._ipoD) drawIPO(); if(!window._ftD) drawFutures();}
  if(id==='audit'&&!window._auditD) drawAudit();
  if(id==='comments'){ if(!isUnlocked()){openPwModal('comments');return;} renderComments(); }
  if(id==='addnew'){ if(!isUnlocked()){openPwModal('addnew');return;} renderAddLog(); }
  if(id==='mapdrunk'&&!window._dM){window._dM=true;setTimeout(initDrunkMap,80);}
  if(id==='mapbrewed'&&!window._bM){window._bM=true;setTimeout(initBrewedMap,80);}
}

// â”€â”€ CHART DEFAULTS
try {
  Chart.defaults.color='#555';
  Chart.defaults.borderColor='#222';
  Chart.defaults.font.family="'IBM Plex Mono','Courier New',monospace";
  Chart.defaults.font.size=10;
} catch(e){ console.error('Chart.defaults error:',e); }
const TT={backgroundColor:'#111',borderColor:'#333',borderWidth:1,titleColor:'#ff6600',bodyColor:'#aaa',padding:8};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// OVERVIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
try {
const smA={};
beers.forEach(b=>{if(!smA[b.style])smA[b.style]={t:0,c:0};smA[b.style].t+=b.rating;smA[b.style].c++;});
const sA=Object.entries(smA).map(([s,v])=>({s,a:v.t/v.c,c:v.c})).sort((a,b)=>b.a-a.a);

new Chart(document.getElementById('styleChart'),{type:'bar',
  data:{labels:sA.map(s=>s.s.length>16?s.s.slice(0,16)+'â€¦':s.s),datasets:[{data:sA.map(s=>s.a),backgroundColor:sA.map(s=>sC[s.s]||'#ff6600'),borderWidth:0}]},
  options:{indexAxis:'y',plugins:{legend:{display:false},tooltip:{...TT,callbacks:{label:c=>`${c.raw.toFixed(2)}/5`}}},scales:{x:{min:0,max:5,grid:{color:'#1a1a1a'},ticks:{color:'#444'}},y:{grid:{display:false},ticks:{color:'#ff6600',font:{size:9}}}}}
});

const mO=['Draft','Nitro','Bottle','Can'],mM={};
beers.forEach(b=>{if(!mM[b.method])mM[b.method]={t:0,c:0};mM[b.method].t+=b.rating;mM[b.method].c++;});
const mA=mO.map(m=>mM[m]?+(mM[m].t/mM[m].c).toFixed(2):0),mCt=mO.map(m=>mM[m]?mM[m].c:0);
new Chart(document.getElementById('methodChart'),{type:'bar',
  data:{labels:mO,datasets:[{data:mA,backgroundColor:['#ff6600','#00aaff','#bb44ff','#555'],borderWidth:0}]},
  options:{plugins:{legend:{display:false},tooltip:TT},scales:{y:{min:0,max:5,grid:{color:'#1a1a1a'},ticks:{color:'#444'}},x:{grid:{display:false},ticks:{color:'#ff6600'}}}}
});

new Chart(document.getElementById('scatterChart'),{type:'scatter',
  data:{datasets:[{data:beers.map(b=>({x:b.abv,y:b.rating,label:b.beer})),backgroundColor:beers.map(b=>sC[b.style]||'#ff6600'),pointRadius:5,pointHoverRadius:8,borderWidth:0}]},
  options:{plugins:{legend:{display:false},tooltip:{...TT,callbacks:{label:c=>`${c.raw.label} | ${c.raw.x}% ABV | ${c.raw.y}/5`}}},
    scales:{x:{title:{display:true,text:'ABV (%)',color:'#444'},min:3.5,max:10,grid:{color:'#1a1a1a'},ticks:{color:'#444'}},
            y:{title:{display:true,text:'RATING',color:'#444'},min:1.5,max:5,grid:{color:'#1a1a1a'},ticks:{color:'#444'}}}}
});

const sortedB=[...beers].sort((a,b)=>b.rating-a.rating);
document.getElementById('bestPanel').innerHTML=sortedB.slice(0,5).map((b,i)=>`
  <div class="insight-row">
    <span class="insight-key">#${i+1} ${logoImg(b.beer,16)} ${b.beer}</span>
    <div><span class="rb ${rbC(b.rating)}">${b.rating.toFixed(2)}</span> <span class="insight-sub">${b.origin} Â· ${b.method}</span></div>
  </div>`).join('');

document.getElementById('mktPanel').innerHTML=`
  <div class="insight-row"><span class="insight-key">BEST STYLE</span><div class="insight-val up">Hefeweizen</div><div class="insight-sub">4.63 avg</div></div>
  <div class="insight-row"><span class="insight-key">WEAKEST STYLE</span><div class="insight-val dn">Munich Dunkel</div><div class="insight-sub">2.67 avg</div></div>
  <div class="insight-row"><span class="insight-key">TOP COUNTRY</span><div class="insight-val">ğŸ‡ªğŸ‡¸ Spain</div><div class="insight-sub">4.25 avg Â· 1 review</div></div>
  <div class="insight-row"><span class="insight-key">TOP MARKET</span><div class="insight-val">New York, NY</div><div class="insight-sub">3.46 avg Â· 6 reviews</div></div>
  <div class="insight-row"><span class="insight-key">BEST METHOD</span><div class="insight-val">Draft</div><div class="insight-sub">3.70 avg Â· 5 reviews</div></div>`;

document.getElementById('latestPanel').innerHTML=`
  <div class="insight-row"><span class="insight-key">LATEST</span><div class="insight-val">Estrella Galicia &amp; PU</div><div class="insight-sub">4.25 / 3.25 Â· New Rochelle</div></div>
  <div class="insight-row"><span class="insight-key">TREND</span><div class="insight-val fl">â†’ FLAT</div><div class="insight-sub">30-day rolling avg</div></div>
  <div class="insight-row"><span class="insight-key">COVERAGE</span><div class="insight-val">13 countries</div><div class="insight-sub">5 continents</div></div>
  <div class="insight-row"><span class="insight-key">HIT RATE</span><div class="insight-val up">â–² 65%</div><div class="insight-sub">Rated â‰¥3.00</div></div>`;

// expose for other sections
window._smA=smA; window._sA=sA; window._mO=mO; window._mM=mM; window._mA=mA; window._mCt=mCt; window._sortedB=sortedB;
} catch(e){ console.error('Overview init error:',e); }

// â”€â”€ STREAK / RECENCY
try {
  const monthMap={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};
  const latest=beers.reduce((best,b)=>{
    const d=new Date(b.year,monthMap[b.month]||0,1);
    return d>best.d?{d,b}:best;
  },{d:new Date(0),b:null});
  if(latest.b){
    const today=new Date();
    const diffDays=Math.floor((today-latest.d)/(1000*60*60*24));
    const el=document.getElementById('streak-days');
    const bl=document.getElementById('streak-beer');
    if(el) el.textContent=diffDays;
    if(bl) bl.textContent=latest.b.month+' '+latest.b.year;
  }
} catch(e){ console.error('Streak error:',e); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BEER TABLE + GRID
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTable(data){
  try {
    const countEl=document.getElementById('beerFilterCount');
    if(countEl) countEl.textContent=`${data.length} / ${beers.length} ROWS`;
    document.getElementById('beerBody').innerHTML=data.map(b=>`
      <tr${b.isNew?' class="new-row"':''} style="cursor:pointer" onclick="openBeerModal('${b.beer.replace(/'/g,"\\'")}')">
        <td>${logoImg(b.beer,22)}</td>
        <td style="color:#ff6600;font-weight:600">${b.beer}${b.isNew?`<span class="new-tag">NEW</span>`:''}</td>
        <td style="color:#555;font-size:9px">${b.style}</td>
        <td>${FLAGS[b.origin]||''} ${b.origin}</td>
        <td style="color:#00aaff">${b.abv.toFixed(1)}%</td>
        <td style="color:#555">${b.method}</td>
        <td style="color:#555">${b.city}, ${b.region} Â· ${FLAGS[b.cc]||''} ${b.country}</td>
        <td><span class="rb ${rbC(b.rating)}">${b.rating.toFixed(2)}</span></td>
        <td style="color:#ffaa00;font-size:9px">${strs(b.rating)}</td>
      </tr>`).join('');
  } catch(e){ console.error('renderTable error:',e); }
}
function applyBeerFilter(){
  const q=(document.getElementById('beerSearch').value||'').toLowerCase();
  const st=document.getElementById('beerStyleFilter').value;
  const or=document.getElementById('beerOriginFilter').value;
  const sk=document.getElementById('beerSortSel').value;
  let data=[...beers];
  if(q) data=data.filter(b=>b.beer.toLowerCase().includes(q)||b.style.toLowerCase().includes(q)||b.country.toLowerCase().includes(q)||b.city.toLowerCase().includes(q));
  if(st) data=data.filter(b=>b.style===st);
  if(or) data=data.filter(b=>b.origin===or);
  data.sort((a,b)=>sk==='rating'?b.rating-a.rating:sk==='name'?a.beer.localeCompare(b.beer):b.abv-a.abv);
  renderTable(data);
}
function sortTable(k){applyBeerFilter();}
try {
  // Populate filter dropdowns
  const styles=[...new Set(beers.map(b=>b.style))].sort();
  const origins=[...new Set(beers.map(b=>b.origin))].sort();
  const styleEl=document.getElementById('beerStyleFilter');
  const origEl=document.getElementById('beerOriginFilter');
  styles.forEach(s=>{const o=document.createElement('option');o.value=s;o.textContent=s;styleEl.appendChild(o);});
  origins.forEach(o=>{const el=document.createElement('option');el.value=o;el.textContent=`${FLAGS[o]||''} ${o}`;origEl.appendChild(el);});
  applyBeerFilter();
} catch(e){ console.error('renderTable init:',e); }

try {
const unique=[...new Map(beers.map(b=>[b.beer,b])).values()].sort((a,b)=>b.rating-a.rating);
document.getElementById('beerGrid').innerHTML=unique.map(b=>`
  <div class="beer-card" onclick="openBeerModal('${b.beer.replace(/'/g,"\\'")}')">
    ${b.isNew?'<span class="bc-new">NEW</span>':''}
    <div class="bc-logo-wrap">${cardLogo(b.beer)}</div>
    <div class="bc-ticker">${b.beer}</div>
    <div class="bc-style">${b.style}</div>
    <div class="bc-bottom">
      <span class="bc-abv">${b.abv}%</span>
      <span class="rb ${rbC(b.rating)}">${b.rating.toFixed(2)}</span>
    </div>
    <div style="font-size:8px;color:#555;margin-top:3px">${FLAGS[b.origin]||''} ${CNAMES[b.origin]||b.origin} Â· ${b.method.toUpperCase()}</div>
  </div>`).join('');
} catch(e){ console.error('beerGrid init:',e); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BEER DETAIL MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openBeerModal(name){
  const reviews=beers.filter(b=>b.beer===name);
  if(!reviews.length) return;
  const ratings=reviews.map(b=>b.rating);
  const avgR=avg(ratings),bestR=Math.max(...ratings),worstR=Math.min(...ratings);
  const b0=reviews[0];
  document.getElementById('beerModalTitle').textContent=`${name.toUpperCase()} â€” DETAIL VIEW`;
  document.getElementById('beerModalBody').innerHTML=`
    <div style="display:flex;gap:16px;align-items:flex-start;padding:12px 0;border-bottom:1px solid #1a1a1a;margin-bottom:12px;flex-wrap:wrap">
      <div style="width:120px;height:60px;background:#0a0a0a;border:1px solid #222;display:flex;align-items:center;justify-content:center;padding:4px;flex-shrink:0">${cardLogo(name)}</div>
      <div style="flex:1;min-width:160px">
        <div style="font-size:15px;font-weight:700;color:#ff6600;margin-bottom:4px">${name}</div>
        <div style="font-size:10px;color:#555;margin-bottom:2px">${b0.style}</div>
        <div style="font-size:10px;color:#aaa">${FLAGS[b0.origin]||''} ${CNAMES[b0.origin]||b0.origin} Â· ${b0.abv}% ABV</div>
      </div>
      <div style="display:flex;gap:16px;flex-wrap:wrap">
        <div style="text-align:center"><div style="font-size:20px;font-weight:700;color:${rC(avgR)}">${avgR.toFixed(2)}</div><div style="font-size:8px;color:#555;letter-spacing:1px">AVG</div></div>
        <div style="text-align:center"><div style="font-size:20px;font-weight:700;color:${rC(bestR)}">${bestR.toFixed(2)}</div><div style="font-size:8px;color:#555;letter-spacing:1px">BEST</div></div>
        <div style="text-align:center"><div style="font-size:20px;font-weight:700;color:${rC(worstR)}">${worstR.toFixed(2)}</div><div style="font-size:8px;color:#555;letter-spacing:1px">WORST</div></div>
        <div style="text-align:center"><div style="font-size:20px;font-weight:700;color:#00aaff">${reviews.length}</div><div style="font-size:8px;color:#555;letter-spacing:1px">REVIEWS</div></div>
      </div>
    </div>
    <div style="font-size:9px;color:#ff6600;letter-spacing:2px;margin-bottom:6px">ALL SESSIONS</div>
    <table class="bb-table" style="min-width:unset">
      <thead><tr><th>#</th><th>RATING</th><th>STARS</th><th>METHOD</th><th>CITY</th><th>COUNTRY</th><th>DATE</th></tr></thead>
      <tbody>${reviews.map((b,i)=>`
        <tr>
          <td style="color:#555">${i+1}</td>
          <td><span class="rb ${rbC(b.rating)}">${b.rating.toFixed(2)}</span></td>
          <td style="color:#ffaa00;font-size:9px">${strs(b.rating)}</td>
          <td style="color:#555">${b.method}</td>
          <td style="color:#aaa">${b.city}, ${b.region}</td>
          <td>${FLAGS[b.cc]||''} ${b.country}</td>
          <td style="color:#555;font-size:9px">${b.month} ${b.year}</td>
        </tr>`).join('')}
      </tbody>
    </table>`;
  document.getElementById('beerModal').classList.add('open');
}
function closeBeerModal(){
  document.getElementById('beerModal').classList.remove('open');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RANKINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawRankings(){
  window._rkD=true;
  const sr=[...beers].sort((a,b)=>b.rating-a.rating);
  const mkList=(data,i0)=>data.map((b,i)=>`
    <div class="mini-row">
      <div style="display:flex;align-items:center;gap:6px">
        <span style="font-size:8px;color:#333;width:16px;text-align:right">#${i0+i+1}</span>
        ${logoImg(b.beer,20)}
        <span style="color:#ff6600;font-size:10px;font-weight:600">${b.beer}</span>
      </div>
      <div style="display:flex;align-items:center;gap:6px">
        <span style="font-size:8px;color:#555">${b.city}, ${b.region} Â· ${FLAGS[b.cc]||''} ${b.country}</span>
        <span class="rb ${rbC(b.rating)}">${b.rating.toFixed(2)}</span>
      </div>
    </div>`).join('');
  document.getElementById('top10').innerHTML=mkList(sr.slice(0,10),0);
  document.getElementById('bot10').innerHTML=mkList([...sr].reverse().slice(0,10),sr.length-10);

  const brands={};
  beers.forEach(b=>{if(!brands[b.beer])brands[b.beer]=[];brands[b.beer].push(b.rating);});
  const bList=Object.entries(brands).map(([n,rs])=>({n,cnt:rs.length,avg:avg(rs),best:Math.max(...rs),worst:Math.min(...rs),std:std(rs)})).sort((a,b)=>b.avg-a.avg);
  document.getElementById('brandBody').innerHTML=bList.map((b,i)=>`
    <tr>
      <td style="color:#555;font-size:9px">${i+1}</td>
      <td>${logoImg(b.n,20)}</td>
      <td style="color:#ff6600;font-weight:600">${b.n}</td>
      <td style="text-align:center">${b.cnt}</td>
      <td><span class="rb ${rbC(b.avg)}">${b.avg.toFixed(2)}</span></td>
      <td class="up">${b.best.toFixed(2)}</td>
      <td class="dn">${b.worst.toFixed(2)}</td>
      <td style="color:#aaa">${b.std.toFixed(3)}</td>
      <td><span style="font-size:8px;padding:1px 5px;border:1px solid;color:${b.std<.2?'#00cc44':b.std<.4?'#ffaa00':'#ff2222'};border-color:${b.std<.2?'#00cc44':b.std<.4?'#ffaa00':'#ff2222'}">${b.std<.2?'CONSISTENT':b.std<.4?'MODERATE':'VARIABLE'}</span></td>
    </tr>`).join('');

  const buckets={'2.0':0,'2.5':0,'3.0':0,'3.5':0,'4.0':0,'4.5-4.75':0};
  beers.forEach(b=>{
    if(b.rating<2.5)buckets['2.0']++;
    else if(b.rating<3.0)buckets['2.5']++;
    else if(b.rating<3.5)buckets['3.0']++;
    else if(b.rating<4.0)buckets['3.5']++;
    else if(b.rating<4.5)buckets['4.0']++;
    else buckets['4.5-4.75']++;
  });
  new Chart(document.getElementById('distChart'),{type:'bar',
    data:{labels:Object.keys(buckets),datasets:[{data:Object.values(buckets),backgroundColor:['#ff2222','#ff6600','#ffaa00','#aacc00','#00cc44','#00ff55'],borderWidth:0}]},
    options:{plugins:{legend:{display:false},tooltip:TT},scales:{y:{grid:{color:'#1a1a1a'},ticks:{color:'#444',stepSize:1}},x:{grid:{display:false},ticks:{color:'#ff6600'}}}}
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ABV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawABV(){
  window._abvD=true;
  const hB=[{l:'4.0â€“4.4%',min:4,max:4.5},{l:'4.5â€“4.9%',min:4.5,max:5},{l:'5.0â€“5.4%',min:5,max:5.5},{l:'5.5â€“5.9%',min:5.5,max:6},{l:'6.0â€“7.9%',min:6,max:8},{l:'8.0%+',min:8,max:99}];
  const hV=hB.map(b=>beers.filter(x=>x.abv>=b.min&&x.abv<b.max).length);
  new Chart(document.getElementById('abvHistChart'),{type:'bar',
    data:{labels:hB.map(b=>b.l),datasets:[{data:hV,backgroundColor:'#00aaff',borderWidth:0}]},
    options:{plugins:{legend:{display:false},tooltip:TT},scales:{y:{grid:{color:'#1a1a1a'},ticks:{color:'#444',stepSize:1}},x:{grid:{display:false},ticks:{color:'#ff6600',font:{size:9}}}}}
  });
  const styleAbv=Object.entries(smA).map(([s])=>({s,ab:avg(beers.filter(b=>b.style===s).map(b=>b.abv))})).sort((a,b)=>b.ab-a.ab);
  new Chart(document.getElementById('abvStyleChart'),{type:'bar',
    data:{labels:styleAbv.map(s=>s.s.length>14?s.s.slice(0,14)+'â€¦':s.s),datasets:[{data:styleAbv.map(s=>s.ab.toFixed(1)),backgroundColor:styleAbv.map(s=>sC[s.s]||'#ff6600'),borderWidth:0}]},
    options:{indexAxis:'y',plugins:{legend:{display:false},tooltip:{...TT,callbacks:{label:c=>`${c.raw}% ABV`}}},scales:{x:{grid:{color:'#1a1a1a'},ticks:{color:'#444'}},y:{grid:{display:false},ticks:{color:'#ff6600',font:{size:9}}}}}
  });
  const abvCat=a=>a>=8?'VERY HIGH':a>=6?'HIGH':a>=5?'MEDIUM':a>=4.5?'MED-LOW':'LOW';
  document.getElementById('abvTableBody').innerHTML=[...beers].sort((a,b)=>b.abv-a.abv).map(b=>`
    <tr>
      <td>${logoImg(b.beer,20)}</td>
      <td style="color:#ff6600;font-weight:600">${b.beer}</td>
      <td style="font-weight:700;color:${b.abv>=8?'#ff2222':b.abv>=6?'#ff6600':b.abv>=5?'#ffaa00':'#00cc44'}">${b.abv.toFixed(1)}%</td>
      <td><span style="font-size:8px;padding:1px 5px;border:1px solid #333;color:#666">${abvCat(b.abv)}</span></td>
      <td style="color:#555;font-size:9px">${b.style}</td>
      <td>${FLAGS[b.origin]||''} ${b.origin}</td>
      <td><span class="rb ${rbC(b.rating)}">${b.rating.toFixed(2)}</span></td>
    </tr>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COUNTRY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawCountry(){
  window._cD=true;
  const cM={};
  beers.forEach(b=>{if(!cM[b.origin])cM[b.origin]={t:0,c:0};cM[b.origin].t+=b.rating;cM[b.origin].c++;});
  const cD=Object.entries(cM).map(([k,v])=>({l:`${FLAGS[k]||''} ${CNAMES[k]||k}`,code:k,a:v.t/v.c,c:v.c})).sort((a,b)=>b.a-a.a);
  new Chart(document.getElementById('countryChart'),{type:'bar',
    data:{labels:cD.map(d=>d.l),datasets:[{data:cD.map(d=>+d.a.toFixed(2)),backgroundColor:cD.map((_,i)=>`hsl(${30+i*18},80%,${40-i}%)`),borderWidth:0}]},
    options:{indexAxis:'y',plugins:{legend:{display:false},tooltip:TT},scales:{x:{min:0,max:5,grid:{color:'#1a1a1a'},ticks:{color:'#444'}},y:{grid:{display:false},ticks:{color:'#ff6600',font:{size:10}}}}}
  });
  document.getElementById('countryCards').innerHTML=cD.map(d=>`
    <div class="bb-bar-row">
      <div class="bb-bar-label"><span class="name">${d.l}</span><span class="val">${d.a.toFixed(2)}/5 Â· ${d.c}x</span></div>
      <div class="bb-bar-bg"><div class="bb-bar-fill" style="width:${d.a/5*100}%;background:${rC(d.a)}"></div></div>
    </div>`).join('');
  new Chart(document.getElementById('countryPieChart'),{type:'doughnut',
    data:{labels:cD.map(d=>d.l),datasets:[{data:cD.map(d=>d.c),backgroundColor:cD.map((_,i)=>`hsl(${30+i*18},80%,${40-i}%)`),borderWidth:1,borderColor:'#111'}]},
    options:{plugins:{legend:{position:'right',labels:{color:'#666',font:{size:9},boxWidth:10}},tooltip:{...TT,callbacks:{label:c=>`${c.raw} reviews`}}}}
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// METHOD (sync init)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
try {
const eM={Draft:'ğŸº',Nitro:'ğŸ«§',Bottle:'ğŸ¾',Can:'ğŸ¥«'};
const mColors=['#ff6600','#00aaff','#bb44ff','#555'];
const mO=window._mO||['Draft','Nitro','Bottle','Can'];
const mA=window._mA||mO.map(()=>0);
const mCt=window._mCt||mO.map(()=>0);
new Chart(document.getElementById('methodDetailChart'),{type:'bar',
  data:{labels:mO.map((m,i)=>`${m} (${mCt[i]})`),datasets:[{data:mA,backgroundColor:mColors,borderWidth:0}]},
  options:{plugins:{legend:{display:false},tooltip:TT},scales:{y:{min:0,max:5,grid:{color:'#1a1a1a'},ticks:{color:'#444'}},x:{grid:{display:false},ticks:{color:'#ff6600'}}}}
});
document.getElementById('methodCards').innerHTML=mO.map((m,i)=>`
  <div class="kpi">
    <div style="font-size:1.4rem;margin-bottom:4px">${eM[m]}</div>
    <div class="kpi-val" style="color:${mColors[i]}">${mA[i].toFixed(2)}</div>
    <div class="kpi-label">${m.toUpperCase()}</div>
    <div class="kpi-sub">${mCt[i]} review${mCt[i]>1?'s':''}</div>
  </div>`).join('');
const globalAvg=avg(beers.map(b=>b.rating));
document.getElementById('methodDetailBody').innerHTML=mO.map((m,i)=>{
  const mb=beers.filter(b=>b.method===m);
  const best=mb.length?mb.reduce((a,b)=>b.rating>a.rating?b:a):{beer:'â€”'};
  const worst=mb.length?mb.reduce((a,b)=>b.rating<a.rating?b:a):{beer:'â€”'};
  const diff=mA[i]-globalAvg;
  return `<tr>
    <td style="color:#ff6600">${eM[m]} ${m}</td>
    <td style="text-align:center">${mCt[i]}</td>
    <td><span class="rb ${rbC(mA[i])}">${mA[i].toFixed(2)}</span></td>
    <td class="up" style="font-size:9px">${best.beer}</td>
    <td class="dn" style="font-size:9px">${worst.beer}</td>
    <td class="${diff>=0?'up':'dn'}">${diff>=0?'+':''}${diff.toFixed(2)}</td>
  </tr>`;
}).join('');
} catch(e){ console.error('Method init error:',e); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CITY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawCity(){
  window._ciD=true;
  const cM={};
  beers.forEach(b=>{if(!cM[b.city])cM[b.city]={t:0,c:0,region:b.region,country:b.country,cc:b.cc};cM[b.city].t+=b.rating;cM[b.city].c++;});
  const cD=Object.entries(cM).map(([k,v])=>({city:k,region:v.region,country:v.country,cc:v.cc,a:v.t/v.c,c:v.c})).sort((a,b)=>b.a-a.a);
  new Chart(document.getElementById('cityChart'),{type:'bar',
    data:{labels:cD.map(d=>`${d.city} (${d.c})`),datasets:[{data:cD.map(d=>+d.a.toFixed(2)),backgroundColor:cD.map((_,i)=>`hsl(${30+i*22},75%,${42-i}%)`),borderWidth:0}]},
    options:{indexAxis:'y',plugins:{legend:{display:false},tooltip:TT},scales:{x:{min:0,max:5,grid:{color:'#1a1a1a'},ticks:{color:'#444'}},y:{grid:{display:false},ticks:{color:'#ff6600',font:{size:10}}}}}
  });
  document.getElementById('cityCards').innerHTML=cD.map(d=>`
    <div class="mini-row">
      <div><div style="font-size:10px;color:#ff6600;font-weight:600">${d.city}</div><div style="font-size:8px;color:#555">${d.region} Â· ${FLAGS[d.cc]||''} ${d.country} Â· ${d.c} review${d.c>1?'s':''}</div></div>
      <span class="rb ${rbC(d.a)}">${d.a.toFixed(2)}</span>
    </div>`).join('');
  new Chart(document.getElementById('cityPieChart'),{type:'doughnut',
    data:{labels:cD.map(d=>`${d.city}, ${d.region}`),datasets:[{data:cD.map(d=>d.c),backgroundColor:cD.map((_,i)=>`hsl(${30+i*22},75%,${42-i}%)`),borderWidth:1,borderColor:'#111'}]},
    options:{plugins:{legend:{position:'right',labels:{color:'#666',font:{size:9},boxWidth:10}},tooltip:{...TT,callbacks:{label:c=>`${c.raw} reviews`}}}}
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INSIGHTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawInsights(){
  window._inD=true;
  const ratings=beers.map(b=>b.rating);
  const sr=[...ratings].sort((a,b)=>a-b);
  const mean=avg(ratings),med=sr.length%2===0?(sr[sr.length/2-1]+sr[sr.length/2])/2:sr[Math.floor(sr.length/2)],stdD=std(ratings);
  const q1=sr[Math.floor(sr.length*.25)],q3=sr[Math.floor(sr.length*.75)];

  document.getElementById('statSummary').innerHTML=[
    ['MEAN',mean.toFixed(4),'fl'],['MEDIAN',med.toFixed(2),''],
    ['STD DEV',stdD.toFixed(4),''],['MIN',Math.min(...ratings).toFixed(2),'dn'],
    ['MAX',Math.max(...ratings).toFixed(2),'up'],['RANGE',(Math.max(...ratings)-Math.min(...ratings)).toFixed(2),''],
    ['Q1 (25th)',q1.toFixed(2),''],['Q3 (75th)',q3.toFixed(2),''],
    ['IQR',(q3-q1).toFixed(2),''],['N',ratings.length,''],
  ].map(([l,v,c])=>`<div class="insight-row"><span class="insight-key">${l}</span><span class="insight-val ${c}" style="font-family:var(--mono)">${v}</span></div>`).join('');

  document.getElementById('quintiles').innerHTML=[
    ['â–²â–² EXCELLENT (4.5â€“5.0)',ratings.filter(r=>r>=4.5).length,'up'],
    ['â–²  GOOD (4.0â€“4.4)',ratings.filter(r=>r>=4&&r<4.5).length,'up'],
    ['â†’  SOLID (3.5â€“3.9)',ratings.filter(r=>r>=3.5&&r<4).length,'fl'],
    ['â†’  AVERAGE (3.0â€“3.4)',ratings.filter(r=>r>=3&&r<3.5).length,'fl'],
    ['â–¼  BELOW (2.5â€“2.9)',ratings.filter(r=>r>=2.5&&r<3).length,'dn'],
    ['â–¼â–¼ POOR (<2.5)',ratings.filter(r=>r<2.5).length,'dn'],
  ].map(([l,n,c])=>`<div class="insight-row">
    <span class="insight-key">${l}</span>
    <span class="insight-val ${c}">${n} <span style="color:#555;font-size:9px">(${(n/ratings.length*100).toFixed(0)}%)</span></span>
  </div>`).join('');

  const profile=[
    {l:'WHEAT/HEFEWEIZEN BIAS',v:4.63,color:'#ff6600'},
    {l:'DARK BEER TOLERANCE',v:2.67,color:'#444'},
    {l:'LAGER APPRECIATION',v:3.23,color:'#00cc44'},
    {l:'GERMAN BEER PREMIUM',v:4.00,color:'#ff6600'},
    {l:'AMERICAN BEER DISCOUNT',v:2.83,color:'#ff2222'},
    {l:'ARTISAN vs MACRO',v:3.80,color:'#bb44ff'},
    {l:'HIGH ABV PREFERENCE',v:3.38,color:'#00aaff'},
    {l:'DRAFT/NITRO PREMIUM',v:3.70,color:'#00aaff'},
  ];
  document.getElementById('tasteProfile').innerHTML=profile.map(p=>`
    <div class="bb-bar-row">
      <div class="bb-bar-label"><span class="name">${p.l}</span><span class="val">${p.v.toFixed(2)}/5</span></div>
      <div class="bb-bar-bg"><div class="bb-bar-fill" style="width:${p.v/5*100}%;background:${p.color}"></div></div>
    </div>`).join('');

  new Chart(document.getElementById('timelineChart'),{type:'line',
    data:{
      labels:beers.map((_,i)=>`#${i+1}`),
      datasets:[
        {label:'Rating',data:beers.map(b=>b.rating),borderColor:'#ff6600',backgroundColor:'rgba(255,102,0,0.06)',fill:true,tension:.3,pointRadius:3,pointBackgroundColor:beers.map(b=>rC(b.rating)),pointBorderColor:'#000',pointBorderWidth:1},
        {label:'5-Pt Avg',data:beers.map((_,i,a)=>avg(a.slice(Math.max(0,i-4),i+1).map(b=>b.rating)).toFixed(2)),borderColor:'#00aaff',borderDash:[3,3],tension:.3,pointRadius:0,fill:false},
      ]
    },
    options:{plugins:{legend:{labels:{color:'#555',font:{size:9},boxWidth:10}},tooltip:TT},scales:{y:{min:1.5,max:5.2,grid:{color:'#1a1a1a'},ticks:{color:'#444'}},x:{grid:{display:false},ticks:{color:'#444',maxTicksLimit:12}}}}
  });

  const brands2={};
  beers.forEach(b=>{if(!brands2[b.beer])brands2[b.beer]=[];brands2[b.beer].push(b.rating);});
  const multi=Object.entries(brands2).filter(([,rs])=>rs.length>1).map(([n,rs])=>({n,rs,avg:avg(rs),std:std(rs)})).sort((a,b)=>a.std-b.std);
  document.getElementById('consistencyPanel').innerHTML=multi.map(b=>`
    <div class="mini-row" style="gap:10px">
      ${logoImg(b.n,28)}
      <div style="flex:1">
        <div style="color:#ff6600;font-weight:600;font-size:10px;margin-bottom:2px">${b.n}</div>
        <div style="font-size:8px;color:#555">AVG ${b.avg.toFixed(2)} Â· Ïƒ ${b.std.toFixed(3)} Â· SCORES: ${b.rs.sort((a,c)=>c-a).join(', ')}</div>
        <div style="margin-top:3px;height:3px;background:#1a1a1a">
          <div style="height:100%;width:${(1-b.std)*100}%;background:${b.std<.2?'#00cc44':b.std<.4?'#ffaa00':'#ff2222'}"></div>
        </div>
      </div>
      <span style="font-size:7px;padding:1px 5px;border:1px solid;color:${b.std<.2?'#00cc44':b.std<.4?'#ffaa00':'#ff2222'};border-color:${b.std<.2?'#00cc44':b.std<.4?'#ffaa00':'#ff2222'};flex-shrink:0">${b.std<.2?'CONSISTENT':b.std<.4?'MODERATE':'VARIABLE'}</span>
    </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LANGUAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
try {
const LANG_MAP={DE:"German",NL:"Dutch",BE:"Dutch",US:"English",IE:"English",JM:"English",CA:"French",FR:"French",JP:"Japanese",MX:"Spanish",DK:"Danish",ES:"Spanish",CZ:"Czech"};
const lC={"German":"#ff6600","Dutch":"#00aaff","English":"#00cc44","French":"#bb44ff","Japanese":"#ff2222","Spanish":"#ffaa00","Danish":"#555","Czech":"#00ccaa"};
const lF={"German":"ğŸ‡©ğŸ‡ª","Dutch":"ğŸ‡³ğŸ‡±","English":"ğŸ‡¬ğŸ‡§","French":"ğŸ‡«ğŸ‡·","Japanese":"ğŸ‡¯ğŸ‡µ","Spanish":"ğŸ‡ªğŸ‡¸","Danish":"ğŸ‡©ğŸ‡°","Czech":"ğŸ‡¨ğŸ‡¿"};
const brewLoc={};breweries.forEach(b=>{b.beers.split(' Â· ').forEach(n=>{if(!brewLoc[n.trim()])brewLoc[n.trim()]=b.location;});});
const lD=beers.map(b=>({beer:b.beer,country:b.origin,region:brewLoc[b.beer]||'',lang:LANG_MAP[b.origin]||b.origin,rating:b.rating}));
const lA={};
lD.forEach(d=>{if(!lA[d.lang])lA[d.lang]={t:0,c:0,b:[]};lA[d.lang].t+=d.rating;lA[d.lang].c++;if(!lA[d.lang].b.includes(d.beer))lA[d.lang].b.push(d.beer);});
const lS=Object.entries(lA).map(([l,v])=>({l,a:v.t/v.c,c:v.c,b:v.b})).sort((a,b)=>b.a-a.a);
new Chart(document.getElementById('langChart'),{type:'bar',
  data:{labels:lS.map(d=>`${lF[d.l]||''} ${d.l}`),datasets:[{data:lS.map(d=>+d.a.toFixed(2)),backgroundColor:lS.map(d=>lC[d.l]||'#ff6600'),borderWidth:0}]},
  options:{indexAxis:'y',plugins:{legend:{display:false},tooltip:TT},scales:{x:{min:0,max:5,grid:{color:'#1a1a1a'},ticks:{color:'#444'}},y:{grid:{display:false},ticks:{color:'#ff6600',font:{size:10}}}}}
});
document.getElementById('langCards').innerHTML=lS.map(d=>`
  <div class="bb-bar-row">
    <div class="bb-bar-label"><span class="name">${lF[d.l]||''} ${d.l}</span><span class="val">${d.a.toFixed(2)}/5 Â· ${d.c}x Â· ${d.b.join(', ')}</span></div>
    <div class="bb-bar-bg"><div class="bb-bar-fill" style="width:${d.a/5*100}%;background:${lC[d.l]}"></div></div>
  </div>`).join('');
document.getElementById('langTableBody').innerHTML=[...lD].sort((a,b)=>b.rating-a.rating).map(d=>`
  <tr><td>${logoImg(d.beer,20)}</td><td style="color:#ff6600">${d.beer}</td><td>${FLAGS[d.country]||''} ${d.country}</td><td style="color:#555;font-size:9px">${d.region}</td><td style="color:${lC[d.lang]||'#ff6600'}">${lF[d.lang]||''} ${d.lang}</td><td><span class="rb ${rbC(d.rating)}">${d.rating.toFixed(2)}</span></td></tr>`).join('');
} catch(e){ console.error('Language init error:',e); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAPS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const cityColors={"New York":"#ff6600","New Rochelle":"#bb44ff","White Plains":"#00cc44","Eastchester":"#00aaff","Hartsdale":"#ff2222","Montreal":"#ff8800","Amsterdam":"#00cccc","Hengelo":"#6666ff"};
function addTiles(map){L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'Â© OpenStreetMap',maxZoom:18}).addTo(map);}
function popHtml(h){return `<div style="font-family:var(--mono);font-size:11px;line-height:1.6">${h}</div>`;}
function circleM(map,lat,lng,color,r,html){L.circleMarker([lat,lng],{radius:r,fillColor:color,color:'#000',weight:1.5,opacity:1,fillOpacity:.9}).addTo(map).bindPopup(popHtml(html),{className:'dpop'});}

function initDrunkMap(){
  const cM={};
  beers.forEach(b=>{
    if(!cM[b.city])cM[b.city]={t:0,c:0,bs:[],region:b.region,country:b.country,cc:b.cc};
    cM[b.city].t+=b.rating;cM[b.city].c++;
    if(!cM[b.city].bs.includes(b.beer))cM[b.city].bs.push(b.beer);
  });
  const map=L.map('drunkMap',{scrollWheelZoom:false}).setView([46,-20],3);
  addTiles(map);
  drunkLocs.filter(l=>cM[l.city]).forEach(l=>{
    const d=cM[l.city],a=(d.t/d.c).toFixed(2),r=Math.max(8,Math.min(22,6+d.c*3));
    const beerRows=beers.filter(b=>b.city===l.city).map(b=>`<div style="display:flex;justify-content:space-between;gap:12px;padding:1px 0;border-bottom:1px solid #1a1a1a"><span style="color:#aaa">${b.beer}</span><span style="color:${rC(b.rating)};font-weight:700">${b.rating.toFixed(2)}</span></div>`).join('');
    circleM(map,l.lat,l.lng,cityColors[l.city]||'#ff6600',r,
      `<span style="color:#ff6600;font-weight:700">${l.city}</span>, ${l.region}&nbsp;&nbsp;${FLAGS[l.cc]||''} ${l.country}<br><span style="color:#555;font-size:9px">${d.c} review${d.c>1?'s':''} Â· AVG <span style="color:#00cc44;font-weight:700">${a}/5</span></span><div style="margin-top:6px">${beerRows}</div>`);
  });
  document.getElementById('drunkLeg').innerHTML=drunkLocs.filter(l=>cM[l.city]).map(l=>`<div class="map-leg-item"><div class="map-leg-dot" style="background:${cityColors[l.city]||'#ff6600'}"></div>${l.city}, ${l.region} Â· ${FLAGS[l.cc]||''} ${l.country} (${cM[l.city].c})</div>`).join('');
  const arr=Object.entries(cM).map(([city,d])=>({city,count:d.c,avg:d.t/d.c,beers:d.bs,region:d.region,country:d.country,cc:d.cc})).sort((a,b)=>b.count-a.count);
  document.getElementById('drunkTbody').innerHTML=arr.map(c=>`<tr>
    <td style="color:#ff6600">${c.city}</td>
    <td style="color:#555">${c.region}</td>
    <td style="color:#aaa">${FLAGS[c.cc]||''} ${c.country}</td>
    <td style="text-align:center;color:#00aaff">${c.count}</td>
    <td><span class="rb ${rbC(c.avg)}">${c.avg.toFixed(2)}</span></td>
    <td style="color:#555;font-size:9px">${c.beers.join(', ')}</td>
  </tr>`).join('');
}

function initBrewedMap(){
  const map=L.map('brewedMap',{scrollWheelZoom:false}).setView([30,10],2);
  addTiles(map);
  breweries.forEach(b=>{
    const a=avg(b.ratings),r=Math.max(8,Math.min(22,6+b.ratings.length*3));
    const firstBeer=b.beers.split(' Â· ')[0];
    const logoHtml=LOGO_URIS[firstBeer]?`<img src="${LOGO_URIS[firstBeer]}" style="width:60px;height:20px;object-fit:contain;display:block;margin:3px 0">`:'';
    circleM(map,b.lat,b.lng,rC(a),r,`${logoHtml}<span style="color:#ff6600;font-weight:700">${b.name}</span><br><span style="color:#555;font-size:9px">${b.location} Â· ${FLAGS[b.cc]||''} ${b.country}</span><br><span style="color:#444;font-size:9px">${b.beers}</span><br>AVG <span style="color:${rC(a)};font-weight:700">${a.toFixed(2)}/5</span> Â· ${b.ratings.length} review${b.ratings.length>1?'s':''}`);
  });
  const s=[...breweries].map(b=>({...b,avg:avg(b.ratings)})).sort((a,b)=>b.avg-a.avg);
  document.getElementById('brewedTbody').innerHTML=s.map(b=>{
    const firstBeer=b.beers.split(' Â· ')[0];
    return `<tr>
      <td>${logoImg(firstBeer,22)}</td>
      <td style="color:#ff6600;font-weight:600">${b.name}</td>
      <td style="color:#555;font-size:9px">${b.location}</td>
      <td style="color:#aaa">${FLAGS[b.cc]||''} ${b.country}</td>
      <td style="color:#555;font-size:9px">${b.beers}</td>
      <td><span class="rb ${rbC(b.avg)}">${b.avg.toFixed(2)}</span></td>
    </tr>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TEMPORAL ANALYTICS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawTemporal(){
  window._tmpD = true;

  const months = ['Jan','Feb'];
  const monthLabels = ['January 2026','February 2026'];
  const monthColors = ['#ff6600','#00aaff'];

  const byMonth = {};
  months.forEach(m => { byMonth[m] = beers.filter(b => b.month === m); });

  const counts  = months.map(m => byMonth[m].length);
  const avgRatings = months.map(m => {
    const rs = byMonth[m].map(b => b.rating);
    return rs.length ? +(rs.reduce((a,v)=>a+v,0)/rs.length).toFixed(2) : 0;
  });

  document.getElementById('janAvgKpi').textContent = avgRatings[0].toFixed(2);
  document.getElementById('febAvgKpi').textContent = avgRatings[1].toFixed(2);
  const delta = (avgRatings[1] - avgRatings[0]);
  const momEl = document.getElementById('momKpi');
  momEl.textContent = (delta >= 0 ? '+' : '') + delta.toFixed(2);
  momEl.style.color = delta > 0 ? 'var(--green2)' : delta < 0 ? 'var(--red)' : 'var(--amber)';
  document.getElementById('momDir').textContent = delta > 0 ? 'â–² IMPROVING' : delta < 0 ? 'â–¼ DECLINING' : 'â†’ FLAT';

  new Chart(document.getElementById('monthlyChart'), {
    data: {
      labels: monthLabels,
      datasets: [
        {type:'bar',label:'Reviews',data:counts,backgroundColor:monthColors.map(c=>c+'33'),borderColor:monthColors,borderWidth:2,yAxisID:'y'},
        {type:'line',label:'Avg Rating',data:avgRatings,borderColor:'#ffaa00',backgroundColor:'transparent',pointBackgroundColor:avgRatings.map(r=>rC(r)),pointRadius:8,pointBorderColor:'#000',pointBorderWidth:2,tension:0.3,yAxisID:'y2'}
      ]
    },
    options:{plugins:{legend:{labels:{color:'#555',font:{size:9},boxWidth:10}},tooltip:TT},
      scales:{y:{position:'left',grid:{color:'#1a1a1a'},ticks:{color:'#444',stepSize:1},title:{display:true,text:'REVIEWS',color:'#444'}},
              y2:{position:'right',min:0,max:5,grid:{display:false},ticks:{color:'#ffaa00'},title:{display:true,text:'AVG RATING',color:'#ffaa00'}},
              x:{grid:{display:false},ticks:{color:'#ff6600'}}}}
  });

  document.getElementById('monthBestWorst').innerHTML = months.map((m,i) => {
    const mb = byMonth[m];
    if(!mb.length) return '';
    const best  = mb.reduce((a,b)=>b.rating>a.rating?b:a);
    const worst = mb.reduce((a,b)=>b.rating<a.rating?b:a);
    return `
      <div style="margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid var(--border)">
        <div style="font-size:9px;font-weight:700;color:${monthColors[i]};letter-spacing:1px;margin-bottom:6px">${monthLabels[i].toUpperCase()} Â· ${mb.length} REVIEWS Â· AVG ${avgRatings[i].toFixed(2)}</div>
        <div class="mini-row">
          <div style="display:flex;align-items:center;gap:6px">
            <span style="font-size:9px;color:var(--green2);font-weight:700">â–² BEST</span>
            ${logoImg(best.beer,18)}
            <span style="color:#ddd;font-size:10px">${best.beer}</span>
          </div>
          <span class="rb ${rbC(best.rating)}">${best.rating.toFixed(2)}</span>
        </div>
        <div class="mini-row">
          <div style="display:flex;align-items:center;gap:6px">
            <span style="font-size:9px;color:var(--red);font-weight:700">â–¼ WORST</span>
            ${logoImg(worst.beer,18)}
            <span style="color:#ddd;font-size:10px">${worst.beer}</span>
          </div>
          <span class="rb ${rbC(worst.rating)}">${worst.rating.toFixed(2)}</span>
        </div>
      </div>`;
  }).join('');

  const bucketKeys = ['2.0-2.4','2.5-2.9','3.0-3.4','3.5-3.9','4.0-4.4','4.5+'];
  const bucketFn = r => r>=4.5?5:r>=4?4:r>=3.5?3:r>=3?2:r>=2.5?1:0;
  const janBuckets = [0,0,0,0,0,0];
  const febBuckets = [0,0,0,0,0,0];
  byMonth['Jan'].forEach(b=>janBuckets[bucketFn(b.rating)]++);
  byMonth['Feb'].forEach(b=>febBuckets[bucketFn(b.rating)]++);

  new Chart(document.getElementById('monthDistChart'),{type:'bar',
    data:{labels:bucketKeys,datasets:[
      {label:'Jan 2026',data:janBuckets,backgroundColor:'#ff660066',borderColor:'#ff6600',borderWidth:2},
      {label:'Feb 2026',data:febBuckets,backgroundColor:'#00aaff66',borderColor:'#00aaff',borderWidth:2},
    ]},
    options:{plugins:{legend:{labels:{color:'#555',font:{size:9},boxWidth:10}},tooltip:TT},
      scales:{y:{grid:{color:'#1a1a1a'},ticks:{color:'#444',stepSize:1}},x:{grid:{display:false},ticks:{color:'#ff6600'}}}}
  });

  ['Jan','Feb'].forEach((m,i)=>{
    const styleMap={};
    byMonth[m].forEach(b=>{styleMap[b.style]=(styleMap[b.style]||0)+1;});
    const labels=Object.keys(styleMap),data=Object.values(styleMap);
    new Chart(document.getElementById(i===0?'janStyleChart':'febStyleChart'),{type:'doughnut',
      data:{labels,datasets:[{data,backgroundColor:labels.map(s=>sC[s]||'#ff6600'),borderWidth:1,borderColor:'#111'}]},
      options:{plugins:{legend:{position:'right',labels:{color:'#666',font:{size:9},boxWidth:10}},tooltip:TT}}
    });
  });

  const allCountries=[...new Set(beers.map(b=>b.origin))].sort();
  const janCountCts=allCountries.map(c=>byMonth['Jan'].filter(b=>b.origin===c).length);
  const febCountCts=allCountries.map(c=>byMonth['Feb'].filter(b=>b.origin===c).length);
  new Chart(document.getElementById('monthCountryChart'),{type:'bar',
    data:{labels:allCountries.map(c=>`${FLAGS[c]||''} ${c}`),datasets:[
      {label:'Jan',data:janCountCts,backgroundColor:'#ff660066',borderColor:'#ff6600',borderWidth:2},
      {label:'Feb',data:febCountCts,backgroundColor:'#00aaff66',borderColor:'#00aaff',borderWidth:2},
    ]},
    options:{plugins:{legend:{labels:{color:'#555',font:{size:9},boxWidth:10}},tooltip:TT},
      scales:{y:{grid:{color:'#1a1a1a'},ticks:{color:'#444',stepSize:1}},x:{grid:{display:false},ticks:{color:'#ff6600',font:{size:9}}}}}
  });

  const overlap=[...new Set(byMonth['Jan'].map(b=>b.beer))].filter(n=>byMonth['Feb'].some(b=>b.beer===n));
  const janAbv=avg(byMonth['Jan'].map(b=>b.abv));
  const febAbv=avg(byMonth['Feb'].map(b=>b.abv));
  document.getElementById('momentumPanel').innerHTML=[
    ['JAN REVIEW COUNT',counts[0],'fl'],
    ['FEB REVIEW COUNT',counts[1],'fl'],
    ['PACE CHANGE',(counts[1]-counts[0]>=0?'+':'')+(counts[1]-counts[0])+' REVIEWS',counts[1]>=counts[0]?'up':'dn'],
    ['JAN AVG RATING',avgRatings[0].toFixed(2),'fl'],
    ['FEB AVG RATING',avgRatings[1].toFixed(2),delta>=0?'up':'dn'],
    ['MOM Î” RATING',(delta>=0?'+':'')+delta.toFixed(2),delta>=0?'up':'dn'],
    ['JAN AVG ABV',janAbv.toFixed(2)+'%',''],
    ['FEB AVG ABV',febAbv.toFixed(2)+'%',''],
    ['REPEAT BRANDS',overlap.length+' ('+overlap.slice(0,3).join(', ')+(overlap.length>3?'â€¦':'')+')','' ],
    ['UNIQUE TO JAN',byMonth['Jan'].filter(b=>!byMonth['Feb'].some(x=>x.beer===b.beer)).length+' brands','fl'],
    ['UNIQUE TO FEB',byMonth['Feb'].filter(b=>!byMonth['Jan'].some(x=>x.beer===b.beer)).length+' brands','fl'],
  ].map(([l,v,c])=>`
    <div class="mini-row">
      <span style="font-size:9px;color:var(--orange)">${l}</span>
      <span class="${c}" style="font-family:var(--mono);font-size:10px;font-weight:700">${v}</span>
    </div>`).join('');

  const sorted=[...beers].sort((a,b)=>a.monthN-b.monthN||b.rating-a.rating);
  const mColor={Jan:'#ff6600',Feb:'#00aaff',Mar:'#00cc44'};
  document.getElementById('temporalTableBody').innerHTML=sorted.map(b=>`
    <tr>
      <td><span style="color:${mColor[b.month]||'#888'};font-weight:700;font-size:9px">${b.month.toUpperCase()} 2026</span></td>
      <td>${logoImg(b.beer,20)}</td>
      <td style="color:#ff6600;font-weight:600">${b.beer}${b.isNew?'<span class="new-tag">NEW</span>':''}</td>
      <td style="color:#555;font-size:9px">${b.style}</td>
      <td>${FLAGS[b.origin]||''} ${b.origin}</td>
      <td style="color:#00aaff">${b.abv.toFixed(1)}%</td>
      <td style="color:#555">${b.method}</td>
      <td style="color:#555">${b.city}, ${b.region} Â· ${FLAGS[b.cc]||''} ${b.country}</td>
      <td><span class="rb ${rbC(b.rating)}">${b.rating.toFixed(2)}</span></td>
    </tr>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONTRARIAN INDEX
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawContrarian(){
  window._ciX=true;
  // Global Untappd averages â€” verified Feb 2026 directly from untappd.com
  const globalAvgs={
    'Grolsch':3.52,'Hertog Jan':3.58,'Coors Light':2.84,
    'Sapporo':3.51,'Ichiban':3.43,'Modelo':3.55,
    'Stella Artois':3.30,'Duvel':3.70,'Carlsberg':3.09,
    'Harp':3.42,'La Fin Du Monde':4.07,'1664':3.21,
    'Michelob Ultra':2.84,'Guinness':3.80,'Red Stripe':3.31,
    'Heineken':3.00,'Weihenstephaner':3.80,'Modelo Negra':3.60,
    'MÃ¼chner Weisse':3.80,'Munchen Dunkel':3.55,
    'Bud Light':2.30,'Budweiser':2.60,'Corona Extra':3.47,
  };

  const jwalByBeer={};
  beers.forEach(b=>{const n=b.beer;if(!jwalByBeer[n])jwalByBeer[n]={total:0,cnt:0};jwalByBeer[n].total+=b.rating;jwalByBeer[n].cnt++;});

  const rows=Object.entries(jwalByBeer).filter(([n])=>globalAvgs[n]!==undefined).map(([name,v])=>{
    const jwal=v.total/v.cnt,global=globalAvgs[name],delta=jwal-global;
    return {name,jwal,global,delta};
  }).sort((a,b)=>Math.abs(b.delta)-Math.abs(a.delta));

  const avgDelta=avg(rows.map(r=>r.delta));
  document.getElementById('ciAvgDelta').textContent=(avgDelta>=0?'+':'')+avgDelta.toFixed(2);
  document.getElementById('ciAvgDelta').className='kpi-val '+(avgDelta>0?'up':avgDelta<0?'dn':'fl');

  const mostContr=rows.reduce((a,b)=>Math.abs(b.delta)>Math.abs(a.delta)?b:a);
  document.getElementById('ciMostContrarian').textContent=mostContr.name;
  document.getElementById('ciMostSub').textContent=`Î”${mostContr.delta>=0?'+':''}${mostContr.delta.toFixed(2)}`;

  const overrater=rows.reduce((a,b)=>b.delta>a.delta?b:a);
  document.getElementById('ciOverrater').textContent=overrater.name;
  document.getElementById('ciOverSub').textContent=`+${overrater.delta.toFixed(2)} above world`;

  const underrater=rows.reduce((a,b)=>b.delta<a.delta?b:a);
  document.getElementById('ciUnderrater').textContent=underrater.name;
  document.getElementById('ciUnderSub').textContent=`${underrater.delta.toFixed(2)} below world`;

  const sorted=rows.slice().sort((a,b)=>b.delta-a.delta);
  new Chart(document.getElementById('contrarianChart'),{type:'bar',
    data:{labels:sorted.map(r=>r.name),datasets:[{label:'Jwal vs World (Î”)',data:sorted.map(r=>+r.delta.toFixed(2)),
      backgroundColor:sorted.map(r=>r.delta>0?'rgba(0,204,68,0.7)':'rgba(255,34,34,0.7)'),
      borderColor:sorted.map(r=>r.delta>0?'#00cc44':'#ff2222'),borderWidth:1.5}]},
    options:{indexAxis:'y',
      plugins:{legend:{display:false},tooltip:{...TT,callbacks:{label:c=>`Î”${c.raw>=0?'+':''}${c.raw} Â· Jwal: ${sorted[c.dataIndex].jwal.toFixed(2)} Â· World: ${sorted[c.dataIndex].global.toFixed(2)}`}}},
      scales:{x:{min:-2,max:2,grid:{color:'#1a1a1a'},ticks:{color:'#444'},title:{display:true,text:'DELTA (+ = JWAL RATES HIGHER)',color:'#555'}},
              y:{grid:{display:false},ticks:{color:'#ff6600',font:{size:9}}}}}
  });

  document.getElementById('contrarianBody').innerHTML=rows.map(r=>{
    const dc=r.delta>0.3?'up':r.delta<-0.3?'dn':'fl';
    const verdict=r.delta>0.5?'OVERRATED BY WORLD':r.delta>0.2?'JWAL FAVORS':r.delta<-0.5?'JWAL HARSH':r.delta<-0.2?'JWAL BELOW':'IN AGREEMENT';
    return `<tr>
      <td>${logoImg(r.name,20)}</td>
      <td style="color:#ff6600;font-weight:600">${r.name}</td>
      <td><span class="rb ${rbC(r.jwal)}">${r.jwal.toFixed(2)}</span></td>
      <td style="color:#555">${r.global.toFixed(2)}</td>
      <td class="${dc}" style="font-weight:700;font-family:var(--mono)">${r.delta>=0?'+':''}${r.delta.toFixed(2)}</td>
      <td><span style="font-size:8px;padding:1px 6px;border:1px solid;color:${r.delta>0.2?'#00cc44':r.delta<-0.2?'#ff2222':'#ffaa00'};border-color:${r.delta>0.2?'#00cc44':r.delta<-0.2?'#ff2222':'#ffaa00'}">${verdict}</span></td>
    </tr>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// IPO WATCHLIST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawIPO(){
  window._ipoD=true;
  try {

  const styleAvgs={};
  beers.forEach(b=>{if(!styleAvgs[b.style])styleAvgs[b.style]={t:0,c:0};styleAvgs[b.style].t+=b.rating;styleAvgs[b.style].c++;});
  const jwalStyleAvg={}; Object.entries(styleAvgs).forEach(([s,v])=>jwalStyleAvg[s]=v.t/v.c);

  const countryAvgs={};
  beers.forEach(b=>{if(!countryAvgs[b.origin])countryAvgs[b.origin]={t:0,c:0};countryAvgs[b.origin].t+=b.rating;countryAvgs[b.origin].c++;});
  const jwalCountryAvg={}; Object.entries(countryAvgs).forEach(([c,v])=>jwalCountryAvg[c]=v.t/v.c);

  const jwalGlobal=avg(beers.map(b=>b.rating));

  // Analyst target formula:
  // 50% Untappd global avg (market consensus)
  // 25% JWAL style-adjusted expectation (his historical avg for that style, offset from his global)
  // 15% JWAL country-adjusted expectation (his bias for that country of origin)
  // 10% JWAL base avg (anchor)
  // + serving method adjustment
  function analystTarget(beer,style,origin,untappdRating,defaultMethod='Bottle'){
    const styleOffset=(jwalStyleAvg[style]||jwalGlobal)-jwalGlobal;
    const countryOffset=(jwalCountryAvg[origin]||jwalGlobal)-jwalGlobal;
    const methodAdj=defaultMethod==='Draft'?0.10:defaultMethod==='Nitro'?0.05:defaultMethod==='Can'?-0.10:0;
    const target=(untappdRating*0.50)+((jwalGlobal+styleOffset)*0.25)+((jwalGlobal+countryOffset)*0.15)+(jwalGlobal*0.10)+methodAdj;
    return Math.min(5.0,Math.max(1.0,target));
  }

  // 15 beers from 15 different countries (9 user-specified + 6 Claude picks)
  const watchlist=[
    // User-specified
    {beer:'Moretti',         style:'Pilsner-Other',         origin:'IT', abv:4.6, region:'Udine, Friuli',         untappd:3.58, method:'Bottle'},
    {beer:'Peroni',          style:'Lager-Pale',            origin:'IT', abv:5.1, region:'Rome, Lazio',           untappd:3.52, method:'Bottle'},
    {beer:'Blue Moon',       style:'Wheat Beer-Hefeweizen', origin:'US', abv:5.4, region:'Denver, Colorado',      untappd:3.56, method:'Draft'},
    {beer:'Miller Lite',     style:'Lager-American Light',  origin:'US', abv:4.2, region:'Milwaukee, Wisconsin',  untappd:2.51, method:'Can'},
    {beer:'Estrella Damm',   style:'Lager-Pale',            origin:'ES', abv:5.4, region:'Barcelona, Catalonia',  untappd:3.61, method:'Bottle'},
    {beer:'Estrella Galicia',style:'Lager-Helles',          origin:'ES', abv:5.5, region:'A CoruÃ±a, Galicia',     untappd:3.65, method:'Bottle'},
    // Claude picks â€” one per country not yet covered
    {beer:'Brahma',          style:'Lager-Pale',            origin:'BR', abv:4.8, region:'SÃ£o Paulo, SP',         untappd:3.18, method:'Can'},
    {beer:'Quilmes',         style:'Lager-Pale',            origin:'AR', abv:4.9, region:'Buenos Aires, BA',        untappd:3.22, method:'Bottle'},
    {beer:'Tsingtao',        style:'Lager-Pale',            origin:'CN', abv:4.7, region:'Qingdao, Shandong',     untappd:3.29, method:'Bottle'},
    {beer:'Castle Lager',    style:'Lager-Pale',            origin:'ZA', abv:5.0, region:'Johannesburg, Gauteng', untappd:3.18, method:'Can'},
    {beer:'Pilsner Urquell', style:'Pilsner-Other',         origin:'CZ', abv:4.4, region:'Pilsen, Bohemia',          untappd:3.80, method:'Bottle'},
    {beer:'Super Bock',      style:'Pilsner-Other',         origin:'PT', abv:5.2, region:'Porto, Norte',              untappd:3.41, method:'Bottle'},
    {beer:'Mythos',          style:'Lager-Pale',            origin:'GR', abv:4.7, region:'Athens, Attica',        untappd:3.31, method:'Bottle'},
    {beer:'Victoria Bitter', style:'Lager-Pale',            origin:'AU', abv:4.9, region:'Melbourne, Victoria',   untappd:3.12, method:'Can'},
    {beer:'Norrlands Guld',  style:'Lager-Pale',            origin:'SE', abv:5.3, region:'Stockholm',             untappd:3.28, method:'Can'},
  ];

  const reviewed=new Set(beers.map(b=>b.beer));
  const pending=watchlist.filter(w=>!reviewed.has(w.beer));
  const priced=watchlist.filter(w=>reviewed.has(w.beer));

  document.getElementById('ipo-pending').textContent=pending.length;
  document.getElementById('ipo-priced').textContent=priced.length;
  document.getElementById('ipo-watch-count').textContent=pending.length+' BEER'+(pending.length!==1?'S':'')+' QUEUED';

  const allTargets=watchlist.map(w=>analystTarget(w.beer,w.style,w.origin,w.untappd,w.method));
  document.getElementById('ipo-avg-analyst').textContent=(allTargets.reduce((s,v)=>s+v,0)/allTargets.length).toFixed(2);
  document.getElementById('ipo-avg-market').textContent=(watchlist.reduce((s,w)=>s+w.untappd,0)/watchlist.length).toFixed(2);

  document.getElementById('ipoWatchBody').innerHTML=pending.map(w=>{
    const target=analystTarget(w.beer,w.style,w.origin,w.untappd,w.method);
    const upside=target-w.untappd;
    const uClass=upside>0.2?'up':upside<-0.2?'dn':'fl';
    const signal=target>=4.0?'STRONG BUY':target>=3.5?'BUY':target>=3.0?'HOLD':target>=2.5?'SELL':'STRONG SELL';
    const sigColor=target>=4.0?'#00cc44':target>=3.5?'#aacc00':target>=3.0?'#ffaa00':target>=2.5?'#ff6600':'#ff2222';
    return `<tr>
      <td>${logoImg(w.beer,24)}</td>
      <td style="color:#ff6600;font-weight:600">${w.beer}</td>
      <td style="color:#555;font-size:9px">${w.style}</td>
      <td>${FLAGS[w.origin]||''} ${w.origin}</td>
      <td style="color:#555;font-size:9px">${w.region}</td>
      <td style="color:#00aaff">${w.abv.toFixed(1)}%</td>
      <td style="color:#bb44ff;font-family:var(--mono);font-weight:700">${w.untappd.toFixed(2)}</td>
      <td><span style="display:inline-block;padding:1px 8px;background:rgba(0,170,255,0.1);border:1px solid #00aaff;color:#00aaff;font-family:var(--mono);font-weight:700">${target.toFixed(2)}</span> <span style="color:#555;font-size:8px">${strs(target)}</span></td>
      <td class="${uClass}" style="font-family:var(--mono);font-weight:700">${upside>=0?'+':''}${upside.toFixed(2)}</td>
      <td><span style="font-size:8px;padding:2px 7px;border:1px solid ${sigColor};color:${sigColor};font-weight:700;letter-spacing:1px">${signal}</span></td>
    </tr>`;
  }).join('');

  if(priced.length===0){
    document.getElementById('ipoPricedBody').innerHTML='<tr><td colspan="10" style="color:#333;text-align:center;padding:20px">NO BEERS PRICED YET â€” WATCHLIST PENDING</td></tr>';
    document.getElementById('ipo-priced-count').textContent='0 BEERS';
  } else {
    document.getElementById('ipo-priced-count').textContent=priced.length+' BEER'+(priced.length>1?'S':'');
    document.getElementById('ipoPricedBody').innerHTML=priced.map(w=>{
      const target=analystTarget(w.beer,w.style,w.origin,w.untappd,w.method);
      const revd=beers.filter(b=>b.beer===w.beer);
      const jwalPrice=avg(revd.map(b=>b.rating));
      const vsAnalyst=jwalPrice-target;
      const vsMkt=jwalPrice-w.untappd;
      const verdict=vsAnalyst>0.3?'BEAT ANALYST':vsAnalyst>-0.3?'IN LINE':'MISSED ANALYST';
      const vColor=vsAnalyst>0.3?'#00cc44':vsAnalyst<-0.3?'#ff2222':'#ffaa00';
      return `<tr>
        <td>${logoImg(w.beer,24)}</td>
        <td style="color:#ff6600;font-weight:600">${w.beer}</td>
        <td style="color:#555;font-size:9px">${w.style}</td>
        <td>${FLAGS[w.origin]||''} ${w.origin}</td>
        <td style="color:#bb44ff;font-family:var(--mono)">${w.untappd.toFixed(2)}</td>
        <td style="color:#00aaff;font-family:var(--mono)">${target.toFixed(2)}</td>
        <td><span class="rb ${rbC(jwalPrice)}">${jwalPrice.toFixed(2)}</span></td>
        <td class="${vsAnalyst>=0?'up':'dn'}" style="font-family:var(--mono)">${vsAnalyst>=0?'+':''}${vsAnalyst.toFixed(2)}</td>
        <td class="${vsMkt>=0?'up':'dn'}" style="font-family:var(--mono)">${vsMkt>=0?'+':''}${vsMkt.toFixed(2)}</td>
        <td><span style="font-size:8px;padding:1px 6px;border:1px solid ${vColor};color:${vColor}">${verdict}</span></td>
      </tr>`;
    }).join('');
  }

  // â”€â”€ RECOMMENDATIONS
  if(priced.length>0){
    const coveredBeerNames=new Set([...beers.map(b=>b.beer),...watchlist.map(w=>w.beer)]);
    const coveredOrigins=new Set([...beers.map(b=>b.origin),...watchlist.map(w=>w.origin)]);
    const coveredStyles=new Set([...beers.map(b=>b.style),...watchlist.map(w=>w.style)]);
    const candidates=[
      {beer:'Asahi Super Dry',  style:'Lager-Pale',              origin:'JP',abv:5.0,region:'Tokyo',               untappd:3.60,method:'Bottle'},
      {beer:'Leffe Blonde',     style:'Abbey Ale-Blonde',         origin:'BE',abv:6.6,region:'Leuven',              untappd:3.75,method:'Bottle'},
      {beer:'Chimay Blue',      style:'Belgian Strong Dark Ale',  origin:'BE',abv:9.0,region:'Chimay, Hainaut',     untappd:4.05,method:'Bottle'},
      {beer:'Paulaner Hefe',    style:'Wheat Beer-Hefeweizen',    origin:'DE',abv:5.5,region:'Munich',              untappd:3.87,method:'Bottle'},
      {beer:'Augustiner Helles',style:'Lager-Helles',             origin:'DE',abv:5.2,region:'Munich',              untappd:4.10,method:'Draft'},
      {beer:'Nastro Azzurro',   style:'Lager-Pale',               origin:'IT',abv:5.1,region:'Rome, Lazio',         untappd:3.56,method:'Bottle'},
      {beer:'Sam Adams',        style:'Lager-Vienna',             origin:'US',abv:5.0,region:'Boston, MA',          untappd:3.48,method:'Bottle'},
      {beer:'Kronenbourg',      style:'Lager-Pale',               origin:'FR',abv:5.0,region:'Obernai, Alsace',     untappd:3.30,method:'Can'},
      {beer:"Smithwick's",      style:'Irish Red Ale',            origin:'IE',abv:4.5,region:'Kilkenny',            untappd:3.45,method:'Draft'},
      {beer:'Newcastle Brown',  style:'Brown Ale-English',        origin:'GB',abv:4.7,region:'Tadcaster, Yorkshire',untappd:3.28,method:'Bottle'},
      {beer:"Tennent's",        style:'Lager-Pale',               origin:'GB',abv:4.0,region:'Glasgow, Scotland',   untappd:2.95,method:'Can'},
      {beer:'Ringnes',          style:'Lager-Pale',               origin:'NO',abv:4.7,region:'Oslo',                untappd:3.10,method:'Can'},
      {beer:'Tyskie',           style:'Pilsner-Other',            origin:'PL',abv:5.6,region:'Tychy, Silesia',      untappd:3.28,method:'Can'},
      {beer:'Å»ywiec',           style:'Pilsner-Other',            origin:'PL',abv:5.6,region:'Å»ywiec, Silesia',     untappd:3.35,method:'Bottle'},
      {beer:'Hoegaarden',       style:'Witbier',                  origin:'BE',abv:4.9,region:'Hoegaarden',          untappd:3.72,method:'Bottle'},
      {beer:'Orion',            style:'Lager-Pale',               origin:'JP',abv:5.0,region:'Naha, Okinawa',       untappd:3.42,method:'Can'},
      {beer:'Menabrea',         style:'Lager-Pale',               origin:'IT',abv:4.8,region:'Biella, Piedmont',    untappd:3.55,method:'Bottle'},
      {beer:'Tuborg',           style:'Pilsner-Other',            origin:'DK',abv:4.6,region:'Copenhagen',          untappd:3.10,method:'Can'},
      {beer:'Sol',              style:'Lager-Mexican',            origin:'MX',abv:4.5,region:'Mexico City',         untappd:3.15,method:'Bottle'},
      {beer:'Coopers Pale Ale', style:'Pale Ale-American',        origin:'AU',abv:4.5,region:'Adelaide, SA',        untappd:3.72,method:'Bottle'},
    ];
    const recs=candidates
      .filter(c=>!coveredBeerNames.has(c.beer))
      .sort((a,b)=>{
        const aS=(!coveredOrigins.has(a.origin)?2:0)+(!coveredStyles.has(a.style)?1:0);
        const bS=(!coveredOrigins.has(b.origin)?2:0)+(!coveredStyles.has(b.style)?1:0);
        return bS!==aS?bS-aS:b.untappd-a.untappd;
      })
      .slice(0,priced.length);
    document.getElementById('ipoRecsPanel').style.display='';
    document.getElementById('ipo-recs-count').textContent=recs.length+' SLOT'+(recs.length!==1?'S':'');
    document.getElementById('ipoRecsBody').innerHTML=recs.map(c=>{
      const isNewMkt=!coveredOrigins.has(c.origin);
      const isNewStyle=!coveredStyles.has(c.style);
      const [tag,tagColor]=isNewMkt?['NEW MARKET','#00cc44']:isNewStyle?['NEW STYLE','#00aaff']:c.untappd>=3.8?['HIGH CONSENSUS','#bb44ff']:['SIMILAR PROFILE','#555'];
      const target=analystTarget(c.beer,c.style,c.origin,c.untappd,c.method);
      const upside=target-c.untappd;
      return `<tr>
        <td>${logoImg(c.beer,24)}</td>
        <td style="color:#ff6600;font-weight:600">${c.beer}</td>
        <td style="color:#555;font-size:9px">${c.style}</td>
        <td>${FLAGS[c.origin]||''} ${c.origin}</td>
        <td style="color:#555;font-size:9px">${c.region}</td>
        <td style="color:#00aaff">${c.abv.toFixed(1)}%</td>
        <td style="color:#bb44ff;font-family:var(--mono)">${c.untappd.toFixed(2)}</td>
        <td><span style="display:inline-block;padding:1px 8px;background:rgba(0,170,255,0.1);border:1px solid #00aaff;color:#00aaff;font-family:var(--mono);font-weight:700">${target.toFixed(2)}</span> <span class="${upside>=0?'up':'dn'}" style="font-size:8px">${upside>=0?'+':''}${upside.toFixed(2)}</span></td>
        <td><span style="font-size:8px;padding:2px 7px;border:1px solid ${tagColor};color:${tagColor};font-weight:700;letter-spacing:1px">${tag}</span></td>
      </tr>`;
    }).join('');
  }

  } catch(e){ console.error('IPO error:',e); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FUTURES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawFutures(){
  window._ftD=true;
  try {

  const untappdFt={'Bud Light':2.30,'Coors Light':2.84,'Heineken':3.00,'Stella Artois':3.30,'Corona Extra':3.47,'Modelo':3.55,'Miller Lite':2.51,'Budweiser':2.60,'Michelob Ultra':2.84,'Guinness':3.80};
  const futuresBeers=['Bud Light','Coors Light','Heineken','Stella Artois','Corona Extra','Modelo','Miller Lite','Budweiser','Michelob Ultra','Guinness'];

  // Futures price formula:
  // 55% JWAL historical weighted avg
  // 15% most recent review (momentum)
  // 30% Untappd global avg (mean reversion)
  // + dominant serving method adjustment
  function futuresPrice(beerName){
    const history=beers.filter(b=>b.beer===beerName);
    if(!history.length) return null;
    const jwalAvg=avg(history.map(b=>b.rating));
    const untappd=untappdFt[beerName]||jwalAvg;
    const recent=history[history.length-1].rating;
    const weighted=jwalAvg*0.55+recent*0.15+untappd*0.30;
    const methodCount={};
    history.forEach(b=>{methodCount[b.method]=(methodCount[b.method]||0)+1;});
    const topMethod=Object.entries(methodCount).sort((a,b)=>b[1]-a[1])[0][0];
    const mAdj=topMethod==='Draft'?0.05:topMethod==='Can'?-0.05:0;
    return Math.min(5.0,Math.max(1.0,weighted+mAdj));
  }

  // Detect executed contracts: beers with 2+ reviews (prior reviews set the price, latest = execution)
  const executed=[];
  futuresBeers.forEach(name=>{
    const history=beers.filter(b=>b.beer===name);
    if(history.length>1){
      const prior=history.slice(0,-1);
      const last=history[history.length-1];
      const priorAvg=avg(prior.map(b=>b.rating));
      const untappd=untappdFt[name]||priorAvg;
      const recent=prior[prior.length-1].rating;
      const ft=Math.min(5.0,Math.max(1.0,priorAvg*0.55+recent*0.15+untappd*0.30));
      executed.push({name,date:last.month+' '+last.year,futures:ft,actual:last.rating,spread:last.rating-ft});
    }
  });

  const beats=executed.filter(e=>e.spread>=0).length;
  const misses=executed.filter(e=>e.spread<0).length;

  document.getElementById('ft-contracts').textContent=futuresBeers.length;
  document.getElementById('ft-executed').textContent=executed.length;
  document.getElementById('ft-beat').textContent=beats;
  document.getElementById('ft-miss').textContent=misses;
  document.getElementById('ft-exec-count').textContent=executed.length+' EXECUTED';

  document.getElementById('ftContractBody').innerHTML=futuresBeers.map(name=>{
    const history=beers.filter(b=>b.beer===name);
    const ft=futuresPrice(name);
    const untappd=untappdFt[name]||0;

    if(!history.length){
      return `<tr>
        <td>${logoImg(name,24)}</td>
        <td style="color:#ff6600;font-weight:600">${name}</td>
        <td style="color:#555;font-size:9px">â€”</td>
        <td style="color:#333;text-align:center">0</td>
        <td style="color:#333">â€”</td>
        <td style="color:#bb44ff;font-family:var(--mono)">${untappd.toFixed(2)}</td>
        <td colspan="4" style="color:#333;font-size:9px;padding:8px">NO REVIEW DATA YET</td>
        <td></td>
      </tr>`;
    }

    const jwalAvg=avg(history.map(b=>b.rating));
    const ratings=history.map(b=>b.rating);
    const hi=Math.max(...ratings), lo=Math.min(...ratings);
    const volatility=std(ratings);
    const volLabel=volatility<0.2?'LOW':volatility<0.4?'MOD':'HIGH';
    const volClass=volatility<0.2?'up':volatility<0.4?'fl':'dn';
    const signal=ft>=4.0?'STRONG BUY':ft>=3.5?'BUY':ft>=3.0?'HOLD':ft>=2.5?'SELL':'STRONG SELL';
    const sigColor=ft>=4.0?'#00cc44':ft>=3.5?'#aacc00':ft>=3.0?'#ffaa00':ft>=2.5?'#ff6600':'#ff2222';
    return `<tr>
      <td>${logoImg(name,24)}</td>
      <td style="color:#ff6600;font-weight:600">${name}</td>
      <td style="color:#555;font-size:9px">${history[0].style}</td>
      <td style="text-align:center">${history.length}</td>
      <td><span class="rb ${rbC(jwalAvg)}">${jwalAvg.toFixed(2)}</span></td>
      <td style="color:#bb44ff;font-family:var(--mono)">${untappd.toFixed(2)}</td>
      <td style="color:#ff6600;font-family:var(--mono);font-weight:700;font-size:12px">${ft.toFixed(2)}</td>
      <td class="up" style="font-family:var(--mono)">${hi.toFixed(2)}</td>
      <td class="dn" style="font-family:var(--mono)">${lo.toFixed(2)}</td>
      <td class="${volClass}">${volLabel} <span style="font-size:8px">(Ïƒ${volatility.toFixed(2)})</span></td>
      <td><span style="font-size:8px;padding:2px 7px;border:1px solid ${sigColor};color:${sigColor};font-weight:700">${signal}</span></td>
    </tr>`;
  }).join('');

  if(executed.length===0){
    document.getElementById('ftExecBody').innerHTML='<tr><td colspan="7" style="color:#333;text-align:center;padding:20px">NO CONTRACTS EXECUTED â€” FUTURES PRICE LOCKS ON NEXT REVIEW</td></tr>';
  } else {
    document.getElementById('ftExecBody').innerHTML=executed.map(e=>{
      const dc=e.spread>=0?'up':'dn';
      return `<tr>
        <td>${logoImg(e.name,20)}</td>
        <td style="color:#ff6600;font-weight:600">${e.name}</td>
        <td style="color:#555">${e.date}</td>
        <td style="color:#ff6600;font-family:var(--mono);font-weight:700">${e.futures.toFixed(2)}</td>
        <td><span class="rb ${rbC(e.actual)}">${e.actual.toFixed(2)}</span></td>
        <td class="${dc}" style="font-family:var(--mono);font-weight:700">${e.spread>=0?'+':''}${e.spread.toFixed(2)}</td>
        <td><span style="font-size:8px;padding:1px 7px;border:1px solid;color:${e.spread>=0?'#00cc44':'#ff2222'};border-color:${e.spread>=0?'#00cc44':'#ff2222'}">${e.spread>=0?'â–² BEAT FUTURES':'â–¼ MISSED FUTURES'}</span></td>
      </tr>`;
    }).join('');
  }

  } catch(e){ console.error('Futures error:',e); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA INTEGRITY VALIDATOR
// Runs on every page load. Catches broken updates before they
// become visible bugs. Access via G4 Â· AUDIT nav tab.
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function runIntegrityChecks(){
  const REQUIRED_BEER_FIELDS = ['beer','style','origin','abv','method','city','region','country','cc','rating','isNew','month','monthN','year'];
  const REQUIRED_BREWERY_FIELDS = ['name','location','country','cc','beers','lat','lng','ratings'];
  const REQUIRED_LOC_FIELDS = ['city','region','country','cc','lat','lng'];
  const VALID_METHODS = ['Draft','Nitro','Bottle','Can'];
  const VALID_MONTHS  = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  const FUTURES_BEERS = ['Bud Light','Coors Light','Heineken','Stella Artois','Corona Extra','Modelo','Miller Lite','Budweiser','Michelob Ultra','Guinness'];

  const errors=[], warnings=[], passes=[];
  const pass=(msg)=>passes.push(msg);
  const warn=(msg)=>warnings.push('âš  '+msg);
  const fail=(msg)=>errors.push('âœ— '+msg);

  // â”€â”€ 1. BEER ARRAY FIELD COMPLETENESS
  beers.forEach((b,i)=>{
    REQUIRED_BEER_FIELDS.forEach(f=>{
      if(b[f]===undefined||b[f]===null||b[f]==='') fail(`Beer[${i}] "${b.beer||'?'}" missing field: ${f}`);
    });
  });
  if(!errors.length) pass(`All ${beers.length} beer entries have required fields`);

  // â”€â”€ 2. BEER DATA RANGE VALIDATION
  beers.forEach((b,i)=>{
    if(b.rating<1||b.rating>5)        fail(`Beer[${i}] "${b.beer}" rating out of range: ${b.rating}`);
    if(b.abv<1||b.abv>20)             fail(`Beer[${i}] "${b.beer}" suspicious ABV: ${b.abv}`);
    if(!VALID_METHODS.includes(b.method)) fail(`Beer[${i}] "${b.beer}" unknown method: "${b.method}" (valid: ${VALID_METHODS.join('/')})`);
    if(!VALID_MONTHS.includes(b.month))   fail(`Beer[${i}] "${b.beer}" unknown month: "${b.month}"`);
    if(b.monthN<1||b.monthN>12)       fail(`Beer[${i}] "${b.beer}" monthN out of range: ${b.monthN}`);
    if(typeof b.isNew !== 'boolean')   warn(`Beer[${i}] "${b.beer}" isNew is not boolean: ${b.isNew}`);
    if(!FLAGS[b.origin])               warn(`Beer[${i}] "${b.beer}" origin "${b.origin}" has no FLAG emoji`);
    if(!FLAGS[b.cc])                   warn(`Beer[${i}] "${b.beer}" cc "${b.cc}" has no FLAG emoji`);
  });
  const badRatings = beers.filter(b=>b.rating<1||b.rating>5);
  if(!badRatings.length) pass('All beer ratings within 1.0â€“5.0 range');

  // â”€â”€ 3. BRAND LOGO COVERAGE
  const logoNames = Object.keys(BRAND_SVGS);
  const uniqueBeers = [...new Set(beers.map(b=>b.beer))];
  uniqueBeers.forEach(name=>{
    if(!logoNames.includes(name)) warn(`No SVG logo for beer: "${name}"`);
  });
  const coveredCount = uniqueBeers.filter(n=>logoNames.includes(n)).length;
  pass(`${coveredCount}/${uniqueBeers.length} beer brands have SVG logos`);

  // â”€â”€ 4. BREWERY ARRAY VALIDATION
  REQUIRED_BREWERY_FIELDS.forEach(f=>{
    breweries.forEach((b,i)=>{
      if(b[f]===undefined||b[f]===null||b[f]==='') fail(`Brewery[${i}] "${b.name||'?'}" missing field: ${f}`);
    });
  });
  breweries.forEach((b,i)=>{
    if(b.lat<-90||b.lat>90||b.lng<-180||b.lng>180)
      fail(`Brewery[${i}] "${b.name}" has invalid coordinates: lat=${b.lat} lng=${b.lng}`);
    if(!Array.isArray(b.ratings)||b.ratings.length===0)
      fail(`Brewery[${i}] "${b.name}" has empty ratings array`);
    b.ratings.forEach((r,ri)=>{
      if(r<1||r>5) fail(`Brewery[${i}] "${b.name}" ratings[${ri}] out of range: ${r}`);
    });
    if(!FLAGS[b.cc]) warn(`Brewery[${i}] "${b.name}" cc "${b.cc}" has no FLAG emoji`);
    // Check brewery beer names don't include beers not in our dataset (warn only)
    const brewBeerNames = b.beers.split(' Â· ').map(s=>s.trim());
    brewBeerNames.forEach(bn=>{
      const cleanName = bn.replace(/\s*\([^)]+\)/,'').trim(); // strip parenthetical like "(Kirin Ichiban)"
      const inData = beers.some(beer=>beer.beer===cleanName||beer.beer===bn);
      if(!inData) warn(`Brewery "${b.name}" lists beer "${bn}" not found in beers data`);
    });
  });
  if(!errors.filter(e=>e.includes('Brewery')).length) pass(`All ${breweries.length} brewery entries have required fields and valid coordinates`);

  // â”€â”€ 5. DRUNK LOCS VALIDATION
  drunkLocs.forEach((l,i)=>{
    REQUIRED_LOC_FIELDS.forEach(f=>{
      if(l[f]===undefined||l[f]===null||l[f]==='') fail(`drunkLoc[${i}] "${l.city||'?'}" missing field: ${f}`);
    });
    if(l.lat<-90||l.lat>90||l.lng<-180||l.lng>180)
      fail(`drunkLoc[${i}] "${l.city}" has invalid coordinates: lat=${l.lat} lng=${l.lng}`);
    if(!FLAGS[l.cc]) warn(`drunkLoc[${i}] "${l.city}" cc "${l.cc}" has no FLAG emoji`);
    // Verify each drunkLoc has at least one beer reviewed there
    const beersThere = beers.filter(b=>b.city===l.city);
    if(!beersThere.length) warn(`drunkLoc "${l.city}" has no beers in data`);
  });
  pass(`All ${drunkLocs.length} consumption locations validated`);

  // â”€â”€ 6. FUTURES CONTRACT COVERAGE
  FUTURES_BEERS.forEach(name=>{
    const hasData = beers.some(b=>b.beer===name);
    if(!hasData) warn(`Futures contract "${name}" has no review data yet`);
  });
  const coveredFutures = FUTURES_BEERS.filter(n=>beers.some(b=>b.beer===n));
  pass(`${coveredFutures.length}/${FUTURES_BEERS.length} futures contracts have review data`);

  // â”€â”€ 7. IPO WATCHLIST INTEGRITY
  const ipoBeers = ['Moretti','Peroni','Blue Moon','Miller Lite','Estrella Damm','Estrella Galicia',
    'Brahma','Quilmes','Tsingtao','Castle Lager','Pilsner Urquell','Mythos','Victoria Bitter','Norrlands Guld','Super Bock'];
  const reviewedSet = new Set(beers.map(b=>b.beer));
  const ipoReviewed = ipoBeers.filter(n=>reviewedSet.has(n));
  const ipoPending  = ipoBeers.filter(n=>!reviewedSet.has(n));
  ipoBeers.forEach(name=>{
    if(!Object.keys(BRAND_SVGS).includes(name)) warn(`IPO beer "${name}" has no SVG logo`);
  });
  pass(`IPO watchlist: ${ipoPending.length} pending, ${ipoReviewed.length} priced`);

  // â”€â”€ 8. FLAG & CNAMES SYMMETRY
  const flagKeys  = Object.keys(FLAGS);
  const cnameKeys = Object.keys(CNAMES);
  flagKeys.forEach(k=>{ if(!cnameKeys.includes(k)) warn(`FLAGS has "${k}" but CNAMES does not`); });
  cnameKeys.forEach(k=>{ if(!flagKeys.includes(k)) warn(`CNAMES has "${k}" but FLAGS does not`); });
  pass(`FLAGS and CNAMES both define ${flagKeys.length} country codes`);

  // â”€â”€ 9. DOM ELEMENT PRESENCE (runtime check)
  const criticalIds = ['ticker-scroll','clock-time','clock-date','mb-clock','sb-time',
    'beerBody','beerGrid','styleChart','scatterChart','brewedMap','drunkMap',
    'ipoWatchBody','ipoPricedBody','ftContractBody','ftExecBody'];
  criticalIds.forEach(id=>{
    if(!document.getElementById(id)) fail(`Critical DOM element missing: #${id}`);
  });
  pass(`All ${criticalIds.length} critical DOM elements present`);

  // â”€â”€ 10. DATA CONSISTENCY: beer cc matches origin where expected
  const ccOriginMismatches = beers.filter(b=>{
    // For non-US-consumed beers, origin and cc can differ legitimately (e.g. Japanese beer drunk in US)
    // Just flag if cc itself is invalid
    return !FLAGS[b.cc] || !FLAGS[b.origin];
  });
  if(ccOriginMismatches.length) ccOriginMismatches.forEach(b=>fail(`Beer "${b.beer}" has unmapped cc/origin`));
  else pass('All beer cc and origin codes map to valid FLAGS entries');

  // â”€â”€ REPORT
  const totalIssues = errors.length + warnings.length;
  const status = errors.length ? 'FAIL' : warnings.length ? 'WARN' : 'PASS';
  const statusColor = errors.length ? 'color:#ff2222' : warnings.length ? 'color:#ffaa00' : 'color:#00cc44';

  console.group('%cğŸº BREW TERMINAL â€” DATA INTEGRITY REPORT', 'font-weight:bold;color:#ff6600');
  console.log(`Status: %c${status}`, statusColor);
  console.log(`${passes.length} checks passed Â· ${warnings.length} warnings Â· ${errors.length} errors`);
  if(errors.length)   { console.group('ERRORS'); errors.forEach(e=>console.error(e)); console.groupEnd(); }
  if(warnings.length) { console.group('WARNINGS'); warnings.forEach(w=>console.warn(w)); console.groupEnd(); }
  if(!totalIssues)    console.log('%câœ“ All integrity checks passed â€” data is clean', 'color:#00cc44');
  console.groupEnd();

  // Store results for the audit panel
  window._auditResults = { status, passes, warnings, errors, ts: new Date().toLocaleTimeString() };

  // Update status bar dot color if there are errors
  if(errors.length) {
    const dot = document.querySelector('.sb-dot');
    if(dot) dot.style.background='#ff2222';
  } else if(warnings.length) {
    const dot = document.querySelector('.sb-dot');
    if(dot) dot.style.background='#ffaa00';
  }
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PASSWORD GATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PW_KEY='brewUnlocked';
const PW_HASH='ClemsonNewRo';  // stored as plain string; this is client-side only
let _pwPendingTab=null;

function isUnlocked(){
  return sessionStorage.getItem(PW_KEY)==='1';
}
function openPwModal(pendingTab){
  _pwPendingTab=pendingTab;
  document.getElementById('pwInput').value='';
  document.getElementById('pwErr').textContent='';
  document.getElementById('pwModal').classList.add('open');
  setTimeout(()=>document.getElementById('pwInput').focus(),80);
}
function checkPw(){
  const val=document.getElementById('pwInput').value;
  if(val===PW_HASH){
    sessionStorage.setItem(PW_KEY,'1');
    document.getElementById('pwModal').classList.remove('open');
    if(_pwPendingTab) showTab(_pwPendingTab);
    _pwPendingTab=null;
  } else {
    const err=document.getElementById('pwErr');
    err.textContent='âœ— INCORRECT PASSWORD';
    document.getElementById('pwInput').value='';
    document.getElementById('pwInput').focus();
    // brief shake
    const box=document.getElementById('pwBox');
    box.style.transform='translateX(6px)';
    setTimeout(()=>box.style.transform='translateX(-6px)',80);
    setTimeout(()=>box.style.transform='',160);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
try {
  const ec=document.getElementById('exportCount');
  if(ec) ec.textContent=`Downloads all ${beers.length} beer reviews`;
} catch(e){}
function exportData(fmt){
  try {
    let content,mime,ext;
    if(fmt==='json'){
      content=JSON.stringify(beers,null,2);
      mime='application/json'; ext='json';
    } else {
      const cols=['beer','style','origin','abv','method','city','region','country','cc','rating','month','year'];
      const rows=beers.map(b=>cols.map(k=>JSON.stringify(b[k]??'')).join(','));
      content=cols.join(',')+'\n'+rows.join('\n');
      mime='text/csv'; ext='csv';
    }
    const a=document.createElement('a');
    a.href=URL.createObjectURL(new Blob([content],{type:mime}));
    a.download=`brew-reviews-${new Date().toISOString().slice(0,10)}.${ext}`;
    a.click(); URL.revokeObjectURL(a.href);
  } catch(e){ console.error('Export error:',e); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADD NEW BEER FORM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MONTHS=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
function getSessionBeers(){ return JSON.parse(localStorage.getItem('sessionBeers')||'[]'); }
function saveSessionBeers(arr){ localStorage.setItem('sessionBeers',JSON.stringify(arr)); }

function renderAddLog(){
  const arr=getSessionBeers();
  const cnt=document.getElementById('addnew-count');
  if(cnt) cnt.textContent=arr.length+' LOGGED THIS SESSION';
  const eb=document.getElementById('an-export-btn');
  const cb=document.getElementById('an-clear-btn');
  if(eb) eb.style.display=arr.length?'inline-block':'none';
  if(cb) cb.style.display=arr.length?'inline-block':'none';
  const log=document.getElementById('an-log');
  if(!log) return;
  if(!arr.length){ log.innerHTML='<div style="color:#333;font-size:9px;text-align:center;padding:20px">NO REVIEWS LOGGED THIS SESSION</div>'; return; }
  log.innerHTML=arr.slice().reverse().map((b,i)=>`
    <div style="display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid #1a1a1a;flex-wrap:wrap;gap:4px">
      <div>
        <span style="color:#ff6600;font-weight:700;font-size:11px">${b.beer}</span>
        <span style="color:#555;font-size:9px;margin-left:8px">${b.style} Â· ${b.abv}% ABV Â· ${b.method}</span>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <span class="rb ${rbC(b.rating)}">${b.rating.toFixed(2)}</span>
        <span style="color:#555;font-size:9px">${b.city} Â· ${b.month} ${b.year}</span>
        <button onclick="removeSessionBeer(${arr.length-1-i})" style="background:none;border:none;color:#333;font-family:var(--mono);font-size:10px;cursor:pointer" onmouseover="this.style.color='#ff2222'" onmouseout="this.style.color='#333'">âœ•</button>
      </div>
    </div>`).join('');
}

function submitNewBeer(){
  const msg=document.getElementById('an-msg');
  const fv=id=>document.getElementById(id)?.value?.trim();
  const beer=fv('an-beer'),style=fv('an-style'),origin=(fv('an-origin')||'').toUpperCase();
  const abv=parseFloat(fv('an-abv')),rating=parseFloat(fv('an-rating'));
  const method=fv('an-method'),city=fv('an-city'),region=fv('an-region'),country=fv('an-country');
  if(!beer||!style||!origin||isNaN(abv)||isNaN(rating)||!city||!region||!country){
    msg.style.color='#ff2222'; msg.textContent='âœ— Fill in all required fields'; return;
  }
  if(rating<1||rating>5){ msg.style.color='#ff2222'; msg.textContent='âœ— Rating must be 1â€“5'; return; }
  if(abv<0||abv>20){ msg.style.color='#ff2222'; msg.textContent='âœ— ABV must be 0â€“20%'; return; }
  const now=new Date();
  const entry={beer,style,origin,abv,method,city,region,country,cc:origin,rating,
    isNew:true,month:MONTHS[now.getMonth()],monthN:now.getMonth()+1,year:now.getFullYear()};
  const arr=getSessionBeers();
  arr.push(entry);
  saveSessionBeers(arr);
  // Add to live beers array so modal and table update immediately
  beers.push(entry);
  applyBeerFilter();
  msg.style.color='#00cc44';
  msg.textContent=`âœ“ ${beer} logged! Export JSON to save permanently.`;
  clearNewBeerForm(true);
  renderAddLog();
  setTimeout(()=>{msg.textContent='';},5000);
}

function clearNewBeerForm(keepMsg=false){
  ['an-beer','an-style','an-rating','an-origin','an-abv','an-city','an-region','an-country'].forEach(id=>{
    const el=document.getElementById(id); if(el) el.value='';
  });
  if(!keepMsg){ const m=document.getElementById('an-msg'); if(m) m.textContent=''; }
}

function removeSessionBeer(idx){
  const arr=getSessionBeers(); arr.splice(idx,1); saveSessionBeers(arr); renderAddLog();
}

function clearNewBeers(){
  saveSessionBeers([]); renderAddLog();
}

function exportNewBeers(){
  const arr=getSessionBeers();
  if(!arr.length) return;
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([JSON.stringify(arr,null,2)],{type:'application/json'}));
  a.download=`new-reviews-${new Date().toISOString().slice(0,10)}.json`;
  a.click(); URL.revokeObjectURL(a.href);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadComments(){
  return JSON.parse(localStorage.getItem('brewComments')||'[]');
}
function saveComments(arr){
  localStorage.setItem('brewComments',JSON.stringify(arr));
}
function renderComments(){
  const arr=loadComments();
  const el=document.getElementById('comment-list');
  const cnt=document.getElementById('comment-count');
  if(cnt) cnt.textContent=arr.length+' ENTR'+(arr.length===1?'Y':'IES');
  if(!arr.length){
    el.innerHTML='<div style="color:#333;text-align:center;padding:30px;font-size:9px">NO NOTES YET â€” ADD ONE ABOVE</div>';
    return;
  }
  el.innerHTML=arr.slice().reverse().map((c,i)=>`
    <div style="display:flex;gap:10px;align-items:flex-start;padding:8px 0;border-bottom:1px solid #1a1a1a">
      <div style="flex-shrink:0;width:6px;height:6px;background:var(--orange);margin-top:4px"></div>
      <div style="flex:1;min-width:0">
        ${c.subject?`<div style="font-size:9px;color:var(--orange);font-weight:700;letter-spacing:1px;margin-bottom:2px">${escHtml(c.subject)}</div>`:''}
        <div style="font-size:11px;color:#e8e8e8;line-height:1.5;word-break:break-word">${escHtml(c.text)}</div>
        <div style="font-size:9px;color:#333;margin-top:3px">${c.ts}</div>
      </div>
      <button onclick="deleteComment(${arr.length-1-i})" style="background:none;border:none;color:#333;font-family:var(--mono);font-size:10px;cursor:pointer;flex-shrink:0;padding:0 4px" onmouseover="this.style.color='#ff2222'" onmouseout="this.style.color='#333'">âœ•</button>
    </div>`).join('');
}
function escHtml(s){
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
function addComment(){
  const subj=document.getElementById('comment-subject').value.trim();
  const txt=document.getElementById('comment-text').value.trim();
  if(!txt) return;
  const arr=loadComments();
  arr.push({subject:subj,text:txt,ts:new Date().toLocaleString()});
  saveComments(arr);
  document.getElementById('comment-subject').value='';
  document.getElementById('comment-text').value='';
  renderComments();
}
function deleteComment(idx){
  const arr=loadComments();
  arr.splice(idx,1);
  saveComments(arr);
  renderComments();
}

function drawAudit(){
  window._auditD=true;
  try {
    const r=window._auditResults;
    if(!r){ document.getElementById('auditBody').innerHTML='<p style="color:#555">No results.</p>'; return; }
    const statusColor=r.errors.length?'#ff2222':r.warnings.length?'#ffaa00':'#00cc44';
    document.getElementById('audit-status').textContent=r.status;
    document.getElementById('audit-status').style.color=statusColor;
    document.getElementById('audit-pass').textContent=r.passes.length;
    document.getElementById('audit-warn').textContent=r.warnings.length;
    document.getElementById('audit-fail').textContent=r.errors.length;
    document.getElementById('audit-ts').textContent='Last run: '+r.ts;

    const mkRows=(arr,cls,icon)=>arr.map(msg=>`
      <div style="display:flex;gap:8px;align-items:flex-start;padding:5px 0;border-bottom:1px solid #1a1a1a">
        <span style="color:${cls};font-size:10px;flex-shrink:0;width:12px">${icon}</span>
        <span style="font-size:9px;color:${cls};font-family:var(--mono);line-height:1.5">${msg.replace(/^[âœ—âš âœ“]\s*/,'')}</span>
      </div>`).join('');

    document.getElementById('auditBody').innerHTML=`
      ${r.errors.length?`<div style="margin-bottom:10px"><div style="font-size:9px;font-weight:700;color:#ff2222;letter-spacing:2px;margin-bottom:4px">ERRORS (${r.errors.length})</div>${mkRows(r.errors,'#ff2222','âœ—')}</div>`:''}
      ${r.warnings.length?`<div style="margin-bottom:10px"><div style="font-size:9px;font-weight:700;color:#ffaa00;letter-spacing:2px;margin-bottom:4px">WARNINGS (${r.warnings.length})</div>${mkRows(r.warnings,'#ffaa00','âš ')}</div>`:''}
      <div><div style="font-size:9px;font-weight:700;color:#00cc44;letter-spacing:2px;margin-bottom:4px">PASSED (${r.passes.length})</div>${mkRows(r.passes,'#00cc44','âœ“')}</div>`;
  } catch(e){ console.error('Audit panel error:',e); }
}
</script>

</body>
</html>
